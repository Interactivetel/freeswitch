cscope 15 /tmp/fs-tap/public_fs_merge_v1.6/libs/freetdm/src/ftmod/ftmod_sangoma_isdn_tap               0000173140
	@ftmod_sangoma_isdn_bidir_tap.c

42 
	~"ámod_§ngoma_isdn_p.h
"

58 
ádm_¡©us_t
 
	$§ngoma_isdn_bidœ_p_g’”©e_šv™e
(
¢gisdn_p_t
 *
p
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
üv
)

60 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

61 
ádm_chªÃl_t
 *
³”fchª
 = 
NULL
;

62 
ádm_¡©us_t
 
»t
 = 
FTDM_FAIL
;

63 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

64 
ádm_chªÃl_t
 *
pchª
 = 
NULL
;

66 ià(!
pÿÎ
) {

67 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s Callref- %d] Invalid…call„eceived!\n",

68 
p
->
¥ª
->
Çme
, 
üv
);

69 
dÚe
;

73 
fchª
 = 
	`§ngoma_isdn_bidœ_p_g‘_fchª
(
p
, 
pÿÎ
,…ÿÎ->
chªId
, 1, 
CALL_DIRECTION_INBOUND
, 
FTDM_TRUE
);

74 ià(!
fchª
) {

75 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Tryingo Open odd/unavailable channel\n",

76 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

77 
dÚe
;

79 
pÿÎ
->
chª_´es
 = 
FTDM_TRUE
;

80 
pÿÎ
->
fchª
 = fchan;

83 
³”fchª
 = 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
³”p
, 
pÿÎ
->
chªId
);

84 ià(!
³”fchª
) {

85 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] No…eer channel‡vailable\n",

86 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

87 
dÚe
;

90 
pchª
 = 
³”fchª
;

91 
	`ádm_chªÃl_lock
(
³”fchª
);

92 ià(
	`ádm_‹¡_æag
(
³”fchª
, 
FTDM_CHANNEL_INUSE
)) {

93 
»u£_chª_cÚ_»cv
++;

94 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_NOTICE
,

96 
³”p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
³”fchª
->
¡©e
));

98 ià(
	`ádm_‹¡_æag
(
pchª
, 
FTDM_CHANNEL_OPEN
)) {

99 
pchª
->
ÿÎ_d©a
 = 
NULL
;

100 
pchª
->
pæags
 = 0;

101 
	`ádm_chªÃl_şo£
(&
pchª
);

103 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_NOTICE
,

105 
³”p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
³”fchª
->
¡©e
));

107 
	`ádm_ş—r_æag
(
³”fchª
, 
FTDM_CHANNEL_INUSE
);

109 
	`ádm_chªÃl_uÆock
(
³”fchª
);

111 
	`ádm_chªÃl_lock
(
fchª
);

116 
fchª
->
ÿÎ_d©a
 = 
³”fchª
;

117 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_DIALING
);

118 
	`ádm_chªÃl_uÆock
(
fchª
);

121 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

123 
»t
 = 
FTDM_SUCCESS
;

124 
dÚe
:

125  
»t
;

126 
	}
}

135 
ádm_¡©us_t
 
	$§ngoma_isdn_bidœ_p_hªdË_ev’t_cÚ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
)

137 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

138 
ÿÎ_»f
[25] = { 0 };

139 
ádm_chªÃl_t
 *
³”fchª
 = 
NULL
;

140 
·ssive_ÿÎ_t
 *
³”pÿÎ
 = 
NULL
;

141 
cÚ_ÿÎ_šfo_t
 *
ÿÎ_šfo
 = 
NULL
;

142 *
üv_key
 = 
NULL
;

143 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

144 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

146 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d] %sƒvent„eceive\n",

147 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

151 ià(!(
³”pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
³”p
, 
üv
))) {

156 
	`¥rštf
(
ÿÎ_»f
, "%d", 
üv
);

157 ià(
	`hashbË_£¬ch
(
³”p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
)) {

158 
	`ádm_log
(
FTDM_LOG_CRIT
, "C®Èw™h c®È»ã»û %d i ®»ady in£¹ed iÀthhashabË\n", 
üv
);

159  
FTDM_SUCCESS
;

163 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[% C®Ìef- %d] In£¹šg…“rÿÎ iÀhash†i¡ fÜ % »ûived\n", 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

164 
ÿÎ_šfo
 = 
	`ádm_ÿÎoc
((*call_info), 1);

165 ià(!
ÿÎ_šfo
) {

166 
	`ádm_log
(
FTDM_LOG_ERROR
, "UÇbËØ®loÿ‹ memÜy w™h crv = %d iÀ³”­ c®Èli¡ fÜ s·À%s\n", 
üv
, 
p
->
¥ª
->
Çme
);

167  
FTDM_FAIL
;

171 
ÿÎ_šfo
->
cÚ»cv_time
 = 
	`time
(
NULL
);

172 
ÿÎ_šfo
->
ÿÎ»f_v®
 = 0;

173 
ÿÎ_šfo
->
msgTy³
 = 0;

174 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_FALSE
;

175 
ÿÎ_šfo
->
»cv_£tup
 = 
FTDM_FALSE
;

176 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_FALSE
;

179 
ÿÎ_šfo
->
ÿÎ»f_v®
 = 
üv
;

182 
	`time
(&
ÿÎ_šfo
->
cÚ»cv_time
);

185 
ÿÎ_šfo
->
msgTy³
 = msgType;

187 ià(
msgTy³
 =ğ
Q931_CONNECT
) {

188 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_TRUE
;

190 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_FALSE
;

192 
ÿÎ_šfo
->
»cv_£tup
 = 
FTDM_FALSE
;

194 ià(
štfCb
->
chª_id
) {

195 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_TRUE
;

197 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_FALSE
;

200 
	`mem£t
(
ÿÎ_»f
, 0 , (call_ref));

201 
	`¥rštf
(
ÿÎ_»f
, "%d", 
üv
);

203 
üv_key
 = 
	`ádm_¡rdup
(
ÿÎ_»f
);

205 ià(!
	`hashbË_š£¹
(
³”p
->
³nd_ÿÎ_l¡
, (*)
üv_key
, 
ÿÎ_šfo
, 
HASHTABLE_FLAG_FREE_KEY
)) {

206 
	`ádm_log
(
FTDM_LOG_ERROR
, "UÇbËØš£¹ c®ÈšfØfÜ c®È»ã»nû v®ua %d\n", 
üv
);

207  
FTDM_FAIL
;

210 ià(
štfCb
->
chª_id
) {

211 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Donot wait for SETUP‡s channel ID in…resent CONNECT message",

212 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

214 
³”pÿÎ
 = 
	`§ngoma_isdn_p_ü—‹_pÿÎ
(
³”p
, 
msgTy³
, 
štfCb
, 
üv
);

215 ià(!
³”pÿÎ
) {

216 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Failedo create…call wait for SETUP messageo be„eceived",

217 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

219  
FTDM_FAIL
;

222 
³”pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

223 
³”pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

224 
³”pÿÎ
->
»cv_£tup
 = 
FTDM_FALSE
;

226 
cÚÃù_»cv_w™h_chªId
++;

229 ià(
³”pÿÎ
->
chª_´es
 =ğ
FTDM_FALSE
) {

230 
	`ádm_log
(
FTDM_LOG_DEBUG
,

232 
³”p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

234 
	`§ngoma_isdn_bidœ_p_g’”©e_šv™e
(
³”p
, 
³”pÿÎ
, 
üv
);

238 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d] %sƒvent„eceived before SETUP, holding its…rocessing\n",

239 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

241 
	`ádm_log
(
FTDM_LOG_DEBUG
,

243 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

245  
FTDM_FAIL
;

251 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] %sƒvent„eceive\n",

252 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

254 
³”pÿÎ
->
»cv_cÚn
 = 
FTDM_TRUE
;

257 
	`time
(&
³”pÿÎ
->
t_cÚ_»cv
);

260 ià((
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

261 
	`ádm_log
(
FTDM_LOG_ERROR
,

263 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

264  
FTDM_FAIL
;

268 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, &
üv
);

269 ià(!
pÿÎ
) {

271 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, 
NULL
);

272 ià(!
pÿÎ
) {

273 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Failedo get‡ free…eer ISDN…assive call slot!\n",

274 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

276 
	`ádm_log
(
FTDM_LOG_ERROR
, "***** Print TAP Pcalls structure *****\n");

277 
	`§ngoma_isdn_p_´št_pÿÎ
(
p
);

279 
	`ádm_log
(
FTDM_LOG_ERROR
, "\n***** Print PEERTAP Pcalls structure *****\n");

280 
	`§ngoma_isdn_p_´št_pÿÎ
(
³”p
);

282  
FTDM_FAIL
;

285 
	`§ngoma_isdn_p_»£t_pÿÎ
(
pÿÎ
);

287 
pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

288 ià(
³”pÿÎ
->
chªId
) {

289 
pÿÎ
->
chªId
 = 
³”pÿÎ
->chanId;

290 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Setting chanId‡s %d for %sƒvent„eceived on Span %s from its…eer\n",

291 
pÿÎ
->
chªId
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

292 } ià(
štfCb
->
chª_id
) {

293 
pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

294 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Setting chanId‡s %d for %sƒvent„eceived on Span %s\n",

295 
pÿÎ
->
chªId
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

297 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Invalid chanId‡s %d for %sƒvent„eceived on Span %s\n",

298 
štfCb
->
chª_id
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

299  
FTDM_FAIL
;

303 ià(
³”pÿÎ
->
chª_´es
 =ğ
FTDM_FALSE
) {

304 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Invalid channel…resent\n",

305 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

307  
FTDM_FAIL
;

310 
pÿÎ
->
»cv_cÚn
 = 
FTDM_TRUE
;

313 
fchª
 = 
	`§ngoma_isdn_bidœ_p_g‘_fchª
(
p
, 
pÿÎ
,…ÿÎ->
chªId
, 1, 
CALL_DIRECTION_NONE
, 
FTDM_FALSE
);

314 ià(!
fchª
) {

315 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Connect„equested on odd/unavailable\n",

316 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

317  
FTDM_FAIL
;

319 
³”fchª
 = 
³”pÿÎ
->
fchª
;

320 
pÿÎ
->
fchª
 = fchan;

322 
	`ádm_chªÃl_lock
(
fchª
);

323 
fchª
->
ÿÎ_d©a
 = 
³”fchª
;

324 
	`ádm_chªÃl_uÆock
(
fchª
);

326 
	`ádm_chªÃl_lock
(
³”fchª
);

327 
³”fchª
->
ÿÎ_d©a
 = 
fchª
;

328 
	`ádm_chªÃl_uÆock
(
³”fchª
);

330 ià(!
pÿÎ
) {

331 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Gettinghe…call\n",

332 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

334 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

335 
	`ádm_log
(
FTDM_LOG_ERROR
,

337 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

338  
FTDM_FAIL
;

342 
	`§ngoma_isdn_p_£t_p_msg_šfo
(
p
, 
msgTy³
, 
pÿÎ
, 
štfCb
);

344 
pÿÎ
->
p_msg
.
chª_id
 = 
³”pÿÎ
->tap_msg.chan_id;

346 
pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 1;

349 
	`mem£t
(
pÿÎ
->
p_msg
.
ÿÎed_num
, 0, (pcall->tap_msg.called_num));

350 
	`mem£t
(
pÿÎ
->
p_msg
.
ÿÎšg_num
, 0, (pcall->tap_msg.calling_num));

352 ià(!
	`ádm_¡¾’_z”o
(
³”pÿÎ
->
p_msg
.
ÿÎed_num
)) {

353 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎed_num
, 
³”pÿÎ
->tap_msg.called_num);

354 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®Ëd Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎed_num
);

357 ià(!
	`ádm_¡¾’_z”o
(
³”pÿÎ
->
p_msg
.
ÿÎšg_num
)) {

358 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎšg_num
, 
³”pÿÎ
->tap_msg.calling_num);

359 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®lšg Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎšg_num
);

362 
³”pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 1;

364 ià(!
pÿÎ
->
fchª
) {

365 
	`ádm_log
(
FTDM_LOG_ERROR
,

367 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

368  
FTDM_FAIL
;

372 
	`ádm_chªÃl_lock
(
pÿÎ
->
fchª
);

373 
	`ádm_log_chª
(
pÿÎ
->
fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Tap call‡nswered in state %s\n",

374 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
ÕÿÎ->
fchª
->
¡©e
));

376 
	`ádm_£t_pæag
(
pÿÎ
->
fchª
, 
ISDN_TAP_NETWORK_ANSWER
);

377 if(
	`ádm_‹¡_æag
(
pÿÎ
->
fchª
, 
FTDM_CHANNEL_OUTBOUND
)) {

378 ià(
	`ádm_chªÃl_g‘_¡©e
(
pÿÎ
->
fchª
è=ğ
FTDM_CHANNEL_STATE_RINGING
) {

379 
	`ádm_£t_¡©e
(
pÿÎ
->
fchª
, 
FTDM_CHANNEL_STATE_UP
);

381 
—¾y_cÚÃù_»cv
++;

382 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Waitingo change channel stateo %s\n",

383 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
fchª
->
¡©e
));

386 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Waitingo„eceive 200 OKo move channel stateo UP\n",

387 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

389 
	`ádm_chªÃl_uÆock
(
pÿÎ
->
fchª
);

392 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

394 
	`ádm_chªÃl_lock
(
³”fchª
);

395 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] PeerTap call was‡nswered in state %s\n",

396 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
³”fchª
->
¡©e
));

398 
	`ádm_£t_pæag
(
³”fchª
, 
ISDN_TAP_NETWORK_ANSWER
);

400 if(
	`ádm_‹¡_æag
(
³”fchª
, 
FTDM_CHANNEL_OUTBOUND
)) {

401 
³”pÿÎ
->
»cv_cÚn
 = 
FTDM_TRUE
;

403 ià(
	`ádm_chªÃl_g‘_¡©e
(
³”pÿÎ
->
fchª
è=ğ
FTDM_CHANNEL_STATE_RINGING
) {

404 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_UP
);

406 
—¾y_cÚÃù_»cv
++;

407 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Waitingo change channel stateo %s\n",

408 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
³”fchª
->
¡©e
));

411 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Waitingo„eceive 200 OKo move channel stateo UP\n",

412 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

414 
	`ádm_chªÃl_uÆock
(
³”fchª
);

417 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

419  
FTDM_SUCCESS
;

421 
	}
}

430 
ádm_¡©us_t
 
	$§ngoma_isdn_bidœ_p_hªdË_ev’t_»l
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
üv
)

432 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

433 
ádm_chªÃl_t
 *
³”fchª
 = 
NULL
;

434 
·ssive_ÿÎ_t
 *
³”pÿÎ
 = 
NULL
;

435 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

436 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

438 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d] %sƒvent„eceived\n",

439 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

441 ià(
msgTy³
 =ğ
Q931_DISCONNECT
) {

443 
discÚÃù_»cv
++;

446 
»Ëa£_»cv
++;

449 
	`§ngoma_isdn_p_is_cÚ_»cv
(
p
, 
üv
, 
msgTy³
);

453 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

454 
	`ádm_log
(
FTDM_LOG_DEBUG
,

456 
p
->
¥ª
->
Çme
, 
üv
);

457 
’d
;

460 ià(
pÿÎ
->
fchª
) {

461 
fchª
 = 
pÿÎ
->fchan;

463 
	`ádm_chªÃl_lock
(
fchª
);

464 ià(
fchª
->
Ï¡_¡©e
 =ğ
FTDM_CHANNEL_STATE_HANGUP
) {

465 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_DOWN
);

467 
	`ádm_log_chª
(
fchª
,
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Changing channel stateo DOWN\n",

468 
p
->
¥ª
->
Çme
, 
fchª
->
physiÿl_chª_id
, 
üv
);

469 } ià((
fchª
->
¡©e
 < 
FTDM_CHANNEL_STATE_TERMINATING
è&& (fchª->¡©!ğ
FTDM_CHANNEL_STATE_DOWN
)) {

470 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

472 
	`ádm_log_chª
(
fchª
,
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Changing channel stateo TERMINATING\n",

473 
p
->
¥ª
->
Çme
, 
fchª
->
physiÿl_chª_id
, 
üv
);

475 
	`ádm_chªÃl_uÆock
(
fchª
);

478 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

479 
’d
;

482 ià(!(
³”pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
³”p
, 
üv
))) {

483 
	`ádm_log
(
FTDM_LOG_DEBUG
,

485 
³”p
->
¥ª
->
Çme
, 
üv
);

486 
’d
;

489 ià(
³”pÿÎ
->
fchª
) {

490 
³”fchª
 = 
³”pÿÎ
->
fchª
;

492 
	`ádm_chªÃl_lock
(
³”fchª
);

493 ià(
³”fchª
->
Ï¡_¡©e
 =ğ
FTDM_CHANNEL_STATE_HANGUP
) {

494 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_DOWN
);

496 
	`ádm_log_chª
(
³”fchª
,
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Changing…eer channel stateo DOWN\n",

497 
³”p
->
¥ª
->
Çme
, 
³”fchª
->
physiÿl_chª_id
, 
üv
);

498 } ià((
³”fchª
->
¡©e
 < 
FTDM_CHANNEL_STATE_TERMINATING
è&& (³”fchª->¡©!ğ
FTDM_CHANNEL_STATE_DOWN
)) {

499 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

501 
	`ádm_log_chª
(
³”fchª
,
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Changing…eer channel stateo TERMINATING\n",

502 
³”p
->
¥ª
->
Çme
, 
³”fchª
->
physiÿl_chª_id
, 
üv
);

504 
	`ádm_chªÃl_uÆock
(
³”fchª
);

507 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

510 
’d
:

511 
	`§ngoma_isdn_p_put_pÿÎ
(
p
, &
üv
);

512 
	`§ngoma_isdn_p_put_pÿÎ
(
³”p
, &
üv
);

514  
FTDM_SUCCESS
;

515 
	}
}

524 
ádm_chªÃl_t
 *
	$§ngoma_isdn_bidœ_p_g‘_fchª
(
¢gisdn_p_t
 *
p
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
chª_id
, 
fÜû_ş—r_chª
, 
p_ÿÎ_dœeùiÚ_t
 
ÿÎ_dœ
, 
ádm_boŞ_t
 
to_İ’
)

526 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

527 
”r
 = 0;

529 
fchª
 = 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
p
, 
chª_id
);

530 ià(!
fchª
) {

531 
”r
 = 1;

532 
dÚe
;

535 
	`ádm_chªÃl_lock
(
fchª
);

537 ià(
to_İ’
 =ğ
FTDM_TRUE
) {

538 ià(
	`ádm_‹¡_æag
(
fchª
, 
FTDM_CHANNEL_INUSE
)) {

539 
»u£_chª_cÚ_»cv
++;

540 ià(
fÜû_ş—r_chª
) {

541 
	`ádm_ş—r_æag
(
fchª
, 
FTDM_CHANNEL_INUSE
);

543 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_ERROR
, "ChªÃÈi ®»ady iÀu£ ..¡©e[%s]\n", 
	`ádm_chªÃl_¡©e2¡r
(fchª->
¡©e
));

544 
”r
 = 1;

545 
dÚe
;

550 ià((
fchª
->
¡©e
 !ğ
FTDM_CHANNEL_STATE_DOWN
è&& (fchª->¡©< 
FTDM_CHANNEL_STATE_TERMINATING
)) {

551 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_INFO
, "Bi-dœeùiÚ®­ ChªÃÈš s‹ [%s]. Chªgšg s‹ØTERMINATING!\n", 
	`ádm_chªÃl_¡©e2¡r
(fchª->
¡©e
));

552 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

553 } ià(
fchª
->
¡©e
 =ğ
FTDM_CHANNEL_STATE_HANGUP
) {

554 
	`ádm_log_chª_msg
(
fchª
, 
FTDM_LOG_INFO
, "Bi-directionalap Channel is in HANGUP state…lease move channelo DOWN state\n");

555 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_DOWN
);

558 ià(
fchª
->
¡©e
 !ğ
FTDM_CHANNEL_STATE_DOWN
) {

560 
	`ádm_chªÃl_uÆock
(
fchª
);

562 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

567 
fchª
->
¡©e
 !ğ
FTDM_CHANNEL_STATE_DOWN
) {

570 
	`ádm_chªÃl_lock
(
fchª
);

573 ià(
	`ádm_chªÃl_İ’_chª
(
fchª
è!ğ
FTDM_SUCCESS
) {

574 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_ERROR
, "Could‚ot openap channel %s\n","");

575 
”r
 = 1;

576 
dÚe
;

578 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_DEBUG
, "Tap channel openned successfully \n %s","");

581 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 0, (fchan->caller_data.cid_num.digits));

582 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 0, (fchan->caller_data.dnis.digits));

583 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 0, (fchan->caller_data.cid_name));

584 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 0;

586 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 
pÿÎ
->
ÿÎšgnum
.digits);

587 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 
pÿÎ
->
ÿÎšgnum
.
dig™s
);

588 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 
pÿÎ
->
ÿÎednum
.digits);

589 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 
pÿÎ
->
ÿÎ»f_v®
;

591 ià(
ÿÎ_dœ
 =ğ
CALL_DIRECTION_INBOUND
) {

592 
	`ádm_ş—r_æag
(
fchª
, 
FTDM_CHANNEL_OUTBOUND
);

593 } ià(
ÿÎ_dœ
 =ğ
CALL_DIRECTION_OUTBOUND
) {

594 
	`ádm_£t_æag
(
fchª
, 
FTDM_CHANNEL_OUTBOUND
);

597 
dÚe
:

598 ià(
fchª
) {

599 
	`ádm_chªÃl_uÆock
(
fchª
);

602 ià(
”r
) {

603  
NULL
;

606  
fchª
;

607 
	}
}

	@ftmod_sangoma_isdn_tap.c

42 
	~"ámod_§ngoma_isdn_p.h
"

49 
	gg_decod”_lib_š™
;

52 
¢g_decod”_ev’t_š‹rçû_t
 
	g¢g_ev’t
;

53 
ádm_io_š‹rçû_t
 
	gádm_¢gisdn_p_š‹rçû
;

54 
ádm_¢gisdn_p_d©a_t
 
	gg_¢gisdn_p_d©a
;

57 
ušt64_t
 
	g£tup_»cv
;

58 
ušt64_t
 
	g»u£_chª_cÚ_»cv
;

59 
ušt64_t
 
	g£tup_»cv_šv®id_chªId
;

60 
ušt64_t
 
	g£tup_nÙ_»cv
;

61 
ušt64_t
 
	gcÚÃù_»cv_w™h_chªId
;

62 
ušt64_t
 
	gcÚÃù_»cv
;

63 
ušt64_t
 
	g—¾y_cÚÃù_»cv
;

64 
ušt64_t
 
	gÏ‹_šv™e_»cv
;

65 
ušt64_t
 
	gÿÎ_´oûed_»cv
;

66 
ušt64_t
 
	g»Ëa£_»cv
;

67 
ušt64_t
 
	gdiscÚÃù_»cv
;

68 
ušt64_t
 
	gÿÎ_µed
;

69 
ušt64_t
 
	gmsg_»cv_aá_time
;

72 
ušt32_t
 
	gp_dchª_queue_size
;

79 
ádm_¡©us_t
 
ádm_§ngoma_isdn_p_¡¬t
(
ádm_¥ª_t
 *
¥ª
);

80 
§ngoma_isdn_p_£t_debug
(
¢gisdn_t
 *
´i
, 
debug
);

81 
hªdË_isdn_µšg_log
(
ušt8_t
 
Ëv–
, *
fmt
,...);

82 
ádm_§ngoma_isdn_g‘_sw™ch_ty³
(cÚ¡ *
v®
);

83 
ádm_¡©us_t
 
§ngoma_isdn_p_hªdË_ev’t_cÚ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
);

86 
ádm_¡©us_t
 
§ngoma_isdn_p_is_fchª_šu£
(
¢gisdn_p_t
 *
p
, 
chªÃl
);

87 
ádm_¡©us_t
 
§ngoma_isdn_p_»l_¡®e_ÿÎ
(
¢gisdn_p_t
 *
p
, 
chª_id
);

88 
ádm_¡©us_t
 
§ngoma_isdn_p_hªdË_ev’t_»l
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
üv
);

89 
§ngoma_isdn_p_check_¡®e_cÚevt
(
¢gisdn_p_t
 *
p
);

90 
§ngoma_isdn_p_ä“_hashli¡
(
¢gisdn_p_t
 *
p
);

93 
·ssive_ÿÎ_t
 *
§ngoma_isdn_p_g‘_pÿÎ_bychªId
(
¢gisdn_p_t
 *
p
, 
chª_id
);

96 
ádm_¡©us_t
 
ádm_§ngoma_isdn_p_io_¡©s
(
ádm_¡»am_hªdË_t
 *
¡»am
, 
ádm_¥ª_t
 *
¥ª
, cÚ¡ * 
cmd
);

99 
¢gisdn_p_cÚn_¡©e_t
 
§ngoma_isdn_p_g‘_pÿÎ_¡©e
(
¢gisdn_p_t
 *
p
, 
üv
);

101 
FIO_API_FUNCTION
(
ádm_§ngoma_isdn_p_­i
);

102 
ádm_¡©us_t
 
§ngoma_isdn_»ad_msg
(
¢gisdn_p_t
 *
p
);

117 
	$FIO_IO_UNLOAD_FUNCTION
(
ádm_§ngoma_isdn_p_uÆßd
)

120 if(
g_decod”_lib_š™
) {

121 
	`¢g_decod”_lib_deš™
();

122 
g_decod”_lib_š™
 = 0x00;

124  
FTDM_SUCCESS
;

125 
	}
}

135 
	$FIO_CHANNEL_GET_SIG_STATUS_FUNCTION
(
§ngoma_isdn_p_g‘_chªÃl_sig_¡©us
)

137 ià(
	`ádm_‹¡_æag
(
ádmchª
, 
FTDM_CHANNEL_SIG_UP
)) {

138 *
¡©us
 = 
FTDM_SIG_STATE_UP
;

140 *
¡©us
 = 
FTDM_SIG_STATE_DOWN
;

143 *
¡©us
 = 
FTDM_SIG_STATE_UP
;

144  
FTDM_SUCCESS
;

145 
	}
}

155 
	$FIO_SPAN_GET_SIG_STATUS_FUNCTION
(
§ngoma_isdn_p_g‘_¥ª_sig_¡©us
)

157 *
¡©us
 = 
FTDM_SIG_STATE_UP
;

158  
FTDM_SUCCESS
;

159 
	}
}

169 
	$FIO_CHANNEL_OUTGOING_CALL_FUNCTION
(
§ngoma_isdn_p_outgošg_ÿÎ
)

171 
¢gisdn_p_t
 *
p
 = 
ádmchª
->
¥ª
->
sigÇl_d©a
;

173 iàĞ!
p
 ) {

174 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_ERROR
, "Cannot find‡ssociatedap information, can't dial on‡ ISDNap channel without‡nƒxisting call\n");

175  
FTDM_FAIL
;

178 ià(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

179  
FTDM_SUCCESS
;

180 } ià(
p
->
p_mode
 =ğ
ISDN_TAP_NORMAL
) {

181 
	`ádm_log
(
FTDM_LOG_ERROR
, "Cannot dial on ISDNapping†ine!\n");

182  
FTDM_FAIL
;

184 } ià(
	`ádm_‹¡_æag
(
ádmchª
, 
FTDM_CHANNEL_CALL_STARTED
)) {

185 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_ERROR
, "Call‡lready started?\n");

186  
FTDM_FAIL
;

189  
FTDM_SUCCESS
;

190 
	}
}

199 
	$·r£_debug
(cÚ¡ *
š
)

201 
æags
 = 0;

203 ià(!
š
) {

207 ià(!
	`¡rcmp
(
š
, "none")) {

211 ià(!
	`¡rcmp
(
š
, "all")) {

212  
DEBUG_ALL
;

215 ià(
	`¡r¡r
(
š
, "q921_raw")) {

216 
æags
 |ğ
DEBUG_Q921_RAW
;

219  
æags
;

220 
	}
}

229 
	$FIO_IO_LOAD_FUNCTION
(
ádm_§ngoma_isdn_p_io_š™
)

231 
	`mem£t
(&
ádm_¢gisdn_p_š‹rçû
, 0, (ftdm_sngisdn_tap_interface));

233 
ádm_¢gisdn_p_š‹rçû
.
Çme
 = "isdn_tap";

234 
ádm_¢gisdn_p_š‹rçû
.
­i
 = 
ádm_§ngoma_isdn_p_­i
;

236 *
fio
 = &
ádm_¢gisdn_p_š‹rçû
;

238  
FTDM_SUCCESS
;

239 
	}
}

249 
	$FIO_SIG_LOAD_FUNCTION
(
ádm_§ngoma_isdn_p_š™
)

251  
FTDM_SUCCESS
;

252 
	}
}

259 
ádm_¡©e_m­_t
 
	g¢gisdn_p_¡©e_m­
 = {

262 
ZSD_INBOUND
,

263 
ZSM_UNACCEPTABLE
,

264 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

265 {
FTDM_CHANNEL_STATE_DIALING
, 
FTDM_CHANNEL_STATE_RING
, 
FTDM_CHANNEL_STATE_END
}

268 
ZSD_INBOUND
,

269 
ZSM_UNACCEPTABLE
,

270 {
FTDM_CHANNEL_STATE_DIALING
, 
FTDM_CHANNEL_STATE_END
},

271 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_PROGRESS
, 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_RING
, 
FTDM_CHANNEL_STATE_END
}

274 
ZSD_INBOUND
,

275 
ZSM_UNACCEPTABLE
,

276 {
FTDM_CHANNEL_STATE_RING
, 
FTDM_CHANNEL_STATE_END
},

277 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_PROGRESS
, 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
}

280 
ZSD_INBOUND
,

281 
ZSM_UNACCEPTABLE
,

282 {
FTDM_CHANNEL_STATE_RINGING
, 
FTDM_CHANNEL_STATE_END
},

283 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_PROGRESS
, 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

286 
ZSD_INBOUND
,

287 
ZSM_UNACCEPTABLE
,

288 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_END
},

289 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

292 
ZSD_INBOUND
,

293 
ZSM_UNACCEPTABLE
,

294 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_END
},

295 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

298 
ZSD_INBOUND
,

299 
ZSM_UNACCEPTABLE
,

300 {
FTDM_CHANNEL_STATE_PROGRESS
, 
FTDM_CHANNEL_STATE_END
},

301 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

304 
ZSD_INBOUND
,

305 
ZSM_UNACCEPTABLE
,

306 {
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_END
},

307 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

310 
ZSD_INBOUND
,

311 
ZSM_UNACCEPTABLE
,

312 {
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

313 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_END
},

316 
ZSD_INBOUND
,

317 
ZSM_UNACCEPTABLE
,

318 {
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_END
},

319 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

322 
ZSD_OUTBOUND
,

323 
ZSM_UNACCEPTABLE
,

324 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

325 {
FTDM_CHANNEL_STATE_DIALING
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_END
}

328 
ZSD_OUTBOUND
,

329 
ZSM_UNACCEPTABLE
,

330 {
FTDM_CHANNEL_STATE_DIALING
, 
FTDM_CHANNEL_STATE_END
},

331 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_HANGUP
,

332 
FTDM_CHANNEL_STATE_PROCEED
, 
FTDM_CHANNEL_STATE_RINGING
, 
FTDM_CHANNEL_STATE_PROGRESS
, 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_UP
,

333 
FTDM_CHANNEL_STATE_END
}

336 
ZSD_OUTBOUND
,

337 
ZSM_UNACCEPTABLE
,

338 {
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
, 
FTDM_CHANNEL_STATE_END
},

339 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_HANGUP
,

340 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

343 
ZSD_OUTBOUND
,

344 
ZSM_UNACCEPTABLE
,

345 {
FTDM_CHANNEL_STATE_UP
, 
FTDM_CHANNEL_STATE_END
},

346 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
,

347 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_END
},

350 
ZSD_OUTBOUND
,

351 
ZSM_UNACCEPTABLE
,

352 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_END
},

353 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_END
},

356 
ZSD_OUTBOUND
,

357 
ZSM_UNACCEPTABLE
,

358 {
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_END
},

359 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_END
},

362 
ZSD_OUTBOUND
,

363 
ZSM_UNACCEPTABLE
,

364 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_END
},

365 {
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

368 
ZSD_OUTBOUND
,

369 
ZSM_UNACCEPTABLE
,

370 {
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
, 
FTDM_CHANNEL_STATE_END
},

371 {
FTDM_CHANNEL_STATE_DOWN
, 
FTDM_CHANNEL_STATE_END
},

374 
ZSD_OUTBOUND
,

375 
ZSM_UNACCEPTABLE
,

376 {
FTDM_CHANNEL_STATE_RINGING
, 
FTDM_CHANNEL_STATE_END
},

377 {
FTDM_CHANNEL_STATE_HANGUP
, 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
,

378 
FTDM_CHANNEL_STATE_TERMINATING
, 
FTDM_CHANNEL_STATE_UP
,

379 
FTDM_CHANNEL_STATE_END
},

391 
ádm_¡©us_t
 
	$¡©e_advªû
(
ádm_chªÃl_t
 *
ádmchª
)

393 
¢gisdn_p_t
 *
p
 = 
ádmchª
->
¥ª
->
sigÇl_d©a
;

394 
¢gisdn_p_t
 *
³”p
 = 
NULL
;

395 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

396 
ádm_¡©us_t
 
¡©us
;

397 
ádm_sigmsg_t
 
sigmsg
;

399 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_DEBUG
, "´oûssšg s‹ %s\n", 
	`ádm_chªÃl_¡©e2¡r
(ádmchª->
¡©e
));

401 
	`ádm_chªÃl_com¶‘e_¡©e
(
ádmchª
);

403 ià(!
p
) {

404 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_ERROR
, "No Signal data/tap structure…resent!\n");

405  
FTDM_FAIL
;

408 
	`mem£t
(&
sigmsg
, 0, (sigmsg));

410 
sigmsg
.
chª_id
 = 
ádmchª
->chan_id;

411 
sigmsg
.
¥ª_id
 = 
ádmchª
->span_id;

412 
sigmsg
.
chªÃl
 = 
ádmchª
;

413 
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

416 
ádmchª
->
¡©e
) {

417 
FTDM_CHANNEL_STATE_DOWN
:

419 
ádm_chªÃl_t
 *
fchª
 = 
ádmchª
;

422 ià(
fchª
->
ÿÎ_d©a
) {

423 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

424 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_DEBUG
, "Do‚ot close…eer channel‡s ISDN Tapping is„unning is Bi-Directional mode! %s\n", "");

426 
ádm_chªÃl_t
 *
³”chª
 = 
fchª
->
ÿÎ_d©a
;

427 
ádm_chªÃl_t
 *
pchª
 = 
³”chª
;

429 
	`ádm_chªÃl_lock
(
³”chª
);

431 ià((
pchª
->
ÿÎ_d©a
è&& (((
p
->
p_mode
 =ğ
ISDN_TAP_FS
è&& (pchª->
¡©e
 =ğ
FTDM_CHANNEL_STATE_DOWN
)) ||

432 (
p
->
p_mode
 =ğ
ISDN_TAP_NORMAL
))) {

433 
pchª
->
ÿÎ_d©a
 = 
NULL
;

434 
pchª
->
pæags
 = 0;

436 
	`ádm_log_chª
(
pchª
, 
FTDM_LOG_DEBUG
, "Tapping done..Closing Peer channel. %s\n", "");

437 
	`ádm_chªÃl_şo£
(&
pchª
);

440 
	`ádm_chªÃl_uÆock
(
³”chª
);

443 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_CRIT
, "No call data?\n");

446 
	`ádm_chªÃl_lock
(
ádmchª
);

447 
fchª
->
ÿÎ_d©a
 = 
NULL
;

448 
fchª
->
pæags
 = 0;

449 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_DEBUG
, "Tapping done..Closing channel.%s\n", "");

450 
	`ádm_chªÃl_şo£
(&
fchª
);

451 
	`ádm_chªÃl_uÆock
(
ádmchª
);

455 
FTDM_CHANNEL_STATE_PROGRESS
:

456 
FTDM_CHANNEL_STATE_PROGRESS_MEDIA
:

459 
FTDM_CHANNEL_STATE_UP
:

461 ià(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

462 ià(!
	`ádm_‹¡_æag
(
ádmchª
, 
FTDM_CHANNEL_OUTBOUND
)) {

463 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_INFO
, "Do‚othing‡shis is‡n INBOUND channel!\n");

467 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_bychªId
(
p
, 
ádmchª
->
physiÿl_chª_id
))) {

468 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_DEBUG
, "No…call…resent!\n");

472 ià((
	`ádm_‹¡_pæag
(
ádmchª
, 
ISDN_TAP_NETWORK_ANSWER
)è|| 
	`ádm_‹¡_æag
(ádmchª, 
FTDM_CHANNEL_OUTBOUND
)) {

473 ià(
	`ádm_‹¡_pæag
(
ádmchª
, 
ISDN_TAP_NETWORK_ANSWER
))

474 
	`ádm_ş—r_pæag
(
ádmchª
, 
ISDN_TAP_NETWORK_ANSWER
);

477 
sigmsg
.
ev’t_id
 = 
FTDM_SIGEVENT_UP
;

480 
ÿÎ_µed
++;

482 ià((
¡©us
 = 
	`ádm_¥ª_£nd_sigÇl
(
ádmchª
->
¥ª
, &
sigmsg
è!ğ
FTDM_SUCCESS
)) {

483 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_HANGUP
);

484 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_INFO
, "[C®Ìef- %d]UÇbËØ£nd SIGEVENT_UP!\n", 
pÿÎ
->
ÿÎ»f_v®
);

486 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_INFO
, "[C®Ìef- %d]SIGEVENT_UP S’t!\n", 
pÿÎ
->
ÿÎ»f_v®
);

492 
FTDM_CHANNEL_STATE_RING
:

495 ià(
p
->
p_mode
 !ğ
ISDN_TAP_NORMAL
) {

496 
v¬ŸbË_v®
[3] = { 0 };

497 
ádm_chªÃl_t
 *
³”chª
 = 
NULL
;

499 
sigmsg
.
ev’t_id
 = 
FTDM_SIGEVENT_START
;

501 
³”chª
 = (
ádm_chªÃl_t
*)
ádmchª
->
ÿÎ_d©a
;

502 ifĞ!
³”chª
 ) {

503 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_ERROR
, "Not…eer chan data! \n");

506 
	`ádm_£t_¡ršg
(
³”chª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 
ádmchª
->caller_data.cid_num.digits);

507 
	`ádm_£t_¡ršg
(
³”chª
->
ÿÎ”_d©a
.
cid_Çme
, 
ádmchª
->caller_data.cid_name);

508 
	`ádm_£t_¡ršg
(
³”chª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 
ádmchª
->caller_data.dnis.digits);

509 
	`ádm_£t_¡ršg
(
³”chª
->
ÿÎ”_d©a
.
ªi
.
dig™s
, 
ádmchª
->caller_data.ani.digits);

511 
³”chª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 
ádmchª
->caller_data.call_reference;

516 
	`ádm_sigmsg_add_v¬
(&
sigmsg
, "isdn_p_ršg_š‹rçû", 
	`SNG_ISDN_TAP_GET_INTERFACE
(
³”p
->
içû
));

518 
	`¢´štf
(
v¬ŸbË_v®
, (v¬ŸbË_v®), "%d", 
³”chª
->
¥ª_id
);

519 
	`ádm_sigmsg_add_v¬
(&
sigmsg
, "isdn_p_³”_¥ª", 
v¬ŸbË_v®
);

520 
	`¢´štf
(
v¬ŸbË_v®
, (v¬ŸbË_v®), "%d", 
³”chª
->
chª_id
);

521 
	`ádm_sigmsg_add_v¬
(&
sigmsg
, "isdn_p_³”_chª", 
v¬ŸbË_v®
);

523 ià(
	`ádm_¥ª_£nd_sigÇl
(
³”chª
->
¥ª
, &
sigmsg
è!ğ
FTDM_SUCCESS
) {

524 
	`ádm_£t_¡©e_locked
(
³”chª
, 
FTDM_CHANNEL_STATE_HANGUP
);

527 ià(
sigmsg
.
v¬ŸbËs
) {

528 
	`hashbË_de¡roy
(
sigmsg
.
v¬ŸbËs
);

529 
sigmsg
.
v¬ŸbËs
 = 
NULL
;

535 
FTDM_CHANNEL_STATE_HANGUP
:

537 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Getting into HANGUP state handler \n");

538 if(
p
->
p_mode
 !ğ
ISDN_TAP_NORMAL
) {

539 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_DOWN
);

544 
FTDM_CHANNEL_STATE_HANGUP_COMPLETE
:

546 if(
p
->
p_mode
 !ğ
ISDN_TAP_NORMAL
) {

547 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_DOWN
);

552 
FTDM_CHANNEL_STATE_TERMINATING
:

554 ià(
ádmchª
->
Ï¡_¡©e
 !ğ
FTDM_CHANNEL_STATE_HANGUP
) {

555 
sigmsg
.
ev’t_id
 = 
FTDM_SIGEVENT_STOP
;

556 
	`ádm_ş—r_æag
(
ádmchª
, 
FTDM_CHANNEL_USER_HANGUP
);

557 
¡©us
 = 
	`ádm_¥ª_£nd_sigÇl
(
ádmchª
->
¥ª
, &
sigmsg
);

559 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_DOWN
);

563 
FTDM_CHANNEL_STATE_DIALING
:

564 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

565 ià(
	`ádm_‹¡_æag
(
ádmchª
, 
FTDM_CHANNEL_OUTBOUND
)) {

566 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_RINGING
);

568 
	`ádm_£t_¡©e_locked
(
ádmchª
, 
FTDM_CHANNEL_STATE_RING
);

570 } if(
p
->
p_mode
 =ğ
ISDN_TAP_FS
) {

571 
	`ádm_£t_¡©e
(
ádmchª
, 
FTDM_CHANNEL_STATE_UP
);

575 
FTDM_CHANNEL_STATE_RINGING
:

576 if((
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
è&& (
	`ádm_‹¡_æag
(
ádmchª
, 
FTDM_CHANNEL_OUTBOUND
))) {

578 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_bychªId
(
p
, 
ádmchª
->
physiÿl_chª_id
))) {

579 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_DEBUG
, "No…call…resent!\n");

583 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_DEBUG
, "[C®Ìef- %d] RINGING„eûived fÜ chªÃl\n", 
pÿÎ
->
ÿÎ»f_v®
);

584 ià(
pÿÎ
->
»cv_cÚn
 =ğ
FTDM_TRUE
) {

585 
Ï‹_šv™e_»cv
++;

586 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_DEBUG
, "Changing stateo UP‡s connect is‡lready being…rocessed!\n");

587 
	`ádm_£t_¡©e_locked
(
pÿÎ
->
fchª
, 
FTDM_CHANNEL_STATE_UP
);

589 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_DEBUG
,

591 
	`ádm_chªÃl_¡©e2¡r
(
ádmchª
->
Ï¡_¡©e
), ftdm_chªÃl_¡©e2¡r(ádmchª->
¡©e
));

598 
	`ádm_log_chª
(
ádmchª
, 
FTDM_LOG_DEBUG
, "ignÜšg s‹ chªgäom % tØ%s\n", 
	`ádm_chªÃl_¡©e2¡r
(ádmchª->
Ï¡_¡©e
), ftdm_chªÃl_¡©e2¡r(ádmchª->
¡©e
));

603  
FTDM_SUCCESS
;

604 
	}
}

615 
ádm_¡©us_t
 
	$ámod_isdn_´oûss_ev’t
(
ádm_¥ª_t
 *
¥ª
, 
ádm_ev’t_t
 *
ev’t
)

617 
ádm_®¬m_æag_t
 
®¬mb™s
;

618 
ádm_sigmsg_t
 
sig
;

620 
	`mem£t
(&
sig
, 0, (sig));

621 
sig
.
¥ª_id
 = 
	`ádm_chªÃl_g‘_¥ª_id
(
ev’t
->
chªÃl
);

622 
sig
.
chª_id
 = 
	`ádm_chªÃl_g‘_id
(
ev’t
->
chªÃl
);

623 
sig
.
chªÃl
 = 
ev’t
->channel;

625 
	`ádm_log_chª
(
ev’t
->
chªÃl
, 
FTDM_LOG_DEBUG
, "EVENT:%d Recieved on Span:%d Channel:%d\n",

626 
ev’t
->
’um_id
, 
	`ádm_chªÃl_g‘_¥ª_id
Óv’t->
chªÃl
),

627 
	`ádm_chªÃl_g‘_id
(
ev’t
->
chªÃl
));

629 
ev’t
->
’um_id
) {

630 
FTDM_OOB_ALARM_TRAP
:

632 
sig
.
ev’t_id
 = 
FTDM_OOB_ALARM_TRAP
;

633 ià(
	`ádm_chªÃl_g‘_¡©e
(
ev’t
->
chªÃl
è!ğ
FTDM_CHANNEL_STATE_DOWN
) {

634 
	`ádm_£t_¡©e_locked
(
ev’t
->
chªÃl
, 
FTDM_CHANNEL_STATE_RESTART
);

636 
	`ádm_£t_æag
(
ev’t
->
chªÃl
, 
FTDM_CHANNEL_SUSPENDED
);

637 
	`ádm_chªÃl_g‘_®¬ms
(
ev’t
->
chªÃl
, &
®¬mb™s
);

638 
	`ádm_¥ª_£nd_sigÇl
(
¥ª
, &
sig
);

640 
	`ádm_log
(
FTDM_LOG_WARNING
, "channel %d:%d (%d:%d) has‡larms [%s]\n",

641 
	`ádm_chªÃl_g‘_¥ª_id
(
ev’t
->
chªÃl
),

642 
	`ádm_chªÃl_g‘_id
(
ev’t
->
chªÃl
),

643 
	`ádm_chªÃl_g‘_ph_¥ª_id
(
ev’t
->
chªÃl
),

644 
	`ádm_chªÃl_g‘_ph_id
(
ev’t
->
chªÃl
),

645 
	`ádm_chªÃl_g‘_Ï¡_”rÜ
(
ev’t
->
chªÃl
));

649 
FTDM_OOB_ALARM_CLEAR
:

651 
sig
.
ev’t_id
 = 
FTDM_OOB_ALARM_CLEAR
;

652 
	`ádm_ş—r_æag
(
ev’t
->
chªÃl
, 
FTDM_CHANNEL_SUSPENDED
);

653 
	`ádm_chªÃl_g‘_®¬ms
(
ev’t
->
chªÃl
, &
®¬mb™s
);

654 
	`ádm_¥ª_£nd_sigÇl
(
¥ª
, &
sig
);

662  
FTDM_SUCCESS
;

663 
	}
}

672 
	$§ngoma_isdn_p_check_¡©e
(
ádm_¥ª_t
 *
¥ª
)

674 ià(
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_STATE_CHANGE
)) {

675 
ušt32_t
 
j
;

676 
	`ádm_ş—r_æag_locked
(
¥ª
, 
FTDM_SPAN_STATE_CHANGE
);

677 
j
 = 1; j <ğ
¥ª
->
chª_couÁ
; j++) {

678 
	`ádm_chªÃl_lock
(
¥ª
->
chªÃls
[
j
]);

679 
	`ádm_chªÃl_advªû_¡©es
(
¥ª
->
chªÃls
[
j
]);

680 
	`ádm_chªÃl_uÆock
(
¥ª
->
chªÃls
[
j
]);

683 
	}
}

692 
	$§ngoma_isdn_io_»ad
(
¢gisdn_t
 *
isdn_msg
, *
buf
, 
buæ’
)

694 
»s
 = 0;

695 
ádm_¡©us_t
 
z¡
;

696 
¢gisdn_p_t
 *
p
 = 
	`§ngoma_isdn_g‘_u£rd©a
(
isdn_msg
);

697 
ádm_size_t
 
Ën
 = 
buæ’
;

700 ià((
z¡
 = 
	`ádm_chªÃl_»ad
(
p
->
dchª
, 
buf
, &
Ën
)è!ğ
FTDM_SUCCESS
) {

701 ià(
z¡
 =ğ
FTDM_FAIL
) {

702 
	`ádm_log
(
FTDM_LOG_CRIT
, "S·À%d D chªÃÈ»ad fa! [%s]\n", 
p
->
¥ª
->
¥ª_id
,­->
dchª
->
Ï¡_”rÜ
);

704 
	`ádm_log
(
FTDM_LOG_CRIT
, "S·À%d D chªÃÈ»adimeout!\n", 
p
->
¥ª
->
¥ª_id
);

706  
»s
;

710 
»s
 = ()
Ën
;

713 ià(
p
->
debug
 & 
DEBUG_Q921_RAW
) {

714 
hbuf
[2048] = { 0 };

716 
	`´št_hex_by‹s
(
buf
, 
Ën
, 
hbuf
, (hbuf));

717 
	`ádm_log_chª
(
p
->
dchª
, 
FTDM_LOG_DEBUG
, "READ %"
FTDM_SIZE_FMT
"\n%s\n", 
Ën
, 
hbuf
);

720  
»s
;

721 
	}
}

731 
·ssive_ÿÎ_t
 *
	$§ngoma_isdn_p_g‘_pÿÎ_byüv
(
¢gisdn_p_t
 *
p
, 
üv
)

733 
i
;

734 
t¡üv
;

736 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

740 
i
 = 0; i < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); i++) {

741 
t¡üv
 = 
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
;

742 ià(
t¡üv
 =ğ
üv
) {

743 ià(
p
->
pÿÎs
[
i
].
šu£
) {

744 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

745  &
p
->
pÿÎs
[
i
];

749 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Found crv %d in slot %d of span %s with call %d but is‚o†onger in use\n",

750 
üv
, 
i
, 
p
->
¥ª
->
Çme
,­->
pÿÎs
[i].
ÿÎ»f_v®
);

754 
	`ádm_log
(
FTDM_LOG_DEBUG
, "C®È»ã»nû v®u%d‚Ù found‡ùivš s·À%s\n", 
üv
, 
p
->
¥ª
->
Çme
);

755 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

756  
NULL
;

757 
	}
}

766 
·ssive_ÿÎ_t
 *
	$§ngoma_isdn_p_g‘_pÿÎ_bychªId
(
¢gisdn_p_t
 *
p
, 
chª_id
)

768 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

769 
idx
 = 0;

771 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

775 
idx
 = 0; idx < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); idx++) {

776 
fchª
 = 
p
->
pÿÎs
[
idx
].fchan;

778 ià(!
fchª
) {

782 ià(
chª_id
 =ğ
fchª
->
physiÿl_chª_id
) {

783 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

784  &
p
->
pÿÎs
[
idx
];

788 
	`ádm_log
(
FTDM_LOG_DEBUG
, "pÿÎ w™h…hysiÿÈchªÃÈ%d‚Ù…»£Á‡ˆ®l\n", 
chª_id
);

789 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

791  
NULL
;

792 
	}
}

803 
·ssive_ÿÎ_t
 *
	$§ngoma_isdn_p_g‘_nçs_pÿÎ_byüv
(
¢gisdn_p_t
 **
p
, 
üv
)

805 
¢gisdn_p_t
 *
ÿÎ_p
 = 
NULL
;

806 
¢gisdn_p_t
 *
sig_p
 = 
NULL
;

807 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

808 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

809 
idx
 = 0;

811 ià(!
p
) {

812 
	`ádm_log
(
FTDM_LOG_ERROR
, "Invalidap value\n");

813  
NULL
;

816 
sig_p
 = *
p
;

818 
idx
 = 0; idx < 
sig_p
->
nçs
.
Œunk
->
num_p_¥ªs
; idx++) {

819 ià(!
sig_p
->
nçs
.
Œunk
->
p_¥ªs
[
idx
]) {

820 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s Callref- %d]No ISDN NFAS Tap span found‡t index %d\n",

821 
sig_p
->
¥ª
->
Çme
, 
üv
, 
idx
);

822  
NULL
;

825 
¥ª
 = 
sig_p
->
nçs
.
Œunk
->
p_¥ªs
[
idx
];

826 
ÿÎ_p
 = 
¥ª
->
sigÇl_d©a
;

828 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
ÿÎ_p
, 
üv
);

830 ià(
pÿÎ
) {

831 *
p
 = 
ÿÎ_p
;

833 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d]Found…call‡t index %d\n",

834 
ÿÎ_p
->
¥ª
->
Çme
, 
üv
, 
idx
);

835  
pÿÎ
;

839  
NULL
;

840 
	}
}

850 
·ssive_ÿÎ_t
 *
	$§ngoma_isdn_p_g‘_pÿÎ
(
¢gisdn_p_t
 *
p
, *
ÿÎ»f
)

852 
i
;

853 
üv
 = 0;

854 *
tmp_üv
 = 
NULL
;

855 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

857 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

860 
i
 = 0; i < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); i++) {

861 ià(
ÿÎ»f
) {

862 
tmp_üv
 = (*)
ÿÎ»f
;

863 
üv
 = *
tmp_üv
;

866 ià(
üv
 =ğ
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
) {

867 ià(
ÿÎ»f
 =ğ
NULL
) {

868 
p
->
pÿÎs
[
i
].
šu£
 = 1;

869 
	`ádm_log
(
FTDM_LOG_DEBUG
, "EÇblšg c®Ìeà¦Ù %d iÀ¥ª %s\n", 
i
, 
p
->
¥ª
->
Çme
);

870 } ià(!
p
->
pÿÎs
[
i
].
šu£
) {

871 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Recyclying callref slot %d in span %s for callref %d/%p\n",

872 
i
, 
p
->
¥ª
->
Çme
, 
üv
, 
ÿÎ»f
);

873 
	`mem£t
(&
p
->
pÿÎs
[
i
], 0, (tap->pcalls[0]));

875 
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
 = 
üv
;

876 
p
->
pÿÎs
[
i
].
šu£
 = 1;

879 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

880 
pÿÎ
 = &
p
->
pÿÎs
[
i
];

881  
pÿÎ
;

885 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

886  
NULL
;

887 
	}
}

889 
	$§ngoma_isdn_p_´št_pÿÎ
(
¢gisdn_p_t
 *
p
)

891 
·ssive_ÿÎ_t
* 
pÿÎ
 = 
NULL
;

892 
i
 = 0;

894 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

897 
i
 = 0; i < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); i++) {

898 
pÿÎ
 = &
p
->
pÿÎs
[
i
];

899 ià(
pÿÎ
) {

900 
	`ádm_log
(
FTDM_LOG_INFO
, "PÿÎ…»£Á‡ˆ¦Ù %d w™h c®È»ã»nû v®ua %d\n", 
i
, 
p
->
pÿÎs
[i].
ÿÎ»f_v®
);

905 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

906 
	}
}

916 
	$§ngoma_isdn_p_put_pÿÎ
(
¢gisdn_p_t
 *
p
, *
ÿÎ»f
)

918 
i
;

919 
üv
;

920 
t¡üv
;

921 *
tmp_üv
 = 
ÿÎ»f
;

923 ià(!
ÿÎ»f
) {

924 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s] CªnÙ…uˆpÿÎ fÜ‚uÎ c®Ìef\n", 
p
->
¥ª
->
Çme
);

928 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

931 
üv
 = *
tmp_üv
;

935 
i
 = 0; i < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); i++) {

936 ià(!
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
) {

939 
t¡üv
 = 
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
;

941 ià(
t¡üv
 =ğ
üv
) {

942 ià(
p
->
pÿÎs
[
i
].
šu£
) {

943 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Releasing slot %d\n",

944 
p
->
¥ª
->
Çme
,­->
pÿÎs
[
i
].
chªId
,­->pÿÎs[i].
ÿÎ»f_v®
, i);

945 
	`§ngoma_isdn_p_»£t_pÿÎ
(&
p
->
pÿÎs
[
i
]);

946 
p
->
pÿÎs
[
i
].
šu£
 = 0;

951 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

952 
	}
}

961 
ádm_¡©us_t
 
	$§ngoma_isdn_p_»£t_pÿÎ
(
·ssive_ÿÎ_t
 *
pÿÎ
)

963 ià(!
pÿÎ
) {

964 
	`ádm_log
(
FTDM_LOG_ERROR
, "Invalid…callo clear\n");

965  
FTDM_FAIL
;

968 
	`ádm_log
(
FTDM_LOG_INFO
, "Resetting Pcall \n");

970 
pÿÎ
->
ÿÎ»f_v®
 = 0;

971 
pÿÎ
->
»cv_£tup
 = 
FTDM_FALSE
;

972 
pÿÎ
->
chª_´es
 = 
FTDM_FALSE
;

973 
pÿÎ
->
»cv_cÚn
 = 
FTDM_FALSE
;

974 
pÿÎ
->
»cv_Ùh”_msg
 = 
FTDM_FALSE
;

975 
pÿÎ
->
ršg_ev’t_£Á
 = 
FTDM_FALSE
;

976 
pÿÎ
->
fchª
 = 
NULL
;

977 
pÿÎ
->
chªId
 = 0;

978 
pÿÎ
->
t_£tup_»cv
 = 
	`time
(
NULL
);

979 
pÿÎ
->
t_cÚ_»cv
 = 
	`time
(
NULL
);

980 
pÿÎ
->
t_msg_»cv
 = 
	`time
(
NULL
);

981 
	`mem£t
(&
pÿÎ
->
ÿÎšgnum
.
dig™s
, 0, (pcall->callingnum.digits));

982 
	`mem£t
(&
pÿÎ
->
ÿÎednum
.
dig™s
, 0, (pcall->callednum.digits));

983 
	`mem£t
(&
pÿÎ
->
ÿÎšgnum
, 0, (pcall->callingnum));

984 
	`mem£t
(&
pÿÎ
->
ÿÎednum
, 0, (pcall->callednum));

985 
pÿÎ
->
p_msg
.
chª_id
 = 0;

986 
pÿÎ
->
p_msg
.
¥ª_id
 = 0;

987 
pÿÎ
->
p_msg
.
ÿÎ_»f
 = 0;

988 
pÿÎ
->
p_msg
.
ÿÎ_dœ
 = 
CALL_DIRECTION_NONE
;

989 
pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 0;

990 
	`mem£t
(&
pÿÎ
->
p_msg
.
ÿÎšg_num
, 0, (pcall->tap_msg.calling_num));

991 
	`mem£t
(&
pÿÎ
->
p_msg
.
ÿÎed_num
, 0, (pcall->tap_msg.called_num));

992 
	`mem£t
(&
pÿÎ
->
p_msg
, 0, (pcall->tap_msg));

993 
	`mem£t
(&
pÿÎ
->
p_msg
, 0, (pcall->tap_msg));

995  
FTDM_SUCCESS
;

996 
	}
}

1006 
ádm_¡©us_t
 
	$§ngoma_isdn_p_is_cÚ_»cv
(
¢gisdn_p_t
 *
p
, 
üv
, 
ušt8_t
 
msgTy³
)

1008 
ÿÎ_»f
[25];

1009 
ádm_¡©us_t
 
»t
 = 
FTDM_FAIL
;

1010 
cÚ_ÿÎ_šfo_t
 *
ÿÎ_šfo
 = 
NULL
;

1012 
	`mem£t
(
ÿÎ_»f
, 0 , (call_ref));

1014 
	`¥rštf
(
ÿÎ_»f
, "%d", 
üv
);

1016 
ÿÎ_šfo
 = 
	`hashbË_£¬ch
(
p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
);

1018 ià(
ÿÎ_šfo
) {

1019 ià(
ÿÎ_šfo
->
p_´oûed
) {

1020 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s Callref- %d] Call found in hashable for whichapping is‡lready started\n",

1021 
p
->
¥ª
->
Çme
, 
üv
);

1022 
»t
 = 
FTDM_BREAK
;

1024 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s Callref- %d] Call found in hashable for which connect is‡lready„eceived\n",

1025 
p
->
¥ª
->
Çme
, 
üv
);

1026 
»t
 = 
FTDM_SUCCESS
;

1029 ià((
msgTy³
 =ğ
Q931_DISCONNECT
è|| (msgTy³ =ğ
Q931_RELEASE
)) {

1030 
	`ádm_log
(
FTDM_LOG_INFO
, "[% C®Ìef- %d] C®Èfound fÜ whichh”i nØSETUP\n", 
p
->
¥ª
->
Çme
, 
üv
);

1031 
£tup_nÙ_»cv
++;

1032 } ià(
msgTy³
 !ğ
Q931_SETUP
) {

1033 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s Callref- %d] Call found‡lready in hash†ist for message %s\n",

1034 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1035  
»t
;

1038 
	`hashbË_»move
(
p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
);

1039 
	`ádm_§ã_ä“
(
ÿÎ_šfo
);

1042  
»t
;

1043 
	}
}

1045 
¢gisdn_p_cÚn_¡©e_t
 
	$§ngoma_isdn_p_g‘_pÿÎ_¡©e
(
¢gisdn_p_t
 *
p
, 
üv
)

1047 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1048 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

1052 ià(
p
->
p_mode
 !ğ
ISDN_TAP_FS
)

1053  
PCALL_CONN
;

1056 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

1057 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

1059 ià((
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

1060 iàĞ(
pÿÎ
->
ršg_ev’t_£Á
 =ğ
FTDM_TRUE
è&& (pÿÎ->
»cv_cÚn
 != FTDM_TRUE) ) {

1061  
PCALL_RING
;

1064 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s Callref- %d] We cannot find…call forhe„efernceo get call state\n",

1065 
p
->
¥ª
->
Çme
, 
üv
);

1068  
PCALL_CONN
;

1069 
	}
}

1079 
	$§ngoma_isdn_p_check_¡®e_ÿÎ
(
¢gisdn_p_t
 *
p
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
, 
ušt8_t
 
msgTy³
)

1081 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1091 ià(
FTDM_SUCCESS
 =ğ
	`§ngoma_isdn_p_is_fchª_šu£
(
p
, 
štfCb
->
chª_id
)) {

1092 ià(
FTDM_FAIL
 =ğ
	`§ngoma_isdn_p_»l_¡®e_ÿÎ
(
p
, 
štfCb
->
chª_id
)) {

1093 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d] NÙ‡bËØ»Ëa£ STALE C®l\n", 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
);

1097 ià(
FTDM_SUCCESS
 =ğ
	`§ngoma_isdn_p_is_fchª_šu£
(
³”p
, 
štfCb
->
chª_id
)) {

1098 ià(
FTDM_FAIL
 =ğ
	`§ngoma_isdn_p_»l_¡®e_ÿÎ
(
³”p
, 
štfCb
->
chª_id
)) {

1100 
	`ádm_log
(
FTDM_LOG_CRIT
, "[%s:%d] NÙ‡bËØ»Ëa£…“¸STALE C®l\n", 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
);

1105 ià(
msgTy³
 !ğ
Q931_CONNECT
) {

1106 
	`ádm_log
(
FTDM_LOG_INFO
, "[% C®Ìef- %d] Check fÜ CÚÃùiÚ„eûived SË C®l\n", 
p
->
¥ª
->
Çme
, 
üv
);

1107 
	`§ngoma_isdn_p_check_¡®e_cÚevt
(
p
);

1109 
	}
}

1118 
	$§ngoma_isdn_p_»£t_pÿÎ_bychªId
(
¢gisdn_p_t
 *
p
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
)

1120 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

1121 
i
 = 0;

1123 
	`ádm_mu‹x_lock
(
p
->
pÿÎs_lock
);

1126 
i
 = 0; i < 
	`ádm_¬¿y_Ën
(
p
->
pÿÎs
); i++) {

1127 
pÿÎ
 = &
p
->
pÿÎs
[
i
];

1128 ià(
pÿÎ
) {

1129 ià(
pÿÎ
->
chªId
 =ğ
štfCb
->
chª_id
) {

1130 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Found…call…resent‡t slot %d\n",

1131 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
,­->
pÿÎs
[
i
].
ÿÎ»f_v®
, i);

1133 
	`ádm_log
(
FTDM_LOG_DEBUG
, " [%s:%d Callref- %d] Releasing slot %d\n",

1134 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
,­->
pÿÎs
[
i
].
ÿÎ»f_v®
, i);

1136 ià(
p
->
pÿÎs
[
i
].
fchª
) {

1137 
	`ádm_log_chª
(
p
->
pÿÎs
[
i
].
fchª
, 
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Got channel on Stale…call with channel state‡s %s\n",

1138 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
,­->
pÿÎs
[
i
].
ÿÎ»f_v®
, 
	`ádm_chªÃl_¡©e2¡r
Ñ­->pÿÎs[i].
fchª
->
¡©e
));

1141 
p
->
pÿÎs
[
i
].
šu£
 = 0;

1142 
p
->
pÿÎs
[
i
].
ÿÎ»f_v®
 = 0;

1143 
p
->
pÿÎs
[
i
].
fchª
 = 
NULL
;

1144 
p
->
pÿÎs
[
i
].
t_£tup_»cv
 = 
	`time
(
NULL
);

1145 
p
->
pÿÎs
[
i
].
t_cÚ_»cv
 = 
	`time
(
NULL
);

1146 
p
->
pÿÎs
[
i
].
t_msg_»cv
 = 
	`time
(
NULL
);

1147 
p
->
pÿÎs
[
i
].
»cv_£tup
 = 
FTDM_FALSE
;

1148 
p
->
pÿÎs
[
i
].
»cv_cÚn
 = 
FTDM_FALSE
;

1149 
p
->
pÿÎs
[
i
].
»cv_Ùh”_msg
 = 
FTDM_FALSE
;

1150 
p
->
pÿÎs
[
i
].
ršg_ev’t_£Á
 = 
FTDM_FALSE
;

1151 
p
->
pÿÎs
[
i
].
chª_´es
 = 
FTDM_FALSE
;

1152 
p
->
pÿÎs
[
i
].
chªId
 = 0;

1153 
	`mem£t
(&
p
->
pÿÎs
[
i
].
ÿÎšgnum
.
dig™s
, 0, (tap->pcalls[i].callingnum.digits));

1154 
	`mem£t
(&
p
->
pÿÎs
[
i
].
ÿÎednum
.
dig™s
, 0, (tap->pcalls[i].callednum.digits));

1155 
	`mem£t
(&
p
->
pÿÎs
[
i
].
ÿÎšgnum
, 0, (tap->pcalls[i].callingnum));

1156 
	`mem£t
(&
p
->
pÿÎs
[
i
].
ÿÎednum
, 0, (tap->pcalls[i].callednum));

1160 
pÿÎ
 = 
NULL
;

1163 
	`ádm_mu‹x_uÆock
(
p
->
pÿÎs_lock
);

1164 
	}
}

1174 
	$§ngoma_isdn_p_check_¡®e_cÚevt
(
¢gisdn_p_t
 *
p
)

1176 
ádm_hash_™”©Ü_t
 *
idx
 = 
NULL
;

1177 
cÚ_ÿÎ_šfo_t
 *
ÿÎ_šfo
 = 
NULL
;

1178 cÚ¡ *
key
 = 
NULL
;

1179 *
v®
 = 
NULL
;

1180 
ÿÎ_»f
[25];

1181 
time_t
 
cu¼_time
 = 
	`time
(
NULL
);

1185 
idx
 = 
	`hashbË_fœ¡
(
p
->
³nd_ÿÎ_l¡
); idx; idx = 
	`hashbË_Ãxt
(idx)) {

1186 
	`hashbË_this
(
idx
, &
key
, 
NULL
, &
v®
);

1187 ià(!
key
 || !
v®
) {

1191 
cu¼_time
 = 
	`time
(
NULL
);

1193 
ÿÎ_šfo
 = (
cÚ_ÿÎ_šfo_t
*)
v®
;

1194 
	`time
(&
cu¼_time
);

1196 ià(
	`difáime
(
cu¼_time
, 
ÿÎ_šfo
->
cÚ»cv_time
è>ğ
SNG_TAP_STALE_TME_DURATION
) {

1197 
	`mem£t
(
ÿÎ_»f
, 0, (call_ref));

1198 
	`¥rštf
(
ÿÎ_»f
, "%d", 
ÿÎ_šfo
->
ÿÎ»f_v®
);

1200 
	`ádm_log
(
FTDM_LOG_CRIT
, "[% C®Ìef- %d] Removšg SË c®Èa found oÃ iÀCONNECT hash†i¡.\n", 
p
->
¥ª
->
Çme
, 
ÿÎ_šfo
->
ÿÎ»f_v®
);

1201 
	`hashbË_»move
(
p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
);

1202 
	`ádm_§ã_ä“
(
ÿÎ_šfo
);

1205 
	}
}

1214 
ádm_chªÃl_t
* 
	$§ngoma_isdn_p_g‘_fchª_by_chªid
(
¢gisdn_p_t
 *
p
, 
chªÃl
)

1216 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

1217 
idx
 = 0;

1218 
ušt16_t
 
chªpos
 = 
	`SNG_ISDN_CHANNEL
(
chªÃl
);

1220 ià(!
p
 || !
chªÃl
) {

1221 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id chªÃÈ%d o¸°poš‹¸\n", 
chªÃl
);

1222  
NULL
;

1225 ià(!
chªpos
 || (chªpo > 
p
->
¥ª
->
chª_couÁ
)) {

1226 
	`ádm_log
(
FTDM_LOG_ERROR
, "Invalid channel %d‡s‡gainst chanpos %d ,chan_count %d„equested in span %s\n",

1227 
chªÃl
, 
chªpos
, 
p
->
¥ª
->
chª_couÁ
,p->¥ª->
Çme
);

1228  
NULL
;

1232 
idx
 = 1; idx < 128; idx++) {

1233 
fchª
 = 
p
->
¥ª
->
chªÃls
[
	`SNG_ISDN_CHANNEL
(
idx
)];

1235 ià((
fchª
 =ğ
NULL
è|| (fchª->
physiÿl_chª_id
 =ğ
chªÃl
)) {

1240 ià(!
fchª
) {

1241 
	`ádm_log
(
FTDM_LOG_ERROR
, "ChªÃÈ%d„eque¡ed oÀ¥ª % nÙ found\n", 
chªÃl
, 
p
->
¥ª
->
Çme
);

1242  
NULL
;

1245  
fchª
;

1246 
	}
}

1255 
ádm_¡©us_t
 
	$§ngoma_isdn_p_is_fchª_šu£
(
¢gisdn_p_t
 *
p
, 
chªÃl
)

1257 
ádm_¡©us_t
 
»t
 = 
FTDM_FAIL
;

1258 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

1260 
	`ádm_log
(
FTDM_LOG_INFO
, "G‘tšg chªÃÈ%d stus\n", 
chªÃl
);

1262 ià(
NULL
 =ğ(
fchª
 = 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
p
, 
chªÃl
))) {

1263  
»t
;

1266 
	`ádm_chªÃl_lock
(
fchª
);

1269 ià((
	`ádm_‹¡_æag
(
fchª
, 
FTDM_CHANNEL_INUSE
)è|| (ádm_‹¡_æag(fchª, 
FTDM_CHANNEL_OPEN
))) {

1270 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_INFO
, "ChªÃÈi İ’ o¸š u£..¡©e[%s]\n", 
	`ádm_chªÃl_¡©e2¡r
(fchª->
¡©e
));

1271 
»t
 = 
FTDM_SUCCESS
;

1275 ià((
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
è&& (
»t
 !ğ
FTDM_SUCCESS
)) {

1276 ià((
fchª
->
¡©e
 !ğ
FTDM_CHANNEL_STATE_DOWN
è&& (fchª->¡©< 
FTDM_CHANNEL_STATE_TERMINATING
)) {

1277 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_INFO
, "ChªÃÈš s‹ [%s]. PËa£„–—£hi chªÃl!\n", 
	`ádm_chªÃl_¡©e2¡r
(fchª->
¡©e
));

1278 
»t
 = 
FTDM_SUCCESS
;

1279 } ià(
fchª
->
¡©e
 =ğ
FTDM_CHANNEL_STATE_HANGUP
) {

1280 
	`ádm_log_chª_msg
(
fchª
, 
FTDM_LOG_INFO
, "Channel is in HANGUP state…lease move channelo DOWN state\n");

1281 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_DOWN
);

1282 
»t
 = 
FTDM_SUCCESS
;

1286 
	`ádm_chªÃl_uÆock
(
fchª
);

1288  
»t
;

1289 
	}
}

1298 
__šlše__
 
ádm_chªÃl_t
 *
	$§ngoma_isdn_p_g‘_fchª
(
¢gisdn_p_t
 *
p
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
chªÃl
, 
fÜû_ş—r_chª
, 
İ’
)

1300 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

1301 
”r
 = 0;

1303 
fchª
 = 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
p
, 
chªÃl
);

1304 ià(!
fchª
) {

1305 
”r
 = 1;

1306 
dÚe
;

1309 
	`ádm_chªÃl_lock
(
fchª
);

1311 ià(
	`ádm_‹¡_æag
(
fchª
, 
FTDM_CHANNEL_INUSE
)) {

1312 
»u£_chª_cÚ_»cv
++;

1313 ià(
fÜû_ş—r_chª
) {

1314 
	`ádm_ş—r_æag
(
fchª
, 
FTDM_CHANNEL_INUSE
);

1316 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_ERROR
, "ChªÃÈi ®»ady iÀu£ ..¡©e[%s]\n", 
	`ádm_chªÃl_¡©e2¡r
(fchª->
¡©e
));

1317 
”r
 = 1;

1318 
dÚe
;

1322 iàĞ(
p
->
p_mode
 = 
ISDN_TAP_FS
è&& (!
İ’
) )

1323 
dÚe
;

1325 ià(
	`ádm_chªÃl_İ’_chª
(
fchª
è!ğ
FTDM_SUCCESS
) {

1326 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_ERROR
, "Could‚ot openap channel %s\n","");

1327 
”r
 = 1;

1328 
dÚe
;

1330 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_DEBUG
, "Tap channel openned successfully \n %s","");

1332 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 0, (fchan->caller_data.cid_num.digits));

1333 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 0, (fchan->caller_data.dnis.digits));

1334 
	`mem£t
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 0, (fchan->caller_data.cid_name));

1335 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 0;

1337 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 
pÿÎ
->
ÿÎšgnum
.digits);

1338 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 
pÿÎ
->
ÿÎšgnum
.
dig™s
);

1339 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 
pÿÎ
->
ÿÎednum
.digits);

1340 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
ªi
.
dig™s
, 
pÿÎ
->
ÿÎšgnum
.digits);

1341 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 
pÿÎ
->
ÿÎ»f_v®
;

1343 
dÚe
:

1344 ià(
fchª
) {

1345 
	`ádm_chªÃl_uÆock
(
fchª
);

1348 ià(
”r
) {

1349  
NULL
;

1352  
fchª
;

1353 
	}
}

1363 
	$£nd_´ÙocŞ_¿w_d©a
(
isdn_p_msg_šfo_t
 *
d©a
, 
ádm_chªÃl_t
 *
ádmchª
)

1365 *
myd©a
;

1366 
ádm_sigmsg_t
 
sig
;

1368 
	`ádm_as£¹
(
d©a
, "Invalid…rotocol„aw data…ointer. \n");

1369 
	`ádm_as£¹
(
ádmchª
, "Invalid ftdm channel…ointer. \n");

1371 
	`mem£t
(&
sig
, 0, (
ádm_sigmsg_t
));

1372 
sig
.
ev’t_id
 = 
FTDM_SIGEVENT_RAW
;

1373 
sig
.
chªÃl
 = 
ádmchª
;

1375 
myd©a
 = 
	`ádm_m®loc
((
isdn_p_msg_šfo_t
));

1376 
	`ádm_as£¹
(
myd©a
, "Failedo‡llocate memory\n");

1377 
	`memıy
(
myd©a
, 
d©a
, (
isdn_p_msg_šfo_t
));

1379 
	`ádm_sigmsg_£t_¿w_d©a
(&
sig
, 
myd©a
, (
isdn_p_msg_šfo_t
));

1381 ià(
	`ádm_¥ª_£nd_sigÇl
(
ádmchª
->
¥ª
, &
sig
è!ğ
FTDM_SUCCESS
) {

1382 
	`ádm_log_chª_msg
(
ádmchª
, 
FTDM_LOG_CRIT
, "Failedo send„aw dataƒvento user \n");

1384 
	}
}

1394 
	$hªdË_isdn_·ssive_ev’t
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
)

1396 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1397 
ádm_boŞ_t
 
is_cÚ_»cv
 = 
FTDM_FALSE
;

1398 
ádm_¡©us_t
 
¡©us
 = 
FTDM_FAIL
;

1399 
¢gisdn_p_t
 *
tmp_p
 = 
NULL
;

1400 
time_t
 
cu¼_time
 = 
	`time
(
NULL
);

1401 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

1402 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

1403 
üv
 = 0;

1405 ià(!
štfCb
) {

1406 
	`ádm_log
(
FTDM_LOG_ERROR
, "handle_isdn_passive_event failed.Invalid intfCb \n");

1410 
üv
 = 
štfCb
->
ÿÎ_»f
;

1412 ià(
štfCb
->
chª_id
) {

1413 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Channel Id…resent for message %s\n",

1414 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1417 ià(
p
->
nçs
.
Œunk
) {

1418 ià((
štfCb
->
š‹rçû_id
 < 0è&& (štfCb->
chª_id
)) {

1419 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Invalid Interface ID %d for message %s\n",

1420 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, iÁfCb->
š‹rçû_id
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1424 ià(
štfCb
->
š‹rçû_id
 > -1) {

1425 ià(!
p
->
nçs
.
Œunk
->
p_¥ªs
[
štfCb
->
š‹rçû_id
]) {

1426 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] NFAS group %s does‚ot have†ogical span ID %d for message %s\n",

1427 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
,­->
nçs
.
Œunk
->Çme, iÁfCb->
š‹rçû_id
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1430 
¥ª
 = 
p
->
nçs
.
Œunk
->
p_¥ªs
[
štfCb
->
š‹rçû_id
];

1432 
p
 = 
¥ª
->
sigÇl_d©a
;

1433 
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1436 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_nçs_pÿÎ_byüv
(&
p
, 
üv
);

1437 ià(!
pÿÎ
) {

1438 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_nçs_pÿÎ_byüv
(&
³”p
, 
üv
);

1439 ià(!
pÿÎ
) {

1440 
msgTy³
) {

1441 
Q931_SETUP
:

1442 
Q931_SETUP_ACK
:

1443 
Q931_PROGRESS
:

1444 
Q931_PROCEEDING
:

1445 
Q931_ALERTING
:

1446 
Q931_INFORMATION
:

1447 
Q931_CONNECT
:

1448 
Q931_DISCONNECT
:

1449 
Q931_RELEASE
:

1450 
	`ádm_log
(
FTDM_LOG_NOTICE
, "[%s Callref- %d] Noap/span found for %s message\n",

1451 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1458 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[% C®Ìef- %d] C®Èfound oÀ°³”¥ª\n", 
³”p
->
¥ª
->
Çme
, 
üv
);

1460 
p
 = 
³”p
->
³”¥ª
->
sigÇl_d©a
;

1462 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[% C®Ìef- %d] C®Èfound oÀ°¥ª\n", 
p
->
¥ª
->
Çme
, 
üv
);

1464 
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1468 
pÿÎ
 = 
NULL
;

1470 
msgTy³
) {

1471 
Q931_SETUP
:

1473 ià(!
štfCb
->
chª_id
) {

1474 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Invalid Channel found in setup message\n",

1475 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1476 
£tup_»cv_šv®id_chªId
++;

1482 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Call SETUP„ecieved\n",

1483 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1486 
£tup_»cv
++;

1487 
¡©us
 = 
	`§ngoma_isdn_p_is_cÚ_»cv
(
p
, 
üv
, 
msgTy³
);

1488 ià(
¡©us
 =ğ
FTDM_SUCCESS
) {

1489 
is_cÚ_»cv
 = 
FTDM_TRUE
;

1490 } ià(
¡©us
 =ğ
FTDM_BREAK
) {

1491 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, &
üv
);

1492 ià(
pÿÎ
) {

1495 
	`time
(&
cu¼_time
);

1496 ià(!(
	`difáime
(
cu¼_time
, 
pÿÎ
->
t_cÚ_»cv
è> 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
)) {

1497 
is_cÚ_»cv
 = 
FTDM_FALSE
;

1498 
dÚe
;

1500 
msg_»cv_aá_time
++;

1501 
	`ádm_log
(
FTDM_LOG_DEBUG
,

1503 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
);

1506 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Pcall‚ot found for whichapping is‡lready started\n",

1507 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1515 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
);

1516 ià(
pÿÎ
) {

1517 ià(
pÿÎ
->
»cv_Ùh”_msg
) {

1520 
	`time
(&
cu¼_time
);

1521 ià(!(
	`difáime
(
cu¼_time
, 
pÿÎ
->
t_msg_»cv
è> 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
)) {

1522 
is_cÚ_»cv
 = 
FTDM_FALSE
;

1523 
dÚe
;

1525 
msg_»cv_aá_time
++;

1526 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Creating‡‚ew…call SETUP is„eceived‡fter %d seconds\n",

1527 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
);

1532 
pÿÎ
 = 
	`§ngoma_isdn_p_ü—‹_pÿÎ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1533 ià(!
pÿÎ
) {

1534 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Failedo create…call for %s\n",

1535 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1539 
pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

1540 
pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

1542 
dÚe
:

1543 
pÿÎ
->
»cv_£tup
 = 
FTDM_TRUE
;

1545 
	`time
(&
pÿÎ
->
t_£tup_»cv
);

1548 ià(!
	`ádm_¡¾’_z”o
(
štfCb
->
şd_num
)) {

1549 
	`ádm_log
(
FTDM_LOG_DEBUG
,"şd_num[%s]\n", 
štfCb
->
şd_num
);

1550 
	`ádm_£t_¡ršg
(
pÿÎ
->
ÿÎednum
.
dig™s
, 
štfCb
->
şd_num
);

1554 ià(!
	`ádm_¡¾’_z”o
(
štfCb
->
şg_num
)) {

1555 
	`ádm_log
(
FTDM_LOG_DEBUG
,"şg_num[%s]\n", 
štfCb
->
şg_num
);

1556 
	`ádm_£t_¡ršg
(
pÿÎ
->
ÿÎšgnum
.
dig™s
, 
štfCb
->
şg_num
);

1557 
	`ádm_log
(
FTDM_LOG_DEBUG
,"şg_num[%s]\n", 
pÿÎ
->
ÿÎšgnum
.
dig™s
);

1560 
	`§ngoma_isdn_p_£t_p_msg_šfo
(
p
, 
msgTy³
, 
pÿÎ
, 
štfCb
);

1563 ià((
pÿÎ
->
chª_´es
 =ğ
FTDM_FALSE
è&& (
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
)) {

1564 
	`§ngoma_isdn_bidœ_p_g’”©e_šv™e
(
p
, 
pÿÎ
, 
üv
);

1568 ià(
is_cÚ_»cv
 =ğ
FTDM_TRUE
) {

1569 
tmp_p
 = 
p
;

1570 
p
 = 
³”p
;

1571 
³”p
 = 
tmp_p
;

1572 
msgTy³
 = 
Q931_CONNECT
;

1573 
	`ádm_log
(
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Sending CONNECTƒvent,‡s CONNECT is‡lready„eceivedƒarlier\n",

1574 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1578 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

1579 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1581 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1585 ià(
	`§ngoma_isdn_p_g‘_pÿÎ_¡©e
(
p
, 
üv
è=ğ
PCALL_RING
)

1586 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
Q931_CONNECT
, 
štfCb
, 
üv
);

1592 
Q931_SETUP_ACK
:

1593 
Q931_PROGRESS
:

1594 
Q931_PROCEEDING
:

1595 
Q931_ALERTING
:

1624 ià(
štfCb
->
chª_id
) {

1625 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d C®Ìef- %d] C®È% »ûived\n", 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1626 
¡©us
 = 
	`§ngoma_isdn_p_is_cÚ_»cv
(
³”p
, 
üv
, 
msgTy³
);

1629 ià((
¡©us
 =ğ
FTDM_FAIL
è|| (¡©u =ğ
FTDM_BREAK
)) {

1630 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
³”p
, 
üv
);

1631 ià(
pÿÎ
) {

1633 ià(
pÿÎ
->
»cv_cÚn
) {

1636 
	`time
(&
cu¼_time
);

1637 ià(!(
	`difáime
(
cu¼_time
, 
pÿÎ
->
t_cÚ_»cv
è> 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
)) {

1641 
msg_»cv_aá_time
++;

1642 
	`ádm_log
(
FTDM_LOG_DEBUG
,

1644 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
);

1646 } ià(
pÿÎ
->
»cv_£tup
) {

1649 
	`time
(&
cu¼_time
);

1650 ià(!(
	`difáime
(
cu¼_time
, 
pÿÎ
->
t_£tup_»cv
è> 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
)) {

1653 
msg_»cv_aá_time
++;

1654 
	`ádm_log
(
FTDM_LOG_DEBUG
,

1656 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
);

1664 
pÿÎ
 = 
	`§ngoma_isdn_p_ü—‹_pÿÎ
(
³”p
, 
msgTy³
, 
štfCb
, 
üv
);

1665 ià(!
pÿÎ
) {

1666 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Failedo create…call for %s\n",

1667 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1670 
pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

1671 
pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

1672 
pÿÎ
->
»cv_£tup
 = 
FTDM_FALSE
;

1673 
pÿÎ
->
ršg_ev’t_£Á
 = 
FTDM_FALSE
;

1674 
pÿÎ
->
»cv_Ùh”_msg
 = 
FTDM_TRUE
;

1675 
	`time
(&
pÿÎ
->
t_msg_»cv
);

1678 ià((
pÿÎ
->
chª_´es
 =ğ
FTDM_FALSE
è&& (
³”p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
)) {

1679 
	`§ngoma_isdn_bidœ_p_g’”©e_šv™e
(
³”p
, 
pÿÎ
, 
üv
);

1682 
	`ádm_log
(
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Sending CONNECTƒvent,‡s CONNECT is‡lready„eceivedƒarlier on„eceipt of %s\n",

1683 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1685 ià(
¡©us
 =ğ
FTDM_SUCCESS
) {

1686 
pÿÎ
->
»cv_Ùh”_msg
 = 
FTDM_FALSE
;

1687 
pÿÎ
->
t_msg_»cv
 = 
	`time
(
NULL
);

1689 
msgTy³
 = 
Q931_CONNECT
;

1692 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

1693 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1695 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1699 ià(
	`§ngoma_isdn_p_g‘_pÿÎ_¡©e
(
p
, 
üv
è=ğ
PCALL_RING
)

1700 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
Q931_CONNECT
, 
štfCb
, 
üv
);

1709 
Q931_INFORMATION
:

1711 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d]INFORMATION message„ecieved.\n",

1712 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1714 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
);

1716 ià(
pÿÎ
) {

1718 ià(!
	`ádm_¡¾’_z”o
(
štfCb
->
şd_num
)) {

1719 
dig™s
[25];

1721 
	`¥rštf
(
dig™s
,"%s%s",
pÿÎ
->
ÿÎednum
.dig™s,
štfCb
->
şd_num
);

1722 
	`ádm_£t_¡ršg
(
pÿÎ
->
ÿÎednum
.
dig™s
, digits);

1723 
	`ádm_log
(
FTDM_LOG_DEBUG
,"[%s Callref- %d]Received cld_num[%s] in INFORMATION message. Called Number Digits[%s] \n",

1724 
p
->
¥ª
->
Çme
, 
üv
, 
štfCb
->
şd_num
, 
pÿÎ
->
ÿÎednum
.
dig™s
);

1731 
Q931_CONNECT
:

1732 
cÚÃù_»cv
++;

1734 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

1735 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1737 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
msgTy³
, 
štfCb
, 
üv
);

1741 ià(
	`§ngoma_isdn_p_g‘_pÿÎ_¡©e
(
p
, 
üv
è=ğ
PCALL_RING
)

1742 
	`§ngoma_isdn_p_hªdË_ev’t_cÚ
(
p
, 
Q931_CONNECT
, 
štfCb
, 
üv
);

1746 
Q931_DISCONNECT
:

1747 
Q931_RELEASE
:

1748 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

1749 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_»l
(
p
, 
msgTy³
, 
üv
);

1751 
	`§ngoma_isdn_p_hªdË_ev’t_»l
(
p
, 
msgTy³
, 
üv
);

1756 
	`ádm_log
(
FTDM_LOG_DEBUG
, "IgnÜšg…assivev’ˆ%d oÀ¥ª %s\n", 
msgTy³
, 
p
->
¥ª
->
Çme
);

1760 
	}
}

1769 
·ssive_ÿÎ_t
 *
	$§ngoma_isdn_p_ü—‹_pÿÎ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
)

1771 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1772 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

1775 
	`§ngoma_isdn_p_check_¡®e_ÿÎ
(
p
, 
štfCb
, 
üv
, 
msgTy³
);

1778 
	`§ngoma_isdn_p_»£t_pÿÎ_bychªId
(
p
, 
štfCb
, 
üv
);

1782 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, &
üv
);

1783 ià(!
pÿÎ
) {

1784 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Creating‚ew…call for message %s\n",

1785 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1789 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, 
NULL
);

1790 ià(!
pÿÎ
) {

1791 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Failedo get‡ free…assive ISDN call slot for message %s\n",

1792 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1795 
	`ádm_log
(
FTDM_LOG_ERROR
, "***** Print TAP Pcalls structure *****\n");

1796 
	`§ngoma_isdn_p_´št_pÿÎ
(
p
);

1798 
	`ádm_log
(
FTDM_LOG_ERROR
, "\n***** Print PEERTAP Pcalls structure *****\n");

1799 
	`§ngoma_isdn_p_´št_pÿÎ
(
³”p
);

1801  
NULL
;

1804 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d]Initializing…call for message %s\n",

1805 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1806 
	`§ngoma_isdn_p_»£t_pÿÎ
(
pÿÎ
);

1809  
pÿÎ
;

1810 
	}
}

1820 
ádm_¡©us_t
 
	$§ngoma_isdn_p_hªdË_ev’t_cÚ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
)

1822 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

1823 
ÿÎ_»f
[25] = { 0 };

1824 
cÚ_ÿÎ_šfo_t
 *
ÿÎ_šfo
 = 
NULL
;

1825 
·ssive_ÿÎ_t
 *
³”pÿÎ
 = 
NULL
;

1826 
ádm_chªÃl_t
 *
³”fchª
 = 
NULL
;

1827 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

1828 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

1829 *
üv_key
 = 
NULL
;

1840 ià(!(
³”pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
³”p
, 
üv
))) {

1845 
ÿÎ_šfo
 = 
	`ádm_ÿÎoc
((*call_info), 1);

1846 ià(!
ÿÎ_šfo
) {

1847 
	`ádm_log
(
FTDM_LOG_ERROR
, "UÇbËØ®loÿ‹ memÜy w™h crv = %d iÀ³”­ c®Èli¡ fÜ s·À%s\n", 
üv
, 
p
->
¥ª
->
Çme
);

1848  
FTDM_FAIL
;

1852 
ÿÎ_šfo
->
cÚ»cv_time
 = 
	`time
(
NULL
);

1853 
ÿÎ_šfo
->
ÿÎ»f_v®
 = 0;

1854 
ÿÎ_šfo
->
msgTy³
 = 0;

1855 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_FALSE
;

1856 
ÿÎ_šfo
->
»cv_£tup
 = 
FTDM_FALSE
;

1857 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_FALSE
;

1860 
	`¥rštf
(
ÿÎ_»f
, "%d", 
üv
);

1861 ià(
	`hashbË_£¬ch
(
³”p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
)) {

1862 
	`ádm_log
(
FTDM_LOG_CRIT
, "C®Èw™h c®È»ã»û %d i ®»ady in£¹ed iÀthhashabË\n", 
üv
);

1863 
	`ádm_§ã_ä“
(
ÿÎ_šfo
);

1864  
FTDM_SUCCESS
;

1868 
ÿÎ_šfo
->
ÿÎ»f_v®
 = 
üv
;

1871 
	`time
(&
ÿÎ_šfo
->
cÚ»cv_time
);

1874 
ÿÎ_šfo
->
msgTy³
 = msgType;

1876 ià(
msgTy³
 =ğ
Q931_CONNECT
) {

1877 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_TRUE
;

1879 
ÿÎ_šfo
->
»cv_cÚ
 = 
FTDM_FALSE
;

1881 
ÿÎ_šfo
->
»cv_£tup
 = 
FTDM_FALSE
;

1883 ià(
štfCb
->
chª_id
) {

1884 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_TRUE
;

1886 
ÿÎ_šfo
->
p_´oûed
 = 
FTDM_FALSE
;

1889 
	`mem£t
(
ÿÎ_»f
, 0 , (call_ref));

1890 
	`¥rštf
(
ÿÎ_»f
, "%d", 
üv
);

1892 
üv_key
 = 
	`ádm_¡rdup
(
ÿÎ_»f
);

1894 ià(!
	`hashbË_š£¹
(
³”p
->
³nd_ÿÎ_l¡
, (*)
üv_key
, 
ÿÎ_šfo
, 
HASHTABLE_FLAG_FREE_KEY
)) {

1895 
	`ádm_log
(
FTDM_LOG_ERROR
, "UÇbËØš£¹ c®ÈšfØfÜ c®È»ã»nû v®ua %d\n", 
üv
);

1896  
FTDM_FAIL
;

1899 ià(
štfCb
->
chª_id
) {

1900 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d C®Ìef- %d] Found chªÃÈID iÀCONNECT mes§ge\n", 
p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1902 
³”pÿÎ
 = 
	`§ngoma_isdn_p_ü—‹_pÿÎ
(
³”p
, 
msgTy³
, 
štfCb
, 
üv
);

1903 ià(!
³”pÿÎ
) {

1904 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Failedo create…call. So, Lets wait for SETUPo be„eceived",

1905 
³”p
->
¥ª
->
Çme
, 
štfCb
->
chª_id
, 
üv
);

1906  
FTDM_FAIL
;

1909 
³”pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

1910 
³”pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

1911 
³”pÿÎ
->
»cv_£tup
 = 
FTDM_FALSE
;

1913 
cÚÃù_»cv_w™h_chªId
++;

1915 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d] Holdƒvent…rocessing‡s %sƒvent is„eceived before SETUP\n",

1916 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1918 
	`ádm_log
(
FTDM_LOG_DEBUG
,

1920 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1922  
FTDM_FAIL
;

1928 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d C®Ìef- %d] % ev’ˆ»ûive\n", 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

1931 ià((
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

1932 ià(
pÿÎ
->
»cv_cÚn
 =ğ
FTDM_TRUE
) {

1933 
	`ádm_log
(
FTDM_LOG_ERROR
,

1935 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

1936  
FTDM_FAIL
;

1940 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, &
üv
);

1941 ià(!
pÿÎ
) {

1943 
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ
(
p
, 
NULL
);

1944 ià(!
pÿÎ
) {

1945 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Failedo get‡ free…eer ISDN…assive call slot!\n",

1946 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

1948 
	`ádm_log
(
FTDM_LOG_ERROR
, "***** Print TAP Pcalls structure *****\n");

1949 
	`§ngoma_isdn_p_´št_pÿÎ
(
p
);

1951 
	`ádm_log
(
FTDM_LOG_ERROR
, "\n***** Print PEERTAP Pcalls structure *****\n");

1952 
	`§ngoma_isdn_p_´št_pÿÎ
(
³”p
);

1954  
FTDM_FAIL
;

1957 
	`§ngoma_isdn_p_»£t_pÿÎ
(
pÿÎ
);

1959 
pÿÎ
->
ÿÎ»f_v®
 = 
üv
;

1960 ià(
³”pÿÎ
->
chªId
) {

1961 
pÿÎ
->
chªId
 = 
³”pÿÎ
->chanId;

1962 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg chªId‡ %d fÜ % ev’ˆ»ûived oÀS·À% äom it ³”\n", 
pÿÎ
->
chªId
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

1963 } ià(
štfCb
->
chª_id
) {

1964 
pÿÎ
->
chªId
 = 
štfCb
->
chª_id
;

1965 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg chªId‡ %d fÜ % ev’ˆ»ûived oÀS·À%s\n", 
pÿÎ
->
chªId
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

1967 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Inv®id chªId‡ %d fÜ % ev’ˆ»ûived oÀS·À%s\n", 
štfCb
->
chª_id
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
p
->
¥ª
->
Çme
);

1968  
FTDM_FAIL
;

1973 ià(
pÿÎ
->
ršg_ev’t_£Á
 =ğ
FTDM_FALSE
) {

1975 
fchª
 = 
	`§ngoma_isdn_p_g‘_fchª
(
p
, 
pÿÎ
,…ÿÎ->
chªId
, 1, 1);

1976 ià(!
fchª
) {

1977 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Connect„equested on odd/unavailable\n",

1978 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

1979  
FTDM_FAIL
;

1983 
³”fchª
 = 
	`§ngoma_isdn_p_g‘_fchª
(
³”p
, 
³”pÿÎ
,…“½ÿÎ->
chªId
, 1, 
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_STEREO
 ? 0 : 1);

1984 ià(!
³”fchª
) {

1985 
	`ádm_log
(
FTDM_LOG_ERROR
, "[%s:%d Callref- %d] Connect„equested on odd/unavailable channel\n",

1986 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

1987  
FTDM_FAIL
;

1990 
pÿÎ
->
fchª
 = fchan;

1991 
³”pÿÎ
->
fchª
 = 
³”fchª
;

1994 ià((
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_BOTH
è|| (p->mixaudiØ=ğ
ISDN_TAP_AUDIO_MIX_STEREO
)) {

1996 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 
³”pÿÎ
->
ÿÎšgnum
.digits);

1997 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 
³”pÿÎ
->
ÿÎšgnum
.
dig™s
);

1998 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 
³”pÿÎ
->
ÿÎednum
.digits);

1999 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
ªi
.
dig™s
, 
³”pÿÎ
->
ÿÎšgnum
.digits);

2000 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 
üv
;

2003 
	`ádm_chªÃl_lock
(
fchª
);

2004 
fchª
->
ÿÎ_d©a
 = 
³”fchª
;

2005 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_RING
);

2006 
	`ádm_chªÃl_uÆock
(
fchª
);

2009 
pÿÎ
->
ršg_ev’t_£Á
 = 
FTDM_TRUE
;

2012 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

2014 
	`ádm_chªÃl_lock
(
³”fchª
);

2015 
³”fchª
->
ÿÎ_d©a
 = 
fchª
;

2016 ià(
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_NULL
) {

2017 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_RING
);

2019 
	`ádm_chªÃl_uÆock
(
³”fchª
);

2022 
³”pÿÎ
->
ršg_ev’t_£Á
 = 
FTDM_TRUE
;

2025 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

2028 ià(
p
->
p_mode
 =ğ
ISDN_TAP_FS
)

2029  
FTDM_SUCCESS
;

2031 
fchª
 = 
pÿÎ
->fchan;

2032 
³”fchª
 = 
³”pÿÎ
->
fchª
;

2035 
³”pÿÎ
->
»cv_cÚn
 = 
FTDM_TRUE
;

2036 
pÿÎ
->
»cv_cÚn
 = 
FTDM_TRUE
;

2039 
	`time
(&
³”pÿÎ
->
t_cÚ_»cv
);

2040 
	`time
(&
pÿÎ
->
t_cÚ_»cv
);

2045 ià(!
pÿÎ
) {

2046 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d] Gettinghe…call\n",

2047 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

2049 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

2050 
	`ádm_log
(
FTDM_LOG_ERROR
,

2052 
p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

2053  
FTDM_FAIL
;

2057 
	`§ngoma_isdn_p_£t_p_msg_šfo
(
p
, 
msgTy³
, 
pÿÎ
, 
štfCb
);

2059 
pÿÎ
->
p_msg
.
chª_id
 = 
³”pÿÎ
->tap_msg.chan_id;

2061 
pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 1;

2064 
	`mem£t
(
pÿÎ
->
p_msg
.
ÿÎed_num
, 0, (pcall->tap_msg.called_num));

2065 
	`mem£t
(
pÿÎ
->
p_msg
.
ÿÎšg_num
, 0, (pcall->tap_msg.calling_num));

2067 ià(!
	`ádm_¡¾’_z”o
(
³”pÿÎ
->
p_msg
.
ÿÎed_num
)) {

2068 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎed_num
, 
³”pÿÎ
->tap_msg.called_num);

2069 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®Ëd Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎed_num
);

2072 ià(!
	`ádm_¡¾’_z”o
(
³”pÿÎ
->
p_msg
.
ÿÎšg_num
)) {

2073 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎšg_num
, 
³”pÿÎ
->tap_msg.calling_num);

2074 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®lšg Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎšg_num
);

2077 
³”pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 1;

2079 ià(!
pÿÎ
->
fchª
) {

2080 
	`ádm_log
(
FTDM_LOG_ERROR
,

2082 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
);

2083  
FTDM_FAIL
;

2086 ià(((
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_BOTH
è|| (p->mixaudiØ=ğ
ISDN_TAP_AUDIO_MIX_STEREO
)) &&

2087 !
	`ádm_¡¾’_z”o
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
)) {

2088 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_num
.
dig™s
, 
³”pÿÎ
->
ÿÎšgnum
.digits);

2089 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
cid_Çme
, 
³”pÿÎ
->
ÿÎšgnum
.
dig™s
);

2090 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
dnis
.
dig™s
, 
³”pÿÎ
->
ÿÎednum
.digits);

2091 
	`ádm_£t_¡ršg
(
fchª
->
ÿÎ”_d©a
.
ªi
.
dig™s
, 
³”pÿÎ
->
ÿÎšgnum
.digits);

2092 
fchª
->
ÿÎ”_d©a
.
ÿÎ_»ã»nû
 = 
üv
;

2096 
	`ádm_chªÃl_lock
(
pÿÎ
->
fchª
);

2097 
	`ádm_log_chª
(
pÿÎ
->
fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] Tap call‡nswered in state %s\n",

2098 
p
->
¥ª
->
Çme
, 
pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
ÕÿÎ->
fchª
->
¡©e
));

2100 
	`ádm_£t_pæag
(
pÿÎ
->
fchª
, 
ISDN_TAP_NETWORK_ANSWER
);

2101 
	`ádm_£t_¡©e
(
pÿÎ
->
fchª
, 
FTDM_CHANNEL_STATE_UP
);

2102 
	`ádm_chªÃl_uÆock
(
pÿÎ
->
fchª
);

2105 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

2107 ià(
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_NULL
) {

2109 
³”fchª
 = (
ádm_chªÃl_t
*)
pÿÎ
->
fchª
->
ÿÎ_d©a
;

2110 ià(!
³”fchª
) {

2111 
	`ádm_log
(
FTDM_LOG_ERROR
,"[%s:%d C®Ìef- %d] P“¸chªÃÈnÙ found \n", 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
);

2112  
FTDM_FAIL
;

2114 
	`ádm_chªÃl_lock
(
³”fchª
);

2115 
	`ádm_log_chª
(
³”fchª
, 
FTDM_LOG_INFO
, "[%s:%d Callref- %d] PeerTap call was‡nswered in state %s\n",

2116 
³”p
->
¥ª
->
Çme
, 
³”pÿÎ
->
chªId
, 
üv
, 
	`ádm_chªÃl_¡©e2¡r
(
³”fchª
->
¡©e
));

2118 
	`ádm_£t_pæag
(
³”fchª
, 
ISDN_TAP_NETWORK_ANSWER
);

2119 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_UP
);

2120 
	`ádm_chªÃl_uÆock
(
³”fchª
);

2123 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

2126  
FTDM_SUCCESS
;

2127 
	}
}

2137 
ádm_¡©us_t
 
	$§ngoma_isdn_p_»l_¡®e_ÿÎ
(
¢gisdn_p_t
 *
p
, 
chª_id
)

2139 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

2140 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

2142 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_bychªId
(
p
, 
chª_id
))) {

2144 ià((
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
è|| (p->
nçs
.
Œunk
è|| (p->p_mod=ğ
ISDN_TAP_FS
)) {

2145 ià(
NULL
 =ğ(
fchª
 = 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
p
, 
chª_id
))) {

2146 
	`ádm_log_chª_msg
(
fchª
, 
FTDM_LOG_ERROR
, "Channel‚ot found\n");

2147 
dÚe
;

2150 
	`ádm_chªÃl_lock
(
fchª
);

2151 ià(
fchª
->
Ï¡_¡©e
 =ğ
FTDM_CHANNEL_STATE_HANGUP
) {

2152 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_DOWN
);

2154 
	`ádm_log_chª_msg
(
fchª
, 
FTDM_LOG_NOTICE
, "Changing channel stateo DOWN\n");

2155 } ià((
fchª
->
¡©e
 < 
FTDM_CHANNEL_STATE_TERMINATING
è&& (fchª->¡©!ğ
FTDM_CHANNEL_STATE_DOWN
)) {

2156 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

2158 
	`ádm_log_chª_msg
(
fchª
, 
FTDM_LOG_NOTICE
, "Changing channel stateo TERMINATING\n");

2160 
	`ádm_chªÃl_uÆock
(
fchª
);

2163 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

2166 
dÚe
:

2167 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s:%d] NØSË…ÿÎ…»£Á\n", 
p
->
¥ª
->
Çme
, 
chª_id
);

2168  
FTDM_FAIL
;

2171 
	`ádm_log
(
FTDM_LOG_INFO
, "[%s:%d C®Ìef- %d] R–—sšg SË C®l\n", 
p
->
¥ª
->
Çme
, 
chª_id
, 
pÿÎ
->
ÿÎ»f_v®
);

2172 if(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

2173 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_»l
(
p
, 
Q931_RELEASE
, 
pÿÎ
->
ÿÎ»f_v®
);

2175 
	`§ngoma_isdn_p_hªdË_ev’t_»l
(
p
, 
Q931_RELEASE
, 
pÿÎ
->
ÿÎ»f_v®
);

2178  
FTDM_SUCCESS
;

2179 
	}
}

2188 
ádm_¡©us_t
 
	$§ngoma_isdn_p_hªdË_ev’t_»l
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
üv
)

2190 
·ssive_ÿÎ_t
 *
pÿÎ
 = 
NULL
;

2191 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

2192 
·ssive_ÿÎ_t
 *
³”pÿÎ
 = 
NULL
;

2193 
ádm_chªÃl_t
 *
³”fchª
 = 
NULL
;

2195 
¢gisdn_p_t
 *
³”p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

2197 
	`ádm_log
(
FTDM_LOG_DEBUG
, "[%s Callref- %d] %sƒvent„eceived\n",

2198 
p
->
¥ª
->
Çme
, 
üv
, 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
));

2200 ià(
msgTy³
 =ğ
Q931_DISCONNECT
) {

2202 
discÚÃù_»cv
++;

2205 
»Ëa£_»cv
++;

2208 
	`§ngoma_isdn_p_is_cÚ_»cv
(
p
, 
üv
, 
msgTy³
);

2210 ià(!(
pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
p
, 
üv
))) {

2211 
	`ádm_log
(
FTDM_LOG_DEBUG
,

2213 
p
->
¥ª
->
Çme
, 
üv
);

2214 
’d
;

2217 ià(
pÿÎ
->
fchª
) {

2218 
fchª
 = 
pÿÎ
->fchan;

2220 ià(
p
->
šdiÿ‹_ev’t
 =ğ
FTDM_TRUE
) {

2221 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Tap Message sento‡pplication on„eceipt of %sƒvent on span[%d] chan[%d]\n",

2222 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
fchª
->
¥ª_id
, fchª->
chª_id
);

2224 
	`£nd_´ÙocŞ_¿w_d©a
Ğ&
pÿÎ
->
p_msg
,…ÿÎ->
fchª
);

2227 
	`ádm_chªÃl_lock
(
fchª
);

2228 ià(
fchª
->
¡©e
 < 
FTDM_CHANNEL_STATE_TERMINATING
) {

2229 
	`ádm_£t_¡©e
(
fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

2230 
	`ádm_log_chª
(
fchª
, 
FTDM_LOG_DEBUG
, "[%s:%d Callref- %d]Changing channel stateo TERMINATING\n",

2231 
p
->
¥ª
->
Çme
, 
fchª
->
physiÿl_chª_id
, 
üv
);

2233 
	`ádm_chªÃl_uÆock
(
fchª
);

2235 
	`§ngoma_isdn_p_check_¡©e
(
p
->
¥ª
);

2239 ià(
pÿÎ
->
fchª
) {

2240 
³”fchª
 = (
ádm_chªÃl_t
*)
pÿÎ
->
fchª
->
ÿÎ_d©a
;

2243 ià(
³”fchª
) {

2244 ià(
³”p
->
šdiÿ‹_ev’t
 =ğ
FTDM_TRUE
) {

2245 ià((
³”pÿÎ
 = 
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
³”p
, 
üv
))) {

2246 ià(
³”fchª
->
¥ª_id
 =ğ
³”pÿÎ
->
fchª
->span_id) {

2247 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Peerap Message sento‡pplication on„eceipt of %sƒvent on span[%d] chan[%d]\n",

2248 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), 
³”fchª
->
¥ª_id
,…“rfchª->
chª_id
);

2250 
	`£nd_´ÙocŞ_¿w_d©a
Ğ&
³”pÿÎ
->
p_msg
,…“½ÿÎ->
fchª
);

2255 
	`ádm_chªÃl_lock
(
³”fchª
);

2256 ià(
³”fchª
->
¡©e
 < 
FTDM_CHANNEL_STATE_TERMINATING
) {

2257 
	`ádm_£t_¡©e
(
³”fchª
, 
FTDM_CHANNEL_STATE_TERMINATING
);

2258 
	`ádm_log_chª
(
³”fchª
,
FTDM_LOG_DEBUG
,"[%s:%d Callref- %d] Changing…eer channel stateo TERMINATING\n",

2259 
³”p
->
¥ª
->
Çme
, 
³”fchª
->
physiÿl_chª_id
, 
üv
);

2261 
	`ádm_chªÃl_uÆock
(
³”fchª
);

2263 
	`§ngoma_isdn_p_check_¡©e
(
³”p
->
¥ª
);

2266 
’d
:

2267 
	`§ngoma_isdn_p_put_pÿÎ
(
p
, &
üv
);

2268 
	`§ngoma_isdn_p_put_pÿÎ
(
³”p
, &
üv
);

2270  
FTDM_SUCCESS
;

2271 
	}
}

2280 
	$§ngoma_isdn_p_check_ev’t
(
ádm_¥ª_t
 *
¥ª
)

2282 
ádm_ev’t_t
 *
ev’t
 = 
NULL
;

2285 
	`ádm_¥ª_Ãxt_ev’t
(
¥ª
, &
ev’t
è=ğ
FTDM_SUCCESS
) {

2286 ià(
ev’t
->
e_ty³
 =ğ
FTDM_EVENT_OOB
) {

2287 
	`ámod_isdn_´oûss_ev’t
(
¥ª
, 
ev’t
);

2290 
	}
}

2301 *
	$ádm_§ngoma_isdn_p_voiû_¥ª_run
(
ádm_th»ad_t
 *
me
, *
obj
)

2303 
ádm_¥ª_t
 *
¥ª
 = (ádm_¥ª_ˆ*è
obj
;

2304 
¢gisdn_p_t
 *
p
 = 
¥ª
->
sigÇl_d©a
;

2305 
ádm_¥ª_t
 *
³”_¥ª
 = 
NULL
;

2307 
	`ádm_log
(
FTDM_LOG_DEBUG
, "T­pšg ISDN…u» voiûh»ad s¹ed oÀ¥ª %s\n", 
¥ª
->
Çme
);

2308 
	`ádm_£t_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
);

2310 
³”_¥ª
 = 
p
->
³”¥ª
;

2312 ià(!
p
) {

2313 
	`ádm_log
(
FTDM_LOG_ERROR
, "Invalid Tap value\n");

2314 
dÚe
;

2317 ià(!
	`ádm_‹¡_æag
(
p
, 
ISDN_TAP_MASTER
)) {

2318 
	`ádm_log
(
FTDM_LOG_DEBUG
, "RuÂšg dummyh»ad oÀpu» voiû s·À%s\n", 
¥ª
->
Çme
);

2319 
	`ádm_ruÂšg
(è&& !
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
)) {

2321 
	`ádm_¦“p
(100);

2324 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Ma¡”­pšgh»ad oÀpu» voiû s·À%s\n", 
¥ª
->
Çme
);

2326 
	`ádm_ruÂšg
(è&& !
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
)) {

2327 
	`§ngoma_isdn_p_check_¡©e
(
¥ª
);

2328 
	`§ngoma_isdn_p_check_¡©e
(
³”_¥ª
);

2329 
	`ádm_¦“p
(10);

2333 
dÚe
:

2334 
	`ádm_log
(
FTDM_LOG_DEBUG
, "T­pšg ISDN…u» voiûh»adƒnded oÀ¥ª %s\n", 
¥ª
->
Çme
);

2336 
	`ádm_ş—r_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
);

2337 
	`ádm_ş—r_æag
(
p
, 
ISDN_TAP_MASTER
);

2339 
	`§ngoma_isdn_p_ä“_hashli¡
(
p
);

2341  
NULL
;

2342 
	}
}

2353 *
	$ádm_§ngoma_isdn_p_run
(
ádm_th»ad_t
 *
me
, *
obj
)

2355 
ádm_¥ª_t
 *
¥ª
 = (ádm_¥ª_ˆ*è
obj
;

2356 
¢gisdn_p_t
 *
p
 = 
¥ª
->
sigÇl_d©a
;

2357 
¢gisdn_p_t
 *
³”_p
 = 
NULL
;

2358 
ádm_¥ª_t
 *
³”
 = 
NULL
;

2361 
ádm_chªÃl_t
 *
chª_pŞl
[2] = { 0 };

2362 
ádm_wa™_æag_t
 
pŞl_ev’ts
[2] = { 0 };

2363 
ušt32_t
 
pŞl_¡©us
 = 0;

2364 
ušt32_t
 
wa™ms
 = 0;

2366 
£tup_»cv
 = 0;

2367 
cÚÃù_»cv
 = 0;

2368 
ÿÎ_´oûed_»cv
 = 0;

2369 
»Ëa£_»cv
 = 0;

2370 
discÚÃù_»cv
 = 0;

2371 
ÿÎ_µed
 = 0;

2372 
msg_»cv_aá_time
 = 0;

2373 
—¾y_cÚÃù_»cv
 = 0;

2374 
Ï‹_šv™e_»cv
 = 0;

2376 
	`ádm_log
(
FTDM_LOG_DEBUG
, "T­pšg ISDNh»ad s¹ed oÀ¥ª %s\n", 
¥ª
->
Çme
);

2378 
	`ádm_£t_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
);

2380 ià(
	`ádm_chªÃl_İ’
(
¥ª
->
¥ª_id
, 
p
->
dchª
->
chª_id
, &p->dchªè!ğ
FTDM_SUCCESS
) {

2381 
	`ádm_log
(
FTDM_LOG_ERROR
, "FaedØİ’ D-chªÃÈfÜ s·À%s\n", 
¥ª
->
Çme
);

2382 
dÚe
;

2385 ià((
p
->
´i
 = 
	`§ngoma_isdn_Ãw_cb
Ñ­->
dchª
->
sockfd
, 
PRI_NETWORK
, 
SW_NI2
,ap))) {

2386 
	`§ngoma_isdn_p_£t_debug
(
p
->
´i
,­->
debug
);

2388 
	`ádm_log
(
FTDM_LOG_CRIT
, "Failedo createapping ISDN\n");

2389 
dÚe
;

2395 
³”
 = 
p
->
³”¥ª
;

2396 
³”_p
 = 
³”
->
sigÇl_d©a
;

2398 ià(!
	`ádm_‹¡_æag
(
p
, 
ISDN_TAP_MASTER
)) {

2399 ià(
p
->
nçs
.
sigchª
 =ğ
SNGISDN_NFAS_DCHAN_BACKUP
) {

2400 
	`ádm_log
(
FTDM_LOG_DEBUG
, "RuÂšg dummyh»ad oÀbacku°¥ª %s\n", 
¥ª
->
Çme
);

2402 
	`ádm_log
(
FTDM_LOG_DEBUG
, "RuÂšg dummyh»ad oÀ¥ª %s\n", 
¥ª
->
Çme
);

2405 
	`ádm_ruÂšg
(è&& !
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
)) {

2407 
	`ádm_¦“p
(100);

2410 ià(
p
->
nçs
.
Œunk
) {

2411 (
p
->
nçs
.
Œunk
->
num_p_¥ªs
 !ğp->nçs.Œunk->
num_¥ªs_cÚfigu»d
)) {

2417 ià(
p
->
nçs
.
sigchª
 =ğ
SNGISDN_NFAS_DCHAN_BACKUP
) {

2418 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Masterappinghread on backup span %s (fd1=%d, fd2=%d)\n",

2419 
¥ª
->
Çme
, 
p
->
dchª
->
sockfd
, 
³”_p
->dchan->sockfd);

2421 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Masterappinghread on span %s (fd1=%d, fd2=%d)\n",

2422 
¥ª
->
Çme
, 
p
->
dchª
->
sockfd
, 
³”_p
->dchan->sockfd);

2425 
	`ádm_ruÂšg
(è&& !
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
)) {

2426 
wa™ms
 = 10;

2427 
	`§ngoma_isdn_p_check_¡©e
(
¥ª
);

2428 
	`§ngoma_isdn_p_check_¡©e
(
³”
);

2430 
chª_pŞl
[0] = 
p
->
dchª
;

2431 
chª_pŞl
[1] = 
³”_p
->
dchª
;

2433 
pŞl_ev’ts
[0] = 
FTDM_READ
;

2434 
pŞl_ev’ts
[1] = 
FTDM_READ
;

2437 
pŞl_¡©us
 = 
	`ádm_chªÃl_wa™_muÉË
(
chª_pŞl
, 
pŞl_ev’ts
, 2, 
wa™ms
);

2439 
pŞl_¡©us
) {

2440 
FTDM_TIMEOUT
:

2441 
FTDM_BREAK
:

2444 
FTDM_SUCCESS
:

2446 ià(
	`ádm_‹¡_io_æag
(
p
->
dchª
, 
FTDM_CHANNEL_IO_READ
)) {

2447 ià(
FTDM_SUCCESS
 =ğ
	`§ngoma_isdn_»ad_msg
(
p
)) {

2448 
	`§ngoma_isdn_p_check_¡©e
(
¥ª
);

2449 
	`§ngoma_isdn_p_check_¡©e
(
³”
);

2451 
	`§ngoma_isdn_p_check_¡©e
(
¥ª
);

2454 ià(
	`ádm_‹¡_io_æag
(
³”_p
->
dchª
, 
FTDM_CHANNEL_IO_READ
)) {

2455 ià(
FTDM_SUCCESS
 =ğ
	`§ngoma_isdn_»ad_msg
(
³”_p
)) {

2456 
	`§ngoma_isdn_p_check_¡©e
(
¥ª
);

2457 
	`§ngoma_isdn_p_check_¡©e
(
³”
);

2459 
	`§ngoma_isdn_p_check_¡©e
(
³”
);

2464 
	`ádm_log
(
FTDM_LOG_ERROR
, "Invalid status.\n");

2465 
pŞl_¡©us
 = 0;

2469 
	`§ngoma_isdn_p_check_ev’t
(
¥ª
);

2470 
	`§ngoma_isdn_p_check_ev’t
(
³”
);

2474 
dÚe
:

2475 
	`ádm_log
(
FTDM_LOG_DEBUG
, "T­pšg ISDNh»adƒnded oÀ¥ª %s\n", 
¥ª
->
Çme
);

2477 
	`ádm_ş—r_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
);

2478 
	`ádm_ş—r_æag
(
p
, 
ISDN_TAP_MASTER
);

2480 
	`§ngoma_isdn_p_ä“_hashli¡
(
p
);

2482  
NULL
;

2483 
	}
}

2492 
ádm_¡©us_t
 
	$§ngoma_isdn_»ad_msg
(
¢gisdn_p_t
 *
p
)

2494 
»s
 = 0;

2495 
d©a
[1024] = { 0 };

2496 
ušt8_t
 
msgTy³
 = 0;

2497 
¢g_decod”_š‹rçû_t
 
štf
 = { 0 };

2498 
ádm_¡©us_t
 
»t
 = 
FTDM_FAIL
;

2501 
»s
 = 0;

2504 
»s
 = 
	`§ngoma_isdn_io_»ad
(
p
->
´i
, 
d©a
, (data));

2506 ià(
»s
 < 5 || (()
d©a
[4] != 8)) {

2507 
msgTy³
 = 0;

2510 
msgTy³
 = (
ušt8_t
)
	`q931_decode
(
p
->
sw™ch_ty³
, (
d©a
 + 4), (
»s
 - 4),­->
decCb
, &
štf
);

2511 
	`ádm_log_chª
(
p
->
dchª
, 
FTDM_LOG_DEBUG
, "% Mes§ge(%dè»ûived oÀ% ¥ª\n", 
	`SNG_DECODE_ISDN_EVENT
(
msgTy³
), msgTy³,­->
¥ª
->
Çme
);

2515 ià(
msgTy³
) {

2516 
	`hªdË_isdn_·ssive_ev’t
(
p
, 
msgTy³
, &
štf
);

2517 
»t
 = 
FTDM_SUCCESS
;

2520  
»t
;

2521 
	}
}

2530 
	$§ngoma_isdn_p_ä“_hashli¡
(
¢gisdn_p_t
 *
p
)

2532 
ádm_hash_™”©Ü_t
 *
idx
 = 
NULL
;

2533 
cÚ_ÿÎ_šfo_t
 *
ÿÎ_šfo
 = 
NULL
;

2534 cÚ¡ *
key
 = 
NULL
;

2535 *
v®
 = 
NULL
;

2536 
ÿÎ_»f
[25];

2539 
idx
 = 
	`hashbË_fœ¡
(
p
->
³nd_ÿÎ_l¡
); idx; idx = 
	`hashbË_Ãxt
(idx)) {

2540 
	`hashbË_this
(
idx
, &
key
, 
NULL
, &
v®
);

2541 ià(!
key
 || !
v®
) {

2545 
ÿÎ_šfo
 = (
cÚ_ÿÎ_šfo_t
*)
v®
;

2546 
	`mem£t
(
ÿÎ_»f
, 0, (call_ref));

2547 
	`¥rštf
(
ÿÎ_»f
, "%d", 
ÿÎ_šfo
->
ÿÎ»f_v®
);

2549 
	`hashbË_»move
(
p
->
³nd_ÿÎ_l¡
, (*)
ÿÎ_»f
);

2550 
	`ádm_§ã_ä“
(
ÿÎ_šfo
);

2554 
	`hashbË_de¡roy
(
p
->
³nd_ÿÎ_l¡
);

2555 
p
->
³nd_ÿÎ_l¡
 = 
NULL
;

2556 
	}
}

2565 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_¡İ
(
ádm_¥ª_t
 *
¥ª
)

2567 
¢gisdn_p_t
 *
p
 = 
¥ª
->
sigÇl_d©a
;

2570 ià(
p
->
decCb
) {

2571 
	`¢g_q931_decod”_ä“cb
(
p
->
decCb
);

2574 ià(!
	`ádm_‹¡_æag
(
p
, 
ISDN_TAP_RUNNING
)) {

2575  
FTDM_FAIL
;

2578 
	`ádm_ş—r_æag
(
p
, 
ISDN_TAP_RUNNING
);

2580 
	`ádm_mu‹x_de¡roy
(&
p
->
pÿÎs_lock
);

2583 
	`ádm_§ã_ä“
(
p
->
´i
);

2585 
	`ádm_£t_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
);

2587 
	`ádm_‹¡_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
)) {

2588 
	`ádm_¦“p
(100);

2591  
FTDM_SUCCESS
;

2592 
	}
}

2602 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_medŸ_»ad
(
ádm_chªÃl_t
 *
ádmchª
, *
d©a
, 
ádm_size_t
 
size
)

2604 
ádm_¡©us_t
 
¡©us
 = 
FTDM_SUCCESS
;

2605 
fio_codec_t
 
codec_func
;

2606 
ádm_chªÃl_t
 *
³”chª
 = 
ádmchª
->
ÿÎ_d©a
;

2607 
¢gisdn_p_t
 *
p
 = 
ádmchª
->
¥ª
->
sigÇl_d©a
;

2608 
št16_t
 *
chªbuf
;

2609 
št16_t
 *
³”buf
;

2610 
št16_t
 *
mixedbuf
;

2611 
ádm_size_t
 
i
 = 0;

2612 
ádm_size_t
 
siz”—d
 = 
size
;

2613 
ádm_wa™_æag_t
 
æags
 = 
FTDM_READ
;

2615 ià(!
d©a
 || !
size
) {

2616  
FTDM_FAIL
;

2619 ià(!
	`FTDM_IS_VOICE_CHANNEL
(
ádmchª
è|| !ádmchª->
ÿÎ_d©a
) {

2620  
FTDM_SUCCESS
;

2623 ià((
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_SELF
è|| (p->mixaudiØ=ğ
ISDN_TAP_AUDIO_MIX_STEREO
)) {

2624  
FTDM_SUCCESS
;

2627 
chªbuf
 = (
št16_t
*)
	`m®loc
((št16_tè*
size
);

2628 
³”buf
 = (
št16_t
*)
	`m®loc
((št16_tè*
size
);

2629 
mixedbuf
 = (
št16_t
*)
	`m®loc
((št16_tè*
size
);

2631 ià(
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_PEER
) {

2634 
	`mem£t
(
d©a
, 
	`FTDM_SILENCE_VALUE
(
ádmchª
), 
size
);

2637 ià(
ádmchª
->
Çtive_codec
 !ğ
³”chª
->native_codec) {

2638 
	`ádm_log_chª
(
³”chª
, 
FTDM_LOG_CRIT
, "Invalid…eer channel with format %d, ours = %d\n",

2639 
³”chª
->
Çtive_codec
, 
ádmchª
->native_codec);

2640 
¡©us
 = 
FTDM_FAIL
;

2641 
dÚe
;

2644 
	`memıy
(
chªbuf
, 
d©a
, 
size
);

2649 
	`ádm_chªÃl_wa™
(
³”chª
, &
æags
, 0);

2650 ià(
æags
 & 
FTDM_READ
) {

2651 
¡©us
 = 
³”chª
->
fio
->
	`»ad
Õ“rchª, 
³”buf
, &
siz”—d
);

2655 ià(
¡©us
 !ğ
FTDM_SUCCESS
) {

2656 
	`ádm_log_chª_msg
(
³”chª
, 
FTDM_LOG_ERROR
, "Failedo„ead from…eer channel!\n");

2657 
¡©us
 = 
FTDM_FAIL
;

2658 
dÚe
;

2660 ià(
siz”—d
 !ğ
size
) {

2661 
	`ádm_log_chª
(
³”chª
, 
FTDM_LOG_ERROR
, "»ad from…“¸chªÃÈÚly %"
FTDM_SIZE_FMT
" by‹s!\n", 
siz”—d
);

2662 
¡©us
 = 
FTDM_FAIL
;

2663 
dÚe
;

2666 ià(
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_PEER
) {

2668 
	`memıy
(
d©a
, 
³”buf
, 
size
);

2669 
¡©us
 = 
FTDM_SUCCESS
;

2670 
dÚe
;

2673 
codec_func
 = 
³”chª
->
Çtive_codec
 =ğ
FTDM_CODEC_ULAW
 ? 
fio_uÏw2¦š
 :…“rchª->Çtive_codeø=ğ
FTDM_CODEC_ALAW
 ? 
fio_®aw2¦š
 : 
NULL
;

2674 ià(
codec_func
) {

2675 
siz”—d
 = 
size
;

2676 
	`codec_func
(
chªbuf
, (
št16_t
)*
size
, &
siz”—d
);

2677 
siz”—d
 = 
size
;

2678 
	`codec_func
(
³”buf
, (
št16_t
)*
size
, &
siz”—d
);

2681 
i
 = 0; i < 
size
; i++) {

2682 
mixedbuf
[
i
] = 
	`ádm_§tu¿‹d_add
(
chªbuf
[i], 
³”buf
[i]);

2685 
codec_func
 = 
³”chª
->
Çtive_codec
 =ğ
FTDM_CODEC_ULAW
 ? 
fio_¦š2uÏw
 :…“rchª->Çtive_codeø=ğ
FTDM_CODEC_ALAW
 ? 
fio_¦š2®aw
 : 
NULL
;

2686 ià(
codec_func
) {

2687 
	`codec_func
(
mixedbuf
, (
št16_t
)*
size
, &
siz”—d
);

2689 
	`memıy
(
d©a
, 
mixedbuf
, 
siz”—d
);

2691 
¡©us
 = 
FTDM_SUCCESS
;

2693 
dÚe
:

2694 
	`ádm_§ã_ä“
(
chªbuf
);

2695 
	`ádm_§ã_ä“
(
³”buf
);

2696 
	`ádm_§ã_ä“
(
mixedbuf
);

2697  
¡©us
;

2698 
	}
}

2707 
	$ádm_§ngoma_isdn_p_dchª_£t_queue_size
(
ádm_chªÃl_t
 *
dchª
)

2709 
ádm_¡©us_t
 
»t_¡©us
;

2710 
ušt32_t
 
queue_size
 = 0;

2712 ià(!
p_dchª_queue_size
) {

2714 
p_dchª_queue_size
 = 
ISDN_TAP_DCHAN_QUEUE_LEN
;

2717 
queue_size
 = 
p_dchª_queue_size
;

2718 
»t_¡©us
 = 
	`ádm_chªÃl_commªd
(
dchª
, 
FTDM_COMMAND_SET_RX_QUEUE_SIZE
, &
queue_size
);

2720 ià(
»t_¡©us
 !ğ
FTDM_SUCCESS
) {

2721 
	`ádm_log_chª_msg
(
dchª
, 
FTDM_LOG_CRIT
, "Failedo set Rx Queue size\n");

2723 
	`ádm_log_chª
(
dchª
, 
FTDM_LOG_INFO
, "Rx Queusizi tØ%d\n", 
queue_size
);

2726 
queue_size
 = 
p_dchª_queue_size
;

2727 
»t_¡©us
 = 
	`ádm_chªÃl_commªd
(
dchª
, 
FTDM_COMMAND_SET_TX_QUEUE_SIZE
, &
queue_size
);

2729 ià(
»t_¡©us
 !ğ
FTDM_SUCCESS
) {

2730 
	`ádm_log_chª_msg
(
dchª
, 
FTDM_LOG_CRIT
, "Failedo set Rx Queue size\n");

2732 
	`ádm_log_chª
(
dchª
, 
FTDM_LOG_INFO
, "Rx Queusizi tØ%d\n", 
queue_size
);

2736 
	}
}

2745 
ádm_¡©us_t
 
	$§ngoma_isdn_p_·r£_Œunkgroup
(cÚ¡ *
_Œunkgroup
)

2747 
ádm_¡©us_t
 
»t
 = 
FTDM_SUCCESS
;

2748 
ušt8_t
 
num_p_¥ªs
 = 0;

2749 *
backup_¥ª
 = 
NULL
;

2750 *
dchª_¥ª
 = 
NULL
;

2751 *
Œunkgroup
 = 
NULL
;

2752 *
Çme
 = 
NULL
;

2753 *
v®
 = 
NULL
;

2754 
idx
 = 0;

2756 
Œunkgroup
 = 
	`ádm_¡rdup
(
_Œunkgroup
);

2759 
v®
 = 
	`¡¹ok
(
Œunkgroup
, ","); v®; v® = sŒtok(
NULL
, ",")) {

2760 *
v®
 == ' ') {

2761 
v®
++;

2764 
idx
++) {

2766 
Çme
 = 
	`ádm_¡rdup
(
v®
);

2769 
num_p_¥ªs
 = 
	`©oi
(
v®
);

2772 
dchª_¥ª
 = 
	`ádm_¡rdup
(
v®
);

2775 
backup_¥ª
 = 
	`ádm_¡rdup
(
v®
);

2779 ià(!(
Çme
è|| !(
dchª_¥ª
è|| (
num_p_¥ªs
 <= 0)) {

2780 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id­…¬am‘” fÜrunkgroup: %s\n", 
_Œunkgroup
);

2781 
»t
 = 
FTDM_FAIL
;

2782 
dÚe
;

2785 
idx
 = 0; idx < 
g_¢gisdn_p_d©a
.
num_nçs
; idx++) {

2786 ià(!
	`ádm_¡¾’_z”o
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
Çme
) &&

2787 !
	`¡rÿ£cmp
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
Çme
,‚ame)) {

2789 
dÚe
;

2794 
	`¡ºıy
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
Çme
,‚ame, (g_sngisdn_tap_data.nfas[idx].name));

2795 
g_¢gisdn_p_d©a
.
nçs
[
idx
].
num_p_¥ªs
 =‚um_tap_spans;

2796 
	`¡ºıy
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
dchª_¥ª_Çme
, 
dchª_¥ª
, (g_sngisdn_tap_data.nfas[idx].dchan_span_name));

2798 ià(
backup_¥ª
) {

2799 
	`¡ºıy
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
backup_¥ª_Çme
, 
backup_¥ª
, (g_sngisdn_tap_data.nfas[idx].backup_span_name));

2802 
g_¢gisdn_p_d©a
.
num_nçs
++;

2804 
dÚe
:

2805 
	`ádm_§ã_ä“
(
Œunkgroup
);

2806 
	`ádm_§ã_ä“
(
Çme
);

2807 
	`ádm_§ã_ä“
(
dchª_¥ª
);

2808 
	`ádm_§ã_ä“
(
backup_¥ª
);

2809  
»t
;

2810 
	}
}

2820 
ádm_¡©us_t
 
	$§ngoma_isdn_p_·r£_¥ªm­
(cÚ¡ *
_¥ªm­
, 
ádm_¥ª_t
 *
¥ª
)

2822 
¢gisdn_p_t
 *
p
 = (¢gisdn_p_t*è
¥ª
->
sigÇl_d©a
;

2823 
ádm_¡©us_t
 
»t
 = 
FTDM_SUCCESS
;

2824 
ušt8_t
 
logiÿl_¥ª_id
 = 0;

2825 *
¥ªm­
 = 
NULL
;

2826 *
Çme
 = 
NULL
;

2827 *
v®
 = 
NULL
;

2828 
idx
 = 0;

2830 
¥ªm­
 = 
	`ádm_¡rdup
(
_¥ªm­
);

2833 
v®
 = 
	`¡¹ok
(
¥ªm­
, ","); v®; v® = sŒtok(
NULL
, ",")) {

2834 *
v®
 == ' ') {

2835 
v®
++;

2838 
idx
++) {

2840 
Çme
 = 
	`ádm_¡rdup
(
v®
);

2843 
logiÿl_¥ª_id
 = 
	`©oi
(
v®
);

2851 ià(!
Çme
) {

2852 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id­ s·nm­ syÁax %s\n", 
_¥ªm­
);

2853 
»t
 = 
FTDM_FAIL
;

2854 
dÚe
;

2857 
idx
 = 0; idx < 
g_¢gisdn_p_d©a
.
num_nçs
; idx++) {

2858 ià(!
	`ádm_¡¾’_z”o
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
Çme
) &&

2859 !
	`¡rÿ£cmp
(
g_¢gisdn_p_d©a
.
nçs
[
idx
].
Çme
,‚ame)) {

2860 
p
->
nçs
.
Œunk
 = &
g_¢gisdn_p_d©a
.nçs[
idx
];

2865 ià(!
p
->
nçs
.
Œunk
) {

2866 
	`ádm_log
(
FTDM_LOG_ERROR
, "Could‚Ù fšdrunkgrou°w™h‚am%s\n", 
Çme
);

2867 
»t
 = 
FTDM_FAIL
;

2868 
dÚe
;

2872 ià(
p
->
nçs
.
Œunk
->
p_¥ªs
[
logiÿl_¥ª_id
]) {

2873 
	`ádm_log
(
FTDM_LOG_ERROR
, "Œunkgroup:% ®»ady had‡ s·Àw™h†ogiÿÈ¥ª id:%d fÜ s·À%s\n", 
Çme
, 
logiÿl_¥ª_id
, 
p
->
¥ª
->name);

2875 
p
->
nçs
.
Œunk
->
p_¥ªs
[
logiÿl_¥ª_id
] = 
¥ª
;

2876 
p
->
nçs
.
š‹rçû_id
 = 
logiÿl_¥ª_id
;

2879 
p
->
nçs
.
sigchª
 = 
SNGISDN_NFAS_DCHAN_NONE
;

2881 ià(!
	`¡rÿ£cmp
(
p
->
¥ª
->
Çme
,­->
nçs
.
Œunk
->
dchª_¥ª_Çme
)) {

2882 
p
->
nçs
.
sigchª
 = 
SNGISDN_NFAS_DCHAN_PRIMARY
;

2883 
p
->
nçs
.
Œunk
->
dchª
 =ap;

2886 ià(!
	`¡rÿ£cmp
(
p
->
¥ª
->
Çme
,­->
nçs
.
Œunk
->
backup_¥ª_Çme
)) {

2887 
p
->
nçs
.
sigchª
 = 
SNGISDN_NFAS_DCHAN_BACKUP
;

2888 
p
->
nçs
.
Œunk
->
backup
 =ap;

2891 
p
->
nçs
.
Œunk
->
num_¥ªs_cÚfigu»d
++;

2892 
dÚe
:

2893 
	`ádm_§ã_ä“
(
¥ªm­
);

2894 
	`ádm_§ã_ä“
(
Çme
);

2895  
»t
;

2896 
	}
}

2905 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_¡¬t
(
ádm_¥ª_t
 *
¥ª
)

2907 
ádm_¡©us_t
 
»t
;

2908 
¢gisdn_p_t
 *
p
 = 
¥ª
->
sigÇl_d©a
;

2909 
¢gisdn_p_t
 *
³”_p
 = 
p
->
³”¥ª
->
sigÇl_d©a
;

2911 ià((
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
è&& (p->
dchª
)) {

2912 
	`ádm_chªÃl_£t_ã©u»
(
p
->
dchª
, 
FTDM_CHANNEL_FEATURE_IO_STATS
);

2913 
	`ádm_§ngoma_isdn_p_dchª_£t_queue_size
(
p
->
dchª
);

2917 ià(
	`ádm_‹¡_æag
(
p
, 
ISDN_TAP_RUNNING
)) {

2918  
FTDM_FAIL
;

2921 
	`ádm_mu‹x_ü—‹
(&
p
->
pÿÎs_lock
);

2923 
	`ádm_ş—r_æag
(
¥ª
, 
FTDM_SPAN_STOP_THREAD
);

2924 
	`ádm_ş—r_æag
(
¥ª
, 
FTDM_SPAN_IN_THREAD
);

2926 
	`ádm_£t_æag
(
p
, 
ISDN_TAP_RUNNING
);

2927 ià(
³”_p
 && 
	`ádm_‹¡_æag
Õ“r_p, 
ISDN_TAP_RUNNING
)) {

2929 
	`ádm_£t_æag
(
p
, 
ISDN_TAP_MASTER
);

2932 ià((!
p
->
nçs
.
Œunk
è|| (p->nçs.
sigchª
 !ğ
SNGISDN_NFAS_DCHAN_NONE
)) {

2933 
»t
 = 
	`ádm_th»ad_ü—‹_d‘ached
(
ádm_§ngoma_isdn_p_run
, 
¥ª
);

2935 
»t
 = 
	`ádm_th»ad_ü—‹_d‘ached
(
ádm_§ngoma_isdn_p_voiû_¥ª_run
, 
¥ª
);

2938 ià(
»t
 !ğ
FTDM_SUCCESS
) {

2939  
»t
;

2942  
»t
;

2943 
	}
}

2953 
	$FIO_CONFIGURE_SPAN_SIGNALING_FUNCTION
(
ádm_§ngoma_isdn_p_cÚfigu»_¥ª
)

2955 
¢gisdn_p_audio_mix_mode_t
 
mixaudio
 = 
ISDN_TAP_AUDIO_MIX_NULL
;

2956 
¢gisdn_p_içû_t
 
içû
 = 
ISDN_TAP_IFACE_UNKNOWN
;

2957 
¢gisd_p_mode_t
 
pmode
 = 
ISDN_TAP_NORMAL
;

2958 
ádm_boŞ_t
 
ev’t_šd
 = 
FTDM_FALSE
;

2959 
ádm_chªÃl_t
 *
dchª
 = 
NULL
;

2960 
ádm_¥ª_t
 *
³”¥ª
 = 
NULL
;

2961 
¢gisdn_p_t
 *
p
 = 
NULL
;

2962 cÚ¡ *
debug
 = 
NULL
;

2963 
swtch_typ
 = 
SW_ETSI
;

2964 
·¿mšdex
 = 0;

2965 cÚ¡ *
v¬
, *
v®
;

2966 
štf
 = 
NETWORK
;

2967 
ušt32_t
 
idx
 = 0;

2969 
p
 = 
	`ádm_ÿÎoc
(1, (*tap));

2970 ià(!
p
) {

2971  
FTDM_FAIL
;

2974 
¥ª
->
sigÇl_d©a
 = 
p
;

2976 
p
->
nçs
.
Œunk
 = 
NULL
;

2977 
p
->
¥ª
 = span;

2979 ià(
¥ª
->
Œunk_ty³
 >ğ
FTDM_TRUNK_NONE
) {

2980 
	`ádm_log
(
FTDM_LOG_WARNING
, "Inv®idrunky³ '%s' deçuÉšgØT1.\n", 
	`ádm_Œunk_ty³2¡r
(
¥ª
->
Œunk_ty³
));

2981 
¥ª
->
Œunk_ty³
 = 
FTDM_TRUNK_T1
;

2985 
·¿mšdex
 = 0; 
ádm_·¿m‘”s
[·¿mšdex].
v¬
;…aramindex++) {

2986 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Sªgom¨ISDN T­pšg key = v®ue, % ğ%s\n", 
ádm_·¿m‘”s
[
·¿mšdex
].
v¬
, ftdm_·¿m‘”s[·¿mšdex].
v®
);

2987 
v¬
 = 
ádm_·¿m‘”s
[
·¿mšdex
].var;

2988 
v®
 = 
ádm_·¿m‘”s
[
·¿mšdex
].val;

2990 ià(!
	`¡rÿ£cmp
(
v¬
, "trunkgroup")) {

2991 ià(
	`§ngoma_isdn_p_·r£_Œunkgroup
(
v®
è!ğ
FTDM_SUCCESS
) {

2992 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id­pšgrunkgou°% šfØfÜ s·À%s!\n", 
v®
, 
¥ª
->
Çme
);

2993  
FTDM_FAIL
;

2998 
·¿mšdex
 = 0; 
ádm_·¿m‘”s
[·¿mšdex].
v¬
;…aramindex++) {

2999 
v¬
 = 
ádm_·¿m‘”s
[
·¿mšdex
].var;

3000 
v®
 = 
ádm_·¿m‘”s
[
·¿mšdex
].val;

3001 
	`ádm_log
(
FTDM_LOG_DEBUG
, "Sªgom¨ISDN T­pšg key=v®ue, %s=%s\n", 
v¬
, 
v®
);

3003 ià(!
	`¡rÿ£cmp
(
v¬
, "debug")) {

3004 
debug
 = 
v®
;

3005 } ià(!
	`¡rÿ£cmp
(
v¬
, "mixaudio")) {

3006 ià(
	`ádm_Œue
(
v®
è|| !
	`¡rÿ£cmp
(val, "both")) {

3007 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg mix‡udiØmodtØ'bÙh' fÜ s·À%s\n", 
¥ª
->
Çme
);

3008 
mixaudio
 = 
ISDN_TAP_AUDIO_MIX_BOTH
;

3009 } ià(!
	`¡rÿ£cmp
(
v®
, "peer")) {

3010 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg mix‡udiØmodtØ'³”' fÜ s·À%s\n", 
¥ª
->
Çme
);

3011 
mixaudio
 = 
ISDN_TAP_AUDIO_MIX_PEER
;

3012 } ià(!
	`¡rÿ£cmp
(
v®
, "stereo")) {

3013 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg mix‡udiØmodtØ'¡”eo' fÜ s·À%s\n", 
¥ª
->
Çme
);

3014 
mixaudio
 = 
ISDN_TAP_AUDIO_MIX_STEREO
;

3016 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg mix‡udiØmodtØ'£lf' fÜ s·À%s\n", 
¥ª
->
Çme
);

3017 
mixaudio
 = 
ISDN_TAP_AUDIO_MIX_SELF
;

3019 } ià(!
	`¡rÿ£cmp
(
v¬
, "interface")) {

3020 ià(!
	`¡rÿ£cmp
(
v®
, "cpe")) {

3021 
içû
 = 
ISDN_TAP_IFACE_CPE
;

3022 } ià(!
	`¡rÿ£cmp
(
v®
, "net")) {

3023 
içû
 = 
ISDN_TAP_IFACE_NET
;

3025 
	`ádm_log
(
FTDM_LOG_WARNING
, "IgnÜšg inv®id­pšg iÁ”çûy³ %s\n", 
v®
);

3027 } ià(!
	`¡rÿ£cmp
(
v¬
, "peerspan")) {

3028 ià(
	`ádm_¥ª_fšd_by_Çme
(
v®
, &
³”¥ª
è!ğ
FTDM_SUCCESS
) {

3029 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id­pšg…“¸¥ª %s\n", 
v®
);

3032 } ià(!
	`¡rÿ£cmp
(
v¬
, "tapmode")) {

3033 ià(!
	`¡rÿ£cmp
(
v®
, "bi-dir")) {

3034 
pmode
 = 
ISDN_TAP_BI_DIRECTION
;

3035 } ià(!
	`¡rÿ£cmp
(
v®
, "fs")) {

3036 
pmode
 = 
ISDN_TAP_FS
;

3038 
pmode
 = 
ISDN_TAP_NORMAL
;

3040 
	`ádm_log
(
FTDM_LOG_DEBUG
, "ISDN T­pšg i ruÂšg iÀ% mode\n", 
	`SNG_DECODE_ISDN_TAP_MODE
(
pmode
));

3041 } ià(!
	`¡rÿ£cmp
(
v¬
, "interface_type")) {

3042 ià(!
	`¡rÿ£cmp
(
v®
, "network")) {

3043 
štf
 = 
NETWORK
;

3044 } ià(!
	`¡rÿ£cmp
(
v®
, "user")) {

3045 
štf
 = 
USER
;

3047 
	`ádm_log
(
FTDM_LOG_WARNING
, "IgnÜšg inv®id­pšg iÁ”çûy³ %s\n", 
v®
);

3049 } ià(!
	`¡rÿ£cmp
(
v¬
, "switch_type")) {

3050 
swtch_typ
 = 
	`ádm_§ngoma_isdn_g‘_sw™ch_ty³
(
v®
);

3051 ià(
swtch_typ
 == -1) {

3052 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id sw™chy³ '%s' fÜ s·À'%s'\n", 
v®
, 
¥ª
->
Çme
);

3053  
FTDM_FAIL
;

3055 } ià(!
	`¡rÿ£cmp
(
v¬
, "queue-size")) {

3056 
p_dchª_queue_size
 = 
	`©oi
(
v®
);

3057 ià(
p_dchª_queue_size
) {

3058 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id TX/RX Queusiz'%s' fÜ s·À'%s'\n", 
v®
, 
¥ª
->
Çme
);

3060 
p_dchª_queue_size
 = 
ISDN_TAP_DCHAN_QUEUE_LEN
;

3062 
	`ádm_log
(
FTDM_LOG_INFO
, "TX/RX Queusiz'%d' i »ûived by u£¸cÚfigu¿tiÚ fÜ s·À'%s'\n", 
p_dchª_queue_size
, 
¥ª
->
Çme
);

3063 } ià(!
	`¡rÿ£cmp
(
v¬
, "spanmap")) {

3064 ià(
	`§ngoma_isdn_p_·r£_¥ªm­
(
v®
, 
¥ª
è!ğ
FTDM_SUCCESS
) {

3065 
	`ádm_log
(
FTDM_LOG_ERROR
, "Inv®id­ NFAS cÚfigu¿tiÚ s·n_m­ '%s' fÜ s·À'%s'\n", 
v®
, 
¥ª
->
Çme
);

3066  
FTDM_FAIL
;

3068 } ià(!
	`¡rÿ£cmp
(
v¬
, "trunkgroup")) {

3070 } ià(!
	`¡rÿ£cmp
(
v¬
, "call_info_indication")) {

3071 ià(
	`ádm_Œue
(
v®
)) {

3072 
ev’t_šd
 = 
FTDM_TRUE
;

3073 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg c®Èšfom©iÚ indiÿtiÚØTRUE fÜ s·À'%s'\n", 
¥ª
->
Çme
);

3075 
ev’t_šd
 = 
FTDM_FALSE
;

3076 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg c®Èšfom©iÚ indiÿtiÚØFALSE fÜ s·À'%s'\n", 
¥ª
->
Çme
);

3079 
	`ádm_log
(
FTDM_LOG_ERROR
, "UnknowÀisdÀµšg…¬am‘” [%s]\n", 
v¬
);

3084 ià((!
p
->
nçs
.
Œunk
è|| (p->nçs.
sigchª
 !ğ
SNGISDN_NFAS_DCHAN_NONE
)) {

3085 
idx
 = 1; idx <ğ
¥ª
->
chª_couÁ
; idx++) {

3086 ià(
¥ª
->
chªÃls
[
idx
]->
ty³
 =ğ
FTDM_CHAN_TYPE_DQ921
) {

3087 
dchª
 = 
¥ª
->
chªÃls
[
idx
];

3092 ià(!
dchª
) {

3093 
	`ádm_log
(
FTDM_LOG_ERROR
, "No d-channel specified in freetdm.conf!\n");

3094  
FTDM_FAIL
;

3097 
p
->
dchª
 = dchan;

3101 ià(!
³”¥ª
) {

3102 
	`ádm_log
(
FTDM_LOG_ERROR
, "No valid…eerspan was specified!\n");

3103  
FTDM_FAIL
;

3107 
p
->
³nd_ÿÎ_l¡
 = 
	`ü—‹_hashbË
(
FTDM_MAX_CHANNELS_PHYSICAL_SPAN
, 
ádm_hash_hashäom¡ršg
, 
ádm_hash_equ®keys
);

3109 
p
->
šdiÿ‹_ev’t
 = 
ev’t_šd
;

3110 
p
->
debug
 = 
	`·r£_debug
(debug);

3111 
p
->
³”¥ª
 =…eerspan;

3112 
p
->
mixaudio
 = mixaudio;

3113 
p
->
içû
 = iface;

3114 
p
->
sw™ch_ty³
 = 
swtch_typ
;

3115 
p
->
p_mode
 = 
pmode
;

3118 
p
->
decCb
 = 
	`¢g_q931_decod”_g‘cb
();

3119 ià(
NULL
 =ğ
p
->
decCb
) {

3120 
	`ádm_log
(
FTDM_LOG_ERROR
, " Failedo get memory for q931 decoder control block \n");

3121  
FTDM_FAIL
;

3125 ià(
	`q931_decod”_š™
(
štf
, 
p
->
decCb
)) {

3127 ià(
p
->
decCb
) {

3128 
	`¢g_q931_decod”_ä“cb
(
p
->
decCb
);

3131 
	`ádm_log
(
FTDM_LOG_ERROR
, " Failedo initialize q931 decoder control block \n");

3132  
FTDM_FAIL
;

3136 
¥ª
->
¡¬t
 = 
ádm_§ngoma_isdn_p_¡¬t
;

3137 
¥ª
->
¡İ
 = 
ádm_§ngoma_isdn_p_¡İ
;

3139 ià(
p
->
mixaudio
 =ğ
ISDN_TAP_AUDIO_MIX_NULL
) {

3140 
¥ª
->
sig_»ad
 = 
NULL
;

3142 
¥ª
->
sig_»ad
 = 
ádm_§ngoma_isdn_p_medŸ_»ad
;

3145 
¥ª
->
sigÇl_cb
 = 
sig_cb
;

3147 
¥ª
->
sigÇl_ty³
 = 
FTDM_SIGTYPE_ISDN
;

3148 
¥ª
->
outgošg_ÿÎ
 = 
§ngoma_isdn_p_outgošg_ÿÎ
;

3150 
¥ª
->
g‘_chªÃl_sig_¡©us
 = 
§ngoma_isdn_p_g‘_chªÃl_sig_¡©us
;

3151 
¥ª
->
g‘_¥ª_sig_¡©us
 = 
§ngoma_isdn_p_g‘_¥ª_sig_¡©us
;

3153 
¥ª
->
¡©e_m­
 = &
¢gisdn_p_¡©e_m­
;

3154 
¥ª
->
¡©e_´oûssÜ
 = 
¡©e_advªû
;

3156 ià(
p
->
p_mode
 =ğ
ISDN_TAP_BI_DIRECTION
) {

3157 
	`ádm_log
(
FTDM_LOG_INFO
, "S‘tšg SKIP s‹ fÏg fÜ s·À%d\n", 
¥ª
->
¥ª_id
);

3160 
	`ádm_£t_æag
(
¥ª
, 
FTDM_SPAN_USE_SKIP_STATES
);

3164 ià(!
g_decod”_lib_š™
) {

3166 
¢g_ev’t
.
¢g_log
 = 
hªdË_isdn_µšg_log
;

3169 ià(
	`¢g_decod”_lib_š™
(&
¢g_ev’t
)) {

3170 
	`ádm_log
(
FTDM_LOG_ERROR
, " Failedo initialize decoder†ib \n");

3171  
FTDM_FAIL
;

3174 
g_decod”_lib_š™
 = 0x01;

3178 
	`ádm_§ngoma_isdn_p_io_¡©s
(
NULL
, 
¥ª
, "enable");

3181 
g_¢gisdn_p_d©a
.
p_¥ªs
[g_¢gisdn_p_d©a.
num_¥ªs_cÚfigu»d
++] = 
p
;

3183 
	`ádm_log
(
FTDM_LOG_DEBUG
, "CÚfigu»d­ fÜ s·À[%d]!\n", 
¥ª
->
¥ª_id
);

3184  
FTDM_SUCCESS
;

3185 
	}
}

3194 
¢gisdn_t
 *
	$§ngoma_isdn_Ãw_cb
(
ádm_sock‘_t
 
fd
, 
nod‘y³
, 
sw™chty³
, *
u£rd©a
)

3196 
¢gisdn_t
 *
p
;

3198 ià(!(
p
 = 
	`ádm_ÿÎoc
(1, (*p))))

3199  
NULL
;

3201 
p
->
fd
 = fd;

3202 
p
->
u£rd©a
 = userdata;

3203 
p
->
loÿÉy³
 = 
nod‘y³
;

3204 
p
->
sw™chty³
 = switchtype;

3205 
p
->
üef
 = 1;

3207  
p
;

3208 
	}
}

3217 *
	$§ngoma_isdn_g‘_u£rd©a
(
¢gisdn_t
 *
´i
)

3219  
´i
 ?…ri->
u£rd©a
 : 
NULL
;

3220 
	}
}

3229 
	$hªdË_isdn_µšg_log
(
ušt8_t
 
Ëv–
, *
fmt
,...)

3231 *
d©a
;

3232 
»t
;

3233 
va_li¡
 
­
;

3235 
	`va_¡¬t
(
­
, 
fmt
);

3236 
»t
 = 
	`ádm_va¥rštf
(&
d©a
, 
fmt
, 
­
);

3237 ià(
»t
 == -1) {

3238 
’d
;

3241 
Ëv–
) {

3243 
SNG_LOGLEVEL_DEBUG
:

3244 
	`ádm_log
(
FTDM_LOG_DEBUG
, "¢g_decod”_lib->%s", 
d©a
);

3247 
SNG_LOGLEVEL_WARN
:

3248 
	`ádm_log
(
FTDM_LOG_WARNING
, "¢g_decod”_lib->%s", 
d©a
);

3251 
SNG_LOGLEVEL_INFO
:

3252 
	`ádm_log
(
FTDM_LOG_INFO
, "¢g_decod”_lib->%s", 
d©a
);

3255 
SNG_LOGLEVEL_ERROR
:

3256 
	`ádm_log
(
FTDM_LOG_ERROR
, "¢g_decod”_lib->%s", 
d©a
);

3259 
SNG_LOGLEVEL_CRIT
:

3261 
	`ádm_log
(
FTDM_LOG_CRIT
, "¢g_decod”_lib->%s", 
d©a
);

3265 
	`ádm_log
(
FTDM_LOG_INFO
, "¢g_decod”_lib->%s", 
d©a
);

3270 
’d
:

3271 
	`ádm_§ã_ä“
(
d©a
);

3272 
	`va_’d
(
­
);

3274 
	}
}

3283 
	$§ngoma_isdn_p_£t_debug
(
¢gisdn_t
 *
´i
, 
debug
)

3285 ià(!
´i
)

3287 
´i
->
debug
 = debug;

3288 
	}
}

3298 
ádm_¡©us_t
 
	$§ngoma_isdn_p_£t_p_msg_šfo
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
¢g_decod”_š‹rçû_t
 *
štfCb
)

3300 ià(!
p
) {

3301 
	`ádm_log
(
FTDM_LOG_ERROR
, "sangoma_isdn_tap_set_tap_msg_info failed. Invalidap structure\n");

3302  
FTDM_FAIL
;

3305 ià(!
štfCb
) {

3306 
	`ádm_log
(
FTDM_LOG_ERROR
, "sangoma_isdn_tap_set_tap_msg_info failed. Invalid intreface structure\n");

3307  
FTDM_FAIL
;

3311 
pÿÎ
->
p_msg
.
¥ª_id
 = 
p
->
¥ª
->span_id;

3312 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg chªÃÈID[%d] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
¥ª_id
);

3315 
pÿÎ
->
p_msg
.
ÿÎ_»f
 = 
štfCb
->call_ref;

3316 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®È»ã»û[%d] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎ_»f
);

3319 
pÿÎ
->
p_msg
.
ÿÎ_cÚ
 = 0;

3321 ià(
msgTy³
 =ğ
Q931_SETUP
) {

3323 
pÿÎ
->
p_msg
.
chª_id
 = 
štfCb
->chan_id;

3324 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg chªÃÈID[%d] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
chª_id
);

3327 
pÿÎ
->
p_msg
.
ÿÎ_dœ
 = 
CALL_DIRECTION_INBOUND
;

3330 ià(!
	`ádm_¡¾’_z”o
(
štfCb
->
şd_num
)) {

3331 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎed_num
, 
štfCb
->
şd_num
);

3332 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®Ëd Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎed_num
);

3336 ià(!
	`ádm_¡¾’_z”o
(
štfCb
->
şg_num
)) {

3337 
	`ádm_£t_¡ršg
(
pÿÎ
->
p_msg
.
ÿÎšg_num
, 
štfCb
->
şg_num
);

3338 
	`ádm_log
(
FTDM_LOG_DEBUG
, "S‘tšg C®lšg Numb”[%s] iÀ°mes§g¡ruùu»\n", 
pÿÎ
->
p_msg
.
ÿÎšg_num
);

3340 } ià(
msgTy³
 =ğ
Q931_CONNECT
) {

3342 
pÿÎ
->
p_msg
.
ÿÎ_dœ
 = 
CALL_DIRECTION_OUTBOUND
;

3345  
FTDM_SUCCESS
;

3346 
	}
}

3355 
	$ádm_§ngoma_isdn_g‘_sw™ch_ty³
(cÚ¡ *
v®
)

3357 
sw™ch_ty³
;

3359 ià(!
	`¡rÿ£cmp
(
v®
, "test")) {

3360 
sw™ch_ty³
 = 
SW_TST
;

3361 } ià(!
	`¡rÿ£cmp
(
v®
, "ccitt")) {

3362 
sw™ch_ty³
 = 
SW_CCITT
;

3363 } ià(!
	`¡rÿ£cmp
(
v®
, "att5eb")) {

3364 
sw™ch_ty³
 = 
SW_ATT5EB
;

3365 } ià(!
	`¡rÿ£cmp
(
v®
, "att5ep")) {

3366 
sw™ch_ty³
 = 
SW_ATT5EP
;

3367 } ià(!
	`¡rÿ£cmp
(
v®
, "att4e")) {

3368 
sw™ch_ty³
 = 
SW_ATT4E
;

3369 } ià(!
	`¡rÿ£cmp
(
v®
, "ntdms100b")) {

3370 
sw™ch_ty³
 = 
SW_NTDMS100B
;

3371 } ià(!
	`¡rÿ£cmp
(
v®
, "ntdms100p")) {

3372 
sw™ch_ty³
 = 
SW_NTDMS100P
;

3373 } ià(!
	`¡rÿ£cmp
(
v®
, "vn2")) {

3374 
sw™ch_ty³
 = 
SW_VN2
;

3375 } ià(!
	`¡rÿ£cmp
(
v®
, "vn3")) {

3376 
sw™ch_ty³
 = 
SW_VN3
;

3377 } ià(!
	`¡rÿ£cmp
(
v®
, "insnet")) {

3378 
sw™ch_ty³
 = 
SW_INSNET
;

3379 } ià(!
	`¡rÿ£cmp
(
v®
, "tr6mpc")) {

3380 
sw™ch_ty³
 = 
SW_TR6MPC
;

3381 } ià(!
	`¡rÿ£cmp
(
v®
, "tr6pbx")) {

3382 
sw™ch_ty³
 = 
SW_TR6PBX
;

3383 } ià(!
	`¡rÿ£cmp
(
v®
, "ausb")) {

3384 
sw™ch_ty³
 = 
SW_AUSB
;

3385 } ià(!
	`¡rÿ£cmp
(
v®
, "ausp")) {

3386 
sw™ch_ty³
 = 
SW_AUSP
;

3387 } ià(!
	`¡rÿ£cmp
(
v®
, "ni1")) {

3388 
sw™ch_ty³
 = 
SW_NI1
;

3389 } ià(!
	`¡rÿ£cmp
(
v®
, "etsi")) {

3390 
sw™ch_ty³
 = 
SW_ETSI
;

3391 } ià(!
	`¡rÿ£cmp
(
v®
, "bc303tmc")) {

3392 
sw™ch_ty³
 = 
SW_BC303TMC
;

3393 } ià(!
	`¡rÿ£cmp
(
v®
, "bc303csc")) {

3394 
sw™ch_ty³
 = 
SW_BC303CSC
;

3395 } ià(!
	`¡rÿ£cmp
(
v®
, "ntdms250")) {

3396 
sw™ch_ty³
 = 
SW_NTDMS250
;

3397 } ià(!
	`¡rÿ£cmp
(
v®
, "ni2")) {

3398 
sw™ch_ty³
 = 
SW_NI2
;

3399 } ià(!
	`¡rÿ£cmp
(
v®
, "qsig")) {

3400 
sw™ch_ty³
 = 
SW_QSIG
;

3401 } ià(!
	`¡rÿ£cmp
(
v®
, "ntmci")) {

3402 
sw™ch_ty³
 = 
SW_NTMCI
;

3403 } ià(!
	`¡rÿ£cmp
(
v®
, "ntni")) {

3404 
sw™ch_ty³
 = 
SW_NTNI
;

3405 } ià(!
	`¡rÿ£cmp
(
v®
, "bellcore")) {

3406 
sw™ch_ty³
 = 
SW_BELLCORE
;

3407 } ià(!
	`¡rÿ£cmp
(
v®
, "gsm")) {

3408 
sw™ch_ty³
 = 
SW_GSM
;

3410 
sw™ch_ty³
 = -1;

3413  
sw™ch_ty³
;

3414 
	}
}

3423 
EX_DECLARE_DATA
 
ádm_moduË_t
 
	gádm_moduË
 = {

3425 
ádm_§ngoma_isdn_p_io_š™
,

3426 
ádm_§ngoma_isdn_p_uÆßd
,

3427 
ádm_§ngoma_isdn_p_š™
,

3428 
NULL
,

3429 
NULL
,

3430 
ádm_§ngoma_isdn_p_cÚfigu»_¥ª
,

3446 
	$COMMAND_HANDLER
(
¡©i¡ics
)

3448 ià(
¬gc
) {

3449 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ sti¡ic commªd\n", 
¬gv
[1]);

3450  
FTDM_FAIL
;

3453 
¡»am
->
	`wr™e_funùiÚ
(stream, "**********************************************************\n");

3454 
¡»am
->
	`wr™e_funùiÚ
(stream, " Calls Statistics \n");

3455 
¡»am
->
	`wr™e_funùiÚ
(stream, "**********************************************************\n");

3456 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°Reûived = %d\n", 
£tup_»cv
);

3457 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°Reûived w™h inv®id chªÃl = %d\n", 
£tup_»cv_šv®id_chªId
);

3458 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°nÙ Reûived = %d\n", 
£tup_nÙ_»cv
);

3459 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàC®ÈProûed Reûived = %d\n", 
ÿÎ_´oûed_»cv
);

3460 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÂeù Reûived = %d\n", 
cÚÃù_»cv
);

3461 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàE¬ly CÚÂeù Reûived = %d\n", 
—¾y_cÚÃù_»cv
);

3462 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàL©Inv™Reûived = %d\n", 
Ï‹_šv™e_»cv
);

3463 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÂeù Reûived w™h chªÃl = %d\n", 
cÚÃù_»cv_w™h_chªId
);

3464 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàMes§g»ûived‡á” %d secÚds = %d\n", 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
, 
msg_»cv_aá_time
);

3465 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàDiscÚÃù Reûived = %d\n", 
discÚÃù_»cv
);

3466 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàR–—£ Reûived = %d\n", 
»Ëa£_»cv
);

3467 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàT­³d fe g’”©ed = %d\n", 
ÿÎ_µed
);

3468 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÃù Reûived wh”ChªÃÈwa In-U£ = %d\n", 
»u£_chª_cÚ_»cv
);

3470  
FTDM_SUCCESS
;

3471 
	}
}

3480 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_show_¥ª_¡©us
(
ádm_¡»am_hªdË_t
 *
¡»am
, 
ádm_¥ª_t
 *
¥ª
)

3482 
ádm_®¬m_æag_t
 
®¬mb™s
 = 
FTDM_ALARM_NONE
;

3483 
ádm_sigÇlšg_¡©us_t
 
sig¡©us
;

3484 
ádm_chªÃl_t
 *
sig_chª
 = 
NULL
;

3485 
ádm_chªÃl_t
 *
fchª
 = 
NULL
;

3486 
ušt32_t
 
chª_idx
 = 0;

3488 
sig_chª
 = ((
¢gisdn_p_t
 *)
¥ª
->
sigÇl_d©a
)->
dchª
;

3490 ià(
sig_chª
) {

3491 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "SIGNALLING SPAN % ¡©u ->\n", 
¥ª
->
Çme
);

3493 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "PURE VOICE SPAN % ¡©u ->\n", 
¥ª
->
Çme
);

3496 
chª_idx
 = 1; chª_idx <ğ
¥ª
->
chª_couÁ
; chan_idx++) {

3497 
fchª
 = 
¥ª
->
chªÃls
[
chª_idx
];

3498 
®¬mb™s
 = 
FTDM_ALARM_NONE
;

3500 ià(
fchª
) {

3501 
	`ádm_chªÃl_g‘_®¬ms
(
fchª
, &
®¬mb™s
);

3503 
	`ádm_chªÃl_g‘_sig_¡©us
(
fchª
, &
sig¡©us
);

3505 ià((
sig_chª
è&& (sig_chª->
¥ª_id
 =ğ
fchª
->¥ª_idè&& (sig_chª->
chª_id
 == fchan->chan_id)) {

3506 
¡»am
->
	`wr™e_funùiÚ
(stream, "span = %2d|chan = %2d|phy_status = %4s|SIGNALLING LINK|state = %s|\n",

3507 
¥ª
->
¥ª_id
, 
fchª
->
physiÿl_chª_id
, 
®¬mb™s
 ? "ALARMED" : "OK",

3508 
	`ádm_chªÃl_¡©e2¡r
(
fchª
->
¡©e
));

3510 
¡»am
->
	`wr™e_funùiÚ
(stream, "span = %2d|chan = %2d|phy_status = %4s|sig_status = %4s|state = %s|\n",

3511 
¥ª
->
¥ª_id
, 
fchª
->
physiÿl_chª_id
, 
®¬mb™s
 ? "ALARMED" : "OK",

3512 
	`ádm_sigÇlšg_¡©us2¡r
(
sig¡©us
),

3513 
	`ádm_chªÃl_¡©e2¡r
(
fchª
->
¡©e
));

3518 
¡»am
->
	`wr™e_funùiÚ
(stream, "***********************************************************************\n");

3520  
FTDM_SUCCESS
;

3521 
	}
}

3530 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_show_nçs_cÚfig
(
ádm_¡»am_hªdË_t
 *
¡»am
, 
¢gisdn_p_t
 *
p
)

3532 
¢gisdn_p_t
 *
nçs_p
 = 
NULL
;

3533 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

3534 
idx
 = 0;

3536 
¡»am
->
	`wr™e_funùiÚ
(stream, "***********************************************************************\n");

3537 ià(!
p
->
nçs
.
Œunk
) {

3538 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "S·À% i nÙ cÚfigu»d‡ NFAS s·n\n", 
p
->
¥ª
->
Çme
);

3539  
FTDM_FAIL
;

3542 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "NFAS Group: %s\n", 
p
->
nçs
.
Œunk
->
Çme
);

3544 
idx
 = 0; idx < 
p
->
nçs
.
Œunk
->
num_p_¥ªs
; idx++) {

3545 ià(!
p
->
nçs
.
Œunk
->
p_¥ªs
[
idx
]) {

3546 
	`ádm_log
(
FTDM_LOG_ERROR
, "No ISDN NFAS Tap span found‡t index %d for span %s\n",

3547 
idx
, 
p
->
¥ª
->
Çme
);

3548  
FTDM_FAIL
;

3551 
¥ª
 = 
p
->
nçs
.
Œunk
->
p_¥ªs
[
idx
];

3552 
nçs_p
 = 
¥ª
->
sigÇl_d©a
;

3554 
¡»am
->
	`wr™e_funùiÚ
(stream, "Span = %s|†ogical span ID = %d| Span Type = %s|\n",

3555 
nçs_p
->
¥ª
->
Çme
, 
idx
, 
	`SNG_ISDN_TAP_GET_NFAS_SPAN_TYPE
Òçs_p->
nçs
.
sigchª
));

3558  
FTDM_SUCCESS
;

3560 
	}
}

3569 
ádm_¡©us_t
 
	$ádm_§ngoma_isdn_p_io_¡©s
(
ádm_¡»am_hªdË_t
 *
¡»am
, 
ádm_¥ª_t
 *
¥ª
, cÚ¡ * 
cmd
)

3571 
ádm_™”©Ü_t
 *
chª™”
 = 
NULL
;

3572 
ádm_chªÃl_t
 *
ádmchª
 = 
NULL
;

3573 
ádm_™”©Ü_t
 *
cu¼
 = 
NULL
;

3574 
ádm_chªÃl_io¡©s_t
 
¡©s
;

3575 
’abË
 = 0;

3577 ià((
NULL
 =ğ
cmd
è|| (NULL =ğ
¥ª
)) {

3578 
¡»am
->
	`wr™e_funùiÚ
(stream, "Error Enabling IO Stats..invalid span \n");

3579  
FTDM_FAIL
;

3582 ià(
¡»am
) {

3583 
¡»am
->
	`wr™e_funùiÚ
(stream, "***********************************************************************\n");

3586 
chª™”
 = 
	`ádm_¥ª_g‘_chª_™”©Ü
(
¥ª
, 
NULL
);

3587 
cu¼
 = 
chª™”
; cu¼; cu¼ = 
	`ádm_™”©Ü_Ãxt
(curr)) {

3588 
ádmchª
 = (
ádm_chªÃl_t
*)
	`ádm_™”©Ü_cu¼’t
(
cu¼
);

3590 ià(!
ádmchª
 || !
cmd
) {

3591 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-- Inv®id chªÃl/commªd '%s' found!", 
cmd
);

3592  
FTDM_FAIL
;

3595 ià(!
	`¡rÿ£cmp
("’abË", 
cmd
)) {

3596 
’abË
 = 1;

3597 
	`ádm_chªÃl_commªd
(
ádmchª
, 
FTDM_COMMAND_SWITCH_IOSTATS
, &
’abË
);

3598 ià(
¡»am
) {

3599 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "IO STATS EÇbË sucûssfuÎy fÜ s·À%d chª %d\n", 
ádmchª
->
¥ª_id
, ftdmchª->
chª_id
);

3601 } ià(!
	`¡rÿ£cmp
("di§bË", 
cmd
)) {

3602 
’abË
 = 0;

3603 
	`ádm_chªÃl_commªd
(
ádmchª
, 
FTDM_COMMAND_SWITCH_IOSTATS
, &
’abË
);

3604 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "IO STATS Di§bË sucûssfuÎy fÜ s·À%d chª %d\n", 
ádmchª
->
¥ª_id
, ftdmchª->
chª_id
);

3605 } ià(!
	`¡rÿ£cmp
("æush", 
cmd
)) {

3606 
	`ádm_chªÃl_commªd
(
ádmchª
, 
FTDM_COMMAND_FLUSH_IOSTATS
, 
NULL
);

3607 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "IO STATS Flushed sucûssfuÎy fÜ s·À%d chª %d\n", 
ádmchª
->
¥ª_id
, ftdmchª->
chª_id
);

3608 } ià(!
	`¡rÿ£cmp
("show", 
cmd
)) {

3609 
	`ádm_chªÃl_commªd
(
ádmchª
, 
FTDM_COMMAND_GET_IOSTATS
, &
¡©s
);

3611 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-- IO sti¡ic fÜ chªÃÈ%d:%d --\n", 
	`ádm_chªÃl_g‘_¥ª_id
(
ádmchª
), 
	`ádm_chªÃl_g‘_id
(ftdmchan));

3612 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Rxƒ¼Üs: %u\n", 
¡©s
.
rx
.
”rÜs
);

3613 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Rx queusize: %u\n", 
¡©s
.
rx
.
queue_size
);

3614 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Rx queuËn: %u\n", 
¡©s
.
rx
.
queue_Ën
);

3615 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Rx couÁ: %lu\n", 
¡©s
.
rx
.
·ck‘s
);

3616 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Txƒ¼Üs: %u\n", 
¡©s
.
tx
.
”rÜs
);

3617 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Tx queusize: %u\n", 
¡©s
.
tx
.
queue_size
);

3618 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Tx queuËn: %u\n", 
¡©s
.
tx
.
queue_Ën
);

3619 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Tx couÁ: %lu\n", 
¡©s
.
tx
.
·ck‘s
);

3620 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "Tx idË: %lu\n", 
¡©s
.
tx
.
idË_·ck‘s
);

3623 
	`ádm_™”©Ü_ä“
(
chª™”
);

3625 ià(
¡»am
) {

3626 
¡»am
->
	`wr™e_funùiÚ
(stream, "***********************************************************************\n");

3629  
FTDM_SUCCESS
;

3630 
	}
}

3639 
	$COMMAND_HANDLER
(
show
)

3641 
¢gisdn_p_t
 *
p
 = 
NULL
;

3642 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

3643 
¥ª_id
 = 0;

3645 ià(
¬gc
 != 2) {

3646 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ show commªd\n", 
¬gv
[1]);

3647  
FTDM_FAIL
;

3650 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "span")) {

3651 ià(!
	`¡rÿ£cmp
(
¬gv
[1], "all")) {

3652 
¥ª_id
 = 0; s·n_id <ğ
g_¢gisdn_p_d©a
.
num_¥ªs_cÚfigu»d
; span_id++) {

3653 
p
 = 
g_¢gisdn_p_d©a
.
p_¥ªs
[
¥ª_id
];

3655 ià(
p
) {

3656 
	`ádm_§ngoma_isdn_p_show_¥ª_¡©us
(
¡»am
, 
p
->
¥ª
);

3660 
¥ª_id
 = 
	`©oi
(
¬gv
[1]);

3662 ià(
	`ádm_¥ª_fšd_by_Çme
(
¬gv
[0], &
¥ª
è!ğ
FTDM_SUCCESS
 && 
	`ádm_¥ª_fšd
(
¥ª_id
, &span) != FTDM_SUCCESS) {

3663 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR FaedØfšd TAP s·À'%s'\n", 
¬gv
[1]);

3664  
FTDM_FAIL
;

3667 ià(!
¥ª
 || !¥ª->
sigÇl_d©a
) {

3668 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR '%s' i nÙ‡ v®id TAP s·n\n", 
¬gv
[1]);

3669  
FTDM_FAIL
;

3672 
	`ádm_§ngoma_isdn_p_show_¥ª_¡©us
(
¡»am
, 
¥ª
);

3674 } ià(!
	`¡rÿ£cmp
(
¬gv
[0], "nfas")) {

3675 ià(!
	`¡rÿ£cmp
(
¬gv
[1], "config")) {

3676 
¥ª_id
 = 0; s·n_id <ğ
g_¢gisdn_p_d©a
.
num_¥ªs_cÚfigu»d
; span_id++) {

3677 
p
 = 
g_¢gisdn_p_d©a
.
p_¥ªs
[
¥ª_id
];

3679 ià((
p
è&& (p->
dchª
)) {

3680 
	`ádm_§ngoma_isdn_p_show_nçs_cÚfig
(
¡»am
, 
p
);

3684 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR '%s' i nÙ‡ v®id TAP s·n\n", 
¬gv
[1]);

3685 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-U£: ftdm isdn_°show‚ç cÚfig\n", 
¬gv
[1]);

3686  
FTDM_FAIL
;

3689 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ commªd\n", 
¬gv
[1]);

3690  
FTDM_FAIL
;

3693  
FTDM_SUCCESS
;

3694 
	}
}

3703 
	$COMMAND_HANDLER
(
io_¡©s
)

3705 
¢gisdn_p_t
 *
p
 = 
NULL
;

3706 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

3707 
¥ª_id
 = 0;

3709 ià(
¬gc
 != 3) {

3710 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ io_¡© commªd\n", 
¬gv
[1]);

3711  
FTDM_FAIL
;

3714 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "show")) {

3715 ià(!
	`¡rÿ£cmp
(
¬gv
[1], "span")) {

3716 ià(!
	`¡rÿ£cmp
(
¬gv
[2], "all")) {

3717 
¥ª_id
 = 0; s·n_id <ğ
g_¢gisdn_p_d©a
.
num_¥ªs_cÚfigu»d
; span_id++) {

3718 
p
 = 
g_¢gisdn_p_d©a
.
p_¥ªs
[
¥ª_id
];

3720 ià(
p
) {

3721 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
p
->
¥ª
, "show");

3725 
¥ª_id
 = 
	`©oi
(
¬gv
[2]);

3727 ià(
	`ádm_¥ª_fšd_by_Çme
(
¬gv
[2], &
¥ª
è!ğ
FTDM_SUCCESS
 && 
	`ádm_¥ª_fšd
(
¥ª_id
, &span) != FTDM_SUCCESS) {

3728 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR FaedØfšd TAP s·À'%s'\n", 
¬gv
[1]);

3729  
FTDM_FAIL
;

3732 ià(!
¥ª
 || !¥ª->
sigÇl_d©a
) {

3733 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR '%s' i nÙ‡ v®id TAP s·n\n", 
¬gv
[1]);

3734  
FTDM_FAIL
;

3737 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
¥ª
, "show");

3740 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ io_¡© show commªd '%s'\n", 
¬gv
[1]);

3741 
¡»am
->
	`wr™e_funùiÚ
(stream, "USAGE -> ftdm sangoma_isdn_tap io_stats show span <all/span_id>\n");

3742  
FTDM_FAIL
;

3744 } ià(!(
	`¡rÿ£cmp
(
¬gv
[0], "enable")) || !(strcasecmp(argv[0], "disable")) || !(strcasecmp(argv[0], "flush"))) {

3745 ià(!
	`¡rÿ£cmp
(
¬gv
[1], "span")) {

3746 ià(!
	`¡rÿ£cmp
(
¬gv
[2], "all")) {

3747 
¥ª_id
 = 0; s·n_id <ğ
g_¢gisdn_p_d©a
.
num_¥ªs_cÚfigu»d
; span_id++) {

3748 
p
 = 
g_¢gisdn_p_d©a
.
p_¥ªs
[
¥ª_id
];

3750 ià(
p
) {

3751 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "enable")) {

3752 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
p
->
¥ª
, "enable");

3753 } ià(!
	`¡rÿ£cmp
(
¬gv
[0], "disable")) {

3754 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
p
->
¥ª
, "disable");

3755 } ià(!
	`¡rÿ£cmp
(
¬gv
[0], "flush")) {

3756 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
p
->
¥ª
, "flush");

3758 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ io_¡© ’abË/di§bË/æush commªd\n", 
¬gv
[1]);

3759 
¡»am
->
	`wr™e_funùiÚ
(stream, "USAGE -> ftdm sangoma_isdn_tap io_stats <enable/disable/flush> span <all/span_id>\n");

3760  
FTDM_FAIL
;

3765 
¥ª_id
 = 
	`©oi
(
¬gv
[2]);

3767 ià(
	`ádm_¥ª_fšd_by_Çme
(
¬gv
[2], &
¥ª
è!ğ
FTDM_SUCCESS
 && 
	`ádm_¥ª_fšd
(
¥ª_id
, &span) != FTDM_SUCCESS) {

3768 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR FaedØfšd TAP s·À'%s'\n", 
¬gv
[1]);

3769  
FTDM_FAIL
;

3772 ià(!
¥ª
 || !¥ª->
sigÇl_d©a
) {

3773 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR '%s' i nÙ‡ v®id TAP s·n\n", 
¬gv
[2]);

3774  
FTDM_FAIL
;

3777 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "enable")) {

3778 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
¥ª
, "enable");

3779 } ià(!
	`¡rÿ£cmp
(
¬gv
[0], "disable")) {

3780 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
¥ª
, "disable");

3781 } ià(!
	`¡rÿ£cmp
(
¬gv
[0], "flush")) {

3782 
	`ádm_§ngoma_isdn_p_io_¡©s
(
¡»am
, 
¥ª
, "flush");

3784 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ io_¡© ’abË/di§bË/æush commªd\n", 
¬gv
[1]);

3785 
¡»am
->
	`wr™e_funùiÚ
(stream, "USAGE -> ftdm sangoma_isdn_tap io_stats <enable/disable/flush> span <all/span_id>\n");

3786  
FTDM_FAIL
;

3790 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ io_¡© ’abË/di§bË/æush commªd\n", 
¬gv
[1]);

3791 
¡»am
->
	`wr™e_funùiÚ
(stream, "USAGE -> ftdm sangoma_isdn_tap io_stats <enable/disable/flush> span <all/span_id>\n");

3792  
FTDM_FAIL
;

3795 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ commªd\n", 
¬gv
[1]);

3796  
FTDM_FAIL
;

3799  
FTDM_SUCCESS
;

3800 
	}
}

3810 
	$COMMAND_HANDLER
(
»£t
)

3812 ià(!
¬gc
) {

3813 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­„e£ˆcommªd\n", 
¬gv
[1]);

3814  
FTDM_FAIL
;

3817 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "counters")) {

3818 
£tup_»cv
 = 0;

3819 
£tup_»cv_šv®id_chªId
 = 0;

3820 
£tup_nÙ_»cv
 = 0;

3821 
ÿÎ_´oûed_»cv
 = 0;

3822 
cÚÃù_»cv
 = 0;

3823 
—¾y_cÚÃù_»cv
 = 0;

3824 
Ï‹_šv™e_»cv
 = 0;

3825 
cÚÃù_»cv_w™h_chªId
 = 0;

3826 
msg_»cv_aá_time
 = 0;

3827 
discÚÃù_»cv
 = 0;

3828 
»Ëa£_»cv
 = 0;

3829 
ÿÎ_µed
 = 0;

3830 
»u£_chª_cÚ_»cv
 =0;

3831 
¡»am
->
	`wr™e_funùiÚ
(stream, "**********************************************************\n");

3832 
¡»am
->
	`wr™e_funùiÚ
(stream, " Tap Counetrs Reset successfully \n");

3833 
¡»am
->
	`wr™e_funùiÚ
(stream, "**********************************************************\n");

3834 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°Reûived = %d\n", 
£tup_»cv
);

3835 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°Reûived w™h inv®id chªÃl = %d\n", 
£tup_»cv_šv®id_chªId
);

3836 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàS‘u°nÙ Reûived = %d\n", 
£tup_nÙ_»cv
);

3837 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàC®ÈProûed Reûived = %d\n", 
ÿÎ_´oûed_»cv
);

3838 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÂeù Reûived = %d\n", 
cÚÃù_»cv
);

3839 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàE¬ly CÚÂeù Reûived = %d\n", 
—¾y_cÚÃù_»cv
);

3840 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàL©Inv™Reûived = %d\n", 
Ï‹_šv™e_»cv
);

3841 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÂeù Reûived w™h chªÃl = %d\n", 
cÚÃù_»cv_w™h_chªId
);

3842 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàMes§g»ûived‡á” %d secÚds = %d\n", 
SNG_TAP_SUBEQUENT_MSG_TME_DURATION
, 
msg_»cv_aá_time
);

3843 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàDiscÚÃù Reûived = %d\n", 
discÚÃù_»cv
);

3844 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàR–—£ Reûived = %d\n", 
»Ëa£_»cv
);

3845 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàT­³d fe g’”©ed = %d\n", 
ÿÎ_µed
);

3846 
¡»am
->
	`wr™e_funùiÚ
(¡»am, " TÙ® Numb” oàCÚÃù Reûived wh”ChªÃÈwa In-U£ = %d\n", 
»u£_chª_cÚ_»cv
);

3848 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "-ERR Inv®id T­ commªd\n", 
¬gv
[1]);

3849  
FTDM_FAIL
;

3852  
FTDM_SUCCESS
;

3853 
	}
}

3863 cÚ¡ *
	mCMD
;

3864 
	mArgc
;

3865 
fCMD
 
	mHªdËr
;

3867 
	gISDN_TAP_COMMANDS
[] = {

3868 
COMMAND
(
¡©i¡ics
, 0),

3869 
COMMAND
(
show
, 1),

3870 
COMMAND
(
io_¡©s
, 2),

3871 
COMMAND
(
»£t
, 1),

3882 
	$FIO_API_FUNCTION
(
ádm_§ngoma_isdn_p_­i
)

3884 *
mycmd
 = 
NULL
, *
¬gv
[10] = { 0 };

3885 
¬gc
 = 0;

3886 
i
;

3887 
ádm_¡©us_t
 
¡©us
 = 
FTDM_FAIL
;

3888 
ádm_¡©us_t
 
syÁax
 = 
FTDM_FAIL
;

3890 ià(
d©a
) {

3891 
mycmd
 = 
	`ádm_¡rdup
(
d©a
);

3892 
¬gc
 = 
	`ádm_£·¿‹_¡ršg
(
mycmd
, ' ', 
¬gv
, ((argv) / (argv[0])));

3895 if(
¬gc
 > 0) {

3896 
i
=0;i<(
ISDN_TAP_COMMANDS
)/(ISDN_TAP_COMMANDS[0]);i++) {

3897 if(
	`¡rÿ£cmp
(
¬gv
[0],
ISDN_TAP_COMMANDS
[
i
].
CMD
)==0) {

3898 if(
¬gc
 -1 >ğ
ISDN_TAP_COMMANDS
[
i
].
Argc
) {

3899 
syÁax
 = 
FTDM_SUCCESS
;

3900 
¡©us
 = 
ISDN_TAP_COMMANDS
[
i
].
	`HªdËr
(
¡»am
, &
¬gv
[1], 
¬gc
-1);

3907 if(
FTDM_SUCCESS
 !ğ
syÁax
) {

3908 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "%s", 
FT_SYNTAX
);

3911 if(
FTDM_SUCCESS
 !ğ
¡©us
) {

3912 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "% Commªd Faed\r\n", 
ISDN_TAP_COMMANDS
[
i
].
CMD
);

3914 
	`ádm_§ã_ä“
(
mycmd
);

3916  
FTDM_SUCCESS
;

3918 *
mycmd
 = 
NULL
, *
¬gv
[10] = { 0 };

3919 
¬gc
 = 0;

3921 ià(
d©a
) {

3922 
mycmd
 = 
	`ádm_¡rdup
(
d©a
);

3923 
¬gc
 = 
	`ádm_£·¿‹_¡ršg
(
mycmd
, ' ', 
¬gv
, ((argv) / (argv[0])));

3926 ià(
¬gc
 > 2) {

3927 ià(!
	`¡rÿ£cmp
(
¬gv
[0], "debug")) {

3928 
ádm_¥ª_t
 *
¥ª
 = 
NULL
;

3930 ià(
	`ádm_¥ª_fšd_by_Çme
(
¬gv
[1], &
¥ª
è=ğ
FTDM_SUCCESS
) {

3931 
¢gisdn_p_t
 *
p
 = 
¥ª
->
sigÇl_d©a
;

3932 ià(
¥ª
->
¡¬t
 !ğ
ádm_§ngoma_isdn_p_¡¬t
) {

3933 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "%s: -ERR inv®id s·n.\n", 
__FILE__
);

3934 
dÚe
;

3938 
	`§ngoma_isdn_p_£t_debug
(
p
->
´i
, 
	`·r£_debug
(
¬gv
[2]));

3939 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "%s: +OK debug s‘.\n", 
__FILE__
);

3940 
dÚe
;

3942 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "%s: -ERR inv®id s·n.\n", 
__FILE__
);

3943 
dÚe
;

3949 
¡»am
->
	`wr™e_funùiÚ
(¡»am, "%s: -ERR inv®id commªd.\n", 
__FILE__
);

3951 
dÚe
:

3952 
	`ádm_§ã_ä“
(
mycmd
);

3953  
FTDM_SUCCESS
;

3955 
	}
}

	@ftmod_sangoma_isdn_tap.h

38 #iâdeà
__SNG_ISDN_TAP_H__


39 
	#__SNG_ISDN_TAP_H__


	)

46 
	#_GNU_SOURCE


	)

47 #iâdeà
WIN32


48 
	~<pŞl.h
>

51 
	~"´iv©e/ádm_cÜe.h
"

52 
	~<¡d¬g.h
>

53 
	~<ùy³.h
>

54 
	~<time.h
>

55 #ifdeà
WIN32


56 
	~<io.h
>

58 
	~"¢g_decod”.h
"

66 
	#FT_SYNTAX
 "USAGE:\n" \

72 "--------------------------------------------------------------------------------\n"

	)

75 
	#COMMAND_HANDLER
(
Çme
) \

76 
ádm_¡©us_t
 
fCMD_
##
	`Çme
(
ádm_¡»am_hªdË_t
 *
¡»am
, *
¬gv
[], 
¬gc
); \

77 
ádm_¡©us_t
 
fCMD_
##
	`Çme
(
ádm_¡»am_hªdË_t
 *
¡»am
, *
¬gv
[], 
¬gc
)

	)

80 
	#COMMAND
(
Çme
, 
¬gc
è{#Çme,‡rgc, 
fCMD_
##Çme}

	)

82 
	#MAX_PCALLS
 120

	)

83 
	#ISDN_TAP_DCHAN_QUEUE_LEN
 900

	)

84 
	#MAX_TAP_SPANS
 50

	)

87 
	#MAX_NFAS_GROUPS
 16

	)

88 
	#MAX_NFAS_GROUP_NAME
 50

	)

91 
	#MAX_SPANS_PER_NFAS_LINK
 16

	)

94 
	$ádm_¡©us_t
 (*
	tfCMD
)(
	tádm_¡»am_hªdË_t
 *
	t¡»am
, *
	t¬gv
[], 
	t¬gc
);

102 
	s¢gisdn_t
 {

103 
ádm_sock‘_t
 
fd
;

104 *
u£rd©a
;

105 
debug
;

106 
¡©e
;

107 
sw™chty³
;

108 
loÿÉy³
;

109 
üef
;

110 } 
¢gisdn_t
;

113 
ISDN_TAP_RUNNING
 = (1 << 0),

114 
ISDN_TAP_MASTER
 = (1 << 1),

115 } 
	t¢gisdn_p_æags_t
;

118 
PCALL_RING
 = 0,

119 
PCALL_CONN
 = 1,

120 } 
	t¢gisdn_p_cÚn_¡©e_t
;

123 
ISDN_TAP_AUDIO_MIX_BOTH
 = 0,

124 
ISDN_TAP_AUDIO_MIX_PEER
,

125 
ISDN_TAP_AUDIO_MIX_SELF
,

126 
ISDN_TAP_AUDIO_MIX_STEREO
,

127 
ISDN_TAP_AUDIO_MIX_NULL
,

128 } 
	t¢gisdn_p_audio_mix_mode_t
;

131 
CALL_DIRECTION_INBOUND
,

132 
CALL_DIRECTION_OUTBOUND
,

133 
CALL_DIRECTION_NONE


134 } 
	tp_ÿÎ_dœeùiÚ_t
;

137 
ušt32_t
 
chª_id
;

138 
ušt32_t
 
¥ª_id
;

139 
p_ÿÎ_dœeùiÚ_t
 
ÿÎ_dœ
;

140 
ÿÎ_»f
;

141 
ušt8_t
 
ÿÎ_cÚ
;

142 
ÿÎšg_num
[
FTDM_DIGITS_LIMIT
];

143 
ÿÎed_num
[
FTDM_DIGITS_LIMIT
];

144 } 
	tisdn_p_msg_šfo_t
;

147 
ádm_numb”_t
 
ÿÎšgnum
;

148 
ádm_numb”_t
 
ÿÎednum
;

149 
ádm_chªÃl_t
 *
fchª
;

150 
šu£
;

151 
ÿÎ»f_v®
;

152 
chªId
;

153 
time_t
 
t_£tup_»cv
;

154 
time_t
 
t_cÚ_»cv
;

155 
time_t
 
t_msg_»cv
;

156 
ádm_boŞ_t
 
»cv_£tup
;

157 
ádm_boŞ_t
 
»cv_cÚn
;

158 
ádm_boŞ_t
 
»cv_Ùh”_msg
;

159 
ádm_boŞ_t
 
ršg_ev’t_£Á
;

160 
isdn_p_msg_šfo_t
 
p_msg
;

161 
ádm_boŞ_t
 
chª_´es
;

162 } 
	t·ssive_ÿÎ_t
;

164 
	e¢gisdn_p_içû
 {

165 
ISDN_TAP_IFACE_UNKNOWN
 = 0,

166 
ISDN_TAP_IFACE_CPE
 = 1,

167 
ISDN_TAP_IFACE_NET
 = 2,

168 } 
	t¢gisdn_p_içû_t
;

171 
ISDN_TAP_NORMAL
 = 0,

172 
ISDN_TAP_BI_DIRECTION
 = 1,

173 
ISDN_TAP_FS
 = 2,

174 } 
	t¢gisd_p_mode_t
;

177 
SNGISDN_NFAS_DCHAN_NONE
,

178 
SNGISDN_NFAS_DCHAN_PRIMARY
,

179 
SNGISDN_NFAS_DCHAN_BACKUP
,

180 } 
	t¢gisdn_p_nçs_sigchª_t
;

182 
¢gisdn_p_nçs_d©a
;

183 
¢gisdn_p_nçs_d©a
 
	t¢gisdn_p_nçs_d©a_t
;

185 
	sisdn_p
 {

186 
št32_t
 
æags
;

187 
¢gisdn_t
 *
´i
;

188 
debug
;

189 
sw™ch_ty³
;

190 
¢gisdn_p_audio_mix_mode_t
 
mixaudio
;

191 
¢gisd_p_mode_t
 
p_mode
;

192 
ádm_chªÃl_t
 *
dchª
;

193 
ádm_¥ª_t
 *
¥ª
;

194 
ádm_¥ª_t
 *
³”¥ª
;

195 
ádm_mu‹x_t
 *
pÿÎs_lock
;

196 
·ssive_ÿÎ_t
 
pÿÎs
[
MAX_PCALLS
];

197 
¢gisdn_p_içû_t
 
içû
;

198 *
decCb
;

199 
ádm_hash_t
 *
³nd_ÿÎ_l¡
;

201 
	snçs_šfo
 {

202 
¢gisdn_p_nçs_sigchª_t
 
sigchª
;

203 
¢gisdn_p_nçs_d©a_t
 *
Œunk
;

204 
ušt8_t
 
š‹rçû_id
;

205 } 
nçs
;

206 
ádm_boŞ_t
 
šdiÿ‹_ev’t
;

207 } 
	t¢gisdn_p_t
;

209 
	s¢gisdn_p_nçs_d©a
 {

210 
Çme
[
MAX_NFAS_GROUP_NAME
];

211 
backup_¥ª_Çme
[20];

212 
dchª_¥ª_Çme
[20];

213 
¢gisdn_p_t
 *
dchª
;

214 
¢gisdn_p_t
 *
backup
;

215 
ušt8_t
 
num_p_¥ªs
;

216 
ušt8_t
 
num_¥ªs_cÚfigu»d
;

217 
ádm_¥ª_t
 *
p_¥ªs
[
MAX_SPANS_PER_NFAS_LINK
 + 1];

220 
	scÚ_ÿÎ_šfo
 {

221 
ÿÎ»f_v®
;

222 
time_t
 
cÚ»cv_time
;

223 
msgTy³
;

224 
ádm_boŞ_t
 
»cv_£tup
;

225 
ádm_boŞ_t
 
»cv_cÚ
;

226 
ádm_boŞ_t
 
p_´oûed
;

227 } 
	tcÚ_ÿÎ_šfo_t
;

230 
	sádm_¢gisdn_p_d©a
 {

231 
¢gisdn_p_nçs_d©a_t
 
nçs
[
MAX_NFAS_GROUPS
 + 1];

232 
¢gisdn_p_t
 *
p_¥ªs
[
MAX_TAP_SPANS
];

233 
ušt8_t
 
num_nçs
;

234 
ušt8_t
 
num_¥ªs_cÚfigu»d
;

235 }
	tádm_¢gisdn_p_d©a_t
;

244 
ádm_¡©us_t
 
	`§ngoma_isdn_p_£t_p_msg_šfo
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
¢g_decod”_š‹rçû_t
 *
štfCb
);

245 
ádm_¡©us_t
 
	`§ngoma_isdn_p_»£t_pÿÎ
(
·ssive_ÿÎ_t
 *
pÿÎ
);

248 
·ssive_ÿÎ_t
 *
	`§ngoma_isdn_p_ü—‹_pÿÎ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
);

251 
¢gisdn_t
 *
	`§ngoma_isdn_Ãw_cb
(
ádm_sock‘_t
 
fd
, 
nod‘y³
, 
sw™chty³
, *
u£rd©a
);

254 
	`§ngoma_isdn_£t_mes§ge
((*
__´i_”rÜ
)(
¢gisdn_t
 *
´i
, *));

255 
	`§ngoma_isdn_£t_”rÜ
((*
__´i_”rÜ
)(
¢gisdn_t
 *
´i
, *));

256 *
	`§ngoma_isdn_g‘_u£rd©a
(
¢gisdn_t
 *
´i
);

259 
ádm_¡©us_t
 
	`§ngoma_isdn_p_is_cÚ_»cv
(
¢gisdn_p_t
 *
p
, 
üv
, 
ušt8_t
 
msgTy³
);

262 
ádm_chªÃl_t
* 
	`§ngoma_isdn_p_g‘_fchª_by_chªid
(
¢gisdn_p_t
 *
p
, 
chªÃl
);

265 
ádm_¡©us_t
 
	`ámod_isdn_´oûss_ev’t
(
ádm_¥ª_t
 *
¥ª
, 
ádm_ev’t_t
 *
ev’t
);

266 
ádm_¡©us_t
 
	`¡©e_advªû
(
ádm_chªÃl_t
 *
ádmchª
);

269 
·ssive_ÿÎ_t
 *
	`§ngoma_isdn_p_g‘_pÿÎ_byüv
(
¢gisdn_p_t
 *
p
, 
üv
);

270 
·ssive_ÿÎ_t
 *
	`§ngoma_isdn_p_g‘_pÿÎ
(
¢gisdn_p_t
 *
p
, *
ÿÎ»f
);

273 
	`§ngoma_isdn_p_´št_pÿÎ
(
¢gisdn_p_t
 *
p
);

276 
	`§ngoma_isdn_p_check_¡©e
(
ádm_¥ª_t
 *
¥ª
);

279 
	`§ngoma_isdn_p_put_pÿÎ
(
¢gisdn_p_t
 *
p
, *
ÿÎ»f
);

283 
	`£nd_´ÙocŞ_¿w_d©a
(
isdn_p_msg_šfo_t
 *
d©a
, 
ádm_chªÃl_t
 *
ádmchª
);

287 
ádm_¡©us_t
 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_cÚ
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
¢g_decod”_š‹rçû_t
 *
štfCb
, 
üv
);

288 
ádm_¡©us_t
 
	`§ngoma_isdn_bidœ_p_g’”©e_šv™e
(
¢gisdn_p_t
 *
p
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
üv
);

289 
ádm_¡©us_t
 
	`§ngoma_isdn_bidœ_p_hªdË_ev’t_»l
(
¢gisdn_p_t
 *
p
, 
ušt8_t
 
msgTy³
, 
üv
);

292 
ádm_chªÃl_t
 *
	`§ngoma_isdn_bidœ_p_g‘_fchª
(
¢gisdn_p_t
 *
p
, 
·ssive_ÿÎ_t
 *
pÿÎ
, 
chªÃl
, 
fÜû_ş—r_chª
, 
p_ÿÎ_dœeùiÚ_t
 
ÿÎ_dœ
, 
ádm_boŞ_t
 
to_İ’
);

300 
	#PRI_NETWORK
 1

	)

301 
	#PRI_CPE
 2

	)

303 
	#SNG_ISDN_SPAN
(
p
è((Õè>> 8è& 0xff)

	)

304 
	#SNG_ISDN_CHANNEL
(
p
è(Õè& 0xff)

	)

306 
	#ISDN_TAP_NETWORK_ANSWER
 0x1

	)

309 
	#SNG_TAP_STALE_TME_DURATION
 60

	)

311 
	#SNG_TAP_SUBEQUENT_MSG_TME_DURATION
 5

	)

314 
	#DEBUG_Q921_RAW
 (1 << 0è

	)

315 
	#DEBUG_ALL
 (0xffffè

	)

318 
	#TRANS_CAP_SPEECH
 0x0

	)

319 
	#TRANS_CAP_DIGITAL
 0x08

	)

320 
	#TRANS_CAP_RESTRICTED_DIGITAL
 0x09

	)

321 
	#TRANS_CAP_3_1K_AUDIO
 0x10

	)

322 
	#TRANS_CAP_7K_AUDIO
 0x11

	)

323 
	#TRANS_CAP_DIGITAL_W_TONES
 0x11

	)

324 
	#TRANS_CAP_VIDEO
 0x18

	)

325 
	#LAYER_1_ITU_RATE_ADAPT
 0x21

	)

326 
	#LAYER_1_ULAW
 0x22

	)

327 
	#LAYER_1_ALAW
 0x23

	)

328 
	#LAYER_1_G721
 0x24

	)

329 
	#LAYER_1_G722_G725
 0x25

	)

330 
	#LAYER_1_H223_H245
 0x26

	)

331 
	#LAYER_1_NON_ITU_ADAPT
 0x27

	)

332 
	#LAYER_1_V120_RATE_ADAPT
 0x28

	)

333 
	#LAYER_1_X31_RATE_ADAPT
 0x29

	)

336 
	#SNG_DECODE_ISDN_EVENT
(
msgTy³
) \

337 ((
msgTy³
è=ğ
Q931_ALERTING
) ?"ALERT" : \

338 ((
msgTy³
è=ğ
Q931_PROCEEDING
) ?"CALL PROCEED" : \

339 ((
msgTy³
è=ğ
Q931_PROGRESS
) ?"PROGRESS" : \

340 ((
msgTy³
è=ğ
Q931_SETUP
) ?"SETUP" : \

341 ((
msgTy³
è=ğ
Q931_CONNECT
) ?"CONNECT" : \

342 ((
msgTy³
è=ğ
Q931_SETUP_ACK
) ?"SETUP ACK" : \

343 ((
msgTy³
è=ğ
Q931_CONNECT_ACK
) ?"CONNECT ACK" : \

344 ((
msgTy³
è=ğ
Q931_USER_INFO
) ?"USER INFO" : \

345 ((
msgTy³
è=ğ
Q931_SUSPEND_REJ
) ?"SUSPEND REJECT" : \

346 ((
msgTy³
è=ğ
Q931_RESUME_REJ
) ?"RESUME REJECT" : \

347 ((
msgTy³
è=ğ
Q931_SUSPEND
) ?"SUSPEND" : \

348 ((
msgTy³
è=ğ
Q931_RESUME
) ?"RESUME" : \

349 ((
msgTy³
è=ğ
Q931_SUSPEND_ACK
) ?"SUSPEND ACK" : \

350 ((
msgTy³
è=ğ
Q931_RESUME_ACK
) ?"RESUME ACK" : \

351 ((
msgTy³
è=ğ
Q931_DISCONNECT
) ?"DISCONNECT" : \

352 ((
msgTy³
è=ğ
Q931_RESTART
) ?"RESTART" : \

353 ((
msgTy³
è=ğ
Q931_RELEASE
) ?"RELEASE" : \

354 ((
msgTy³
è=ğ
Q931_RESTART_ACK
) ?"RESTART ACK" : \

355 ((
msgTy³
è=ğ
Q931_RELEASE_COMPLETE
)?"RELEASE COMPLETE" : \

356 ((
msgTy³
è=ğ
Q931_SEGMENT
) ?"SEGMENT" : \

357 ((
msgTy³
è=ğ
Q931_FACILITY
) ?"FACILITY" : \

358 ((
msgTy³
è=ğ
Q931_NOTIFY
) ?"NOTIFY" : \

359 ((
msgTy³
è=ğ
Q931_STATUS_ENQUIRY
) ?"STATUS ENQUIRY" : \

360 ((
msgTy³
è=ğ
Q931_CONGESTION_CNTRL
)?"CONGESTION CONTROL" : \

361 ((
msgTy³
è=ğ
Q931_INFORMATION
) ?"INFORMATION" : \

362 ((
msgTy³
è=ğ
Q931_STATUS
) ?"STATUS" : \

363 "UnknowÀISDNƒv’t"

	)

366 
	#SNG_DECODE_ISDN_TAP_MODE
(
pmode
) \

367 ((
pmode
è=ğ
ISDN_TAP_NORMAL
) ?"NORMAL (E1 T1 Tapping)" : \

368 ((
pmode
è=ğ
ISDN_TAP_BI_DIRECTION
) ?"BI DIRECTIONAL" : \

369 ((
pmode
è=ğ
ISDN_TAP_FS
) ?"Freeswitch (E1 T1 Tapping)" : \

370 "UnknowÀISDN T­pšg Mode"

	)

373 
	#SNG_ISDN_TAP_GET_INTERFACE
(
içû
) \

374 ((
içû
è=ğ
ISDN_TAP_IFACE_CPE
) ? "CPE" : \

375 ((
içû
è=ğ
ISDN_TAP_IFACE_NET
) ? "NET" : \

376 "UnknowÀš‹rçû"

	)

379 
	#SNG_ISDN_TAP_GET_NFAS_SPAN_TYPE
(
sigchª
) \

380 ((
sigchª
è=ğ
SNGISDN_NFAS_DCHAN_NONE
) ? "VOICE" : \

381 ((
sigchª
è=ğ
SNGISDN_NFAS_DCHAN_PRIMARY
) ? "PRIMARY SIGNALLING" : \

382 ((
sigchª
è=ğ
SNGISDN_NFAS_DCHAN_BACKUP
) ? "BACKUP SIGNALLING" : \

383 "UnknowÀNFAS s·Àty³"

	)

390 
¢g_decod”_ev’t_š‹rçû_t
 
¢g_ev’t
;

391 
ádm_io_š‹rçû_t
 
ádm_¢gisdn_p_š‹rçû
;

394 
ušt64_t
 
£tup_»cv
;

395 
ušt64_t
 
»u£_chª_cÚ_»cv
;

396 
ušt64_t
 
£tup_»cv_šv®id_chªId
;

397 
ušt64_t
 
£tup_nÙ_»cv
;

398 
ušt64_t
 
cÚÃù_»cv_w™h_chªId
;

399 
ušt64_t
 
cÚÃù_»cv
;

400 
ušt64_t
 
—¾y_cÚÃù_»cv
;

401 
ušt64_t
 
Ï‹_šv™e_»cv
;

402 
ušt64_t
 
ÿÎ_´oûed_»cv
;

403 
ušt64_t
 
»Ëa£_»cv
;

404 
ušt64_t
 
discÚÃù_»cv
;

405 
ušt64_t
 
ÿÎ_µed
;

406 
ušt64_t
 
msg_»cv_aá_time
;

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

92 
	#__tßscii
(
c
è((cè& 0x7fè

	)

94 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__exùy³
 (
i§Êum
);

103 
	`__exùy³
 (
i§Íha
);

104 
	`__exùy³
 (
isúŒl
);

105 
	`__exùy³
 (
isdig™
);

106 
	`__exùy³
 (
i¦ow”
);

107 
	`__exùy³
 (
isg¿ph
);

108 
	`__exùy³
 (
i¥ršt
);

109 
	`__exùy³
 (
i¥unù
);

110 
	`__exùy³
 (
is¥aû
);

111 
	`__exùy³
 (
isuµ”
);

112 
	`__exùy³
 (
isxdig™
);

116 
	$tŞow”
 (
__c
è
__THROW
;

119 
	$touµ”
 (
__c
è
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__exùy³
 (
isbÏnk
);

130 
__END_NAMESPACE_C99


133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE
 && !defšed 
__ılu¥lus


173 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

174 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

175 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

176 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

177 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

178 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

179 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

180 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

181 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

182 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

183 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

185 #ifdeà
__USE_ISOC99


186 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

189 #ifdeà
__USE_EXTERN_INLINES


190 
__ex‹º_šlše
 

191 
__NTH
 (
	$tŞow”
 (
__c
))

193  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

194 
	}
}

196 
__ex‹º_šlše
 

197 
__NTH
 (
	$touµ”
 (
__c
))

199  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

200 
	}
}

203 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


204 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

205 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

208 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


209 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

210 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

212 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

213 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

219 #ifdeà
__USE_XOPEN2K8


233 
	~<xloÿË.h
>

237 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

238 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

240 
	#__exùy³_l
(
Çme
) \

241 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

247 
__exùy³_l
 (
i§Êum_l
);

248 
__exùy³_l
 (
i§Íha_l
);

249 
__exùy³_l
 (
isúŒl_l
);

250 
__exùy³_l
 (
isdig™_l
);

251 
__exùy³_l
 (
i¦ow”_l
);

252 
__exùy³_l
 (
isg¿ph_l
);

253 
__exùy³_l
 (
i¥ršt_l
);

254 
__exùy³_l
 (
i¥unù_l
);

255 
__exùy³_l
 (
is¥aû_l
);

256 
__exùy³_l
 (
isuµ”_l
);

257 
__exùy³_l
 (
isxdig™_l
);

259 
__exùy³_l
 (
isbÏnk_l
);

263 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

264 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

267 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

268 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

270 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


271 
	#__tŞow”_l
(
c
, 
loÿË
) \

272 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

273 
	#__touµ”_l
(
c
, 
loÿË
) \

274 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

275 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

276 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

280 #iâdeà
__NO_CTYPE


281 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

282 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

283 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

284 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

285 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

286 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

287 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

288 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

289 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

290 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

291 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

293 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

295 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


296 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

297 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

300 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

301 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

302 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

303 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

304 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

305 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

306 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

307 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

308 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

309 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

310 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

312 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

314 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


315 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

316 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/poll.h

1 
	~<sys/pŞl.h
>

	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/bits/time.h

24 #iâdeà
__Ãed_timev®


25 #iâdeà
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


39 
	~<b™s/ty³s.h
>

40 
__syscÚf
 ();

41 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

44 #ifdeà
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

54 
	#CLOCK_MONOTONIC_RAW
 4

	)

56 
	#CLOCK_REALTIME_COARSE
 5

	)

58 
	#CLOCK_MONOTONIC_COARSE
 6

	)

61 
	#TIMER_ABSTIME
 1

	)

67 #ifdeà
__Ãed_timev®


68 #undeà
__Ãed_timev®


69 #iâdeà
_STRUCT_TIMEVAL


70 
	#_STRUCT_TIMEVAL
 1

	)

71 
	~<b™s/ty³s.h
>

75 
	stimev®


77 
__time_t
 
	mtv_£c
;

78 
__su£cÚds_t
 
	mtv_u£c
;

	@/usr/include/bits/types.h

24 #iâdef 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	t__u_ch¬
;

32 
	t__u_shÜt
;

33 
	t__u_št
;

34 
	t__u_lÚg
;

37 sigÃd 
	t__št8_t
;

38 
	t__ušt8_t
;

39 sigÃd 
	t__št16_t
;

40 
	t__ušt16_t
;

41 sigÃd 
	t__št32_t
;

42 
	t__ušt32_t
;

43 #ià
__WORDSIZE
 == 64

44 sigÃd 
	t__št64_t
;

45 
	t__ušt64_t
;

46 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


47 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

48 
__ex‹nsiÚ__
 
	t__ušt64_t
;

52 #ià
__WORDSIZE
 == 64

53 
	t__quad_t
;

54 
	t__u_quad_t
;

55 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


56 
__ex‹nsiÚ__
 
	t__quad_t
;

57 
__ex‹nsiÚ__
 
	t__u_quad_t
;

61 
	m__v®
[2];

62 } 
	t__quad_t
;

65 
__u_lÚg
 
	m__v®
[2];

66 } 
	t__u_quad_t
;

99 
	#__S16_TYPE
 

	)

100 
	#__U16_TYPE
 

	)

101 
	#__S32_TYPE
 

	)

102 
	#__U32_TYPE
 

	)

103 
	#__SLONGWORD_TYPE
 

	)

104 
	#__ULONGWORD_TYPE
 

	)

105 #ià
__WORDSIZE
 == 32

106 
	#__SQUAD_TYPE
 
__quad_t


	)

107 
	#__UQUAD_TYPE
 
__u_quad_t


	)

108 
	#__SWORD_TYPE
 

	)

109 
	#__UWORD_TYPE
 

	)

110 
	#__SLONG32_TYPE
 

	)

111 
	#__ULONG32_TYPE
 

	)

112 
	#__S64_TYPE
 
__quad_t


	)

113 
	#__U64_TYPE
 
__u_quad_t


	)

116 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

117 #–ià
__WORDSIZE
 == 64

118 
	t__SQUAD_TYPE
 

	)

119 
	t__UQUAD_TYPE
 

	)

120 
	t__SWORD_TYPE
 

	)

121 
	t__UWORD_TYPE
 

	)

122 
	t__SLONG32_TYPE
 

	)

123 
	t__ULONG32_TYPE
 

	)

124 
	t__S64_TYPE
 

	)

125 
	t__U64_TYPE
 

	)

127 
	t__STD_TYPE
 

	)

131 
	~<b™s/ty³sizes.h
>

134 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

135 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

136 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

137 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

138 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

139 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

140 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

141 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

142 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

143 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

144 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

145 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

146 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

147 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

148 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

149 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

150 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

151 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

153 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

154 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

155 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

158 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

161 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

164 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

169 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

170 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

173 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

174 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

177 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

178 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

180 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__off64_t
 
	t__loff_t
;

185 
__quad_t
 *
	t__qaddr_t
;

186 *
	t__ÿddr_t
;

189 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

192 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

195 #undeà
__STD_TYPE


	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

19 #iâdef 
_FEATURES_H


20 
	#_FEATURES_H
 1

	)

96 #undeà
__USE_ISOC99


97 #undeà
__USE_ISOC95


98 #undeà
__USE_POSIX


99 #undeà
__USE_POSIX2


100 #undeà
__USE_POSIX199309


101 #undeà
__USE_POSIX199506


102 #undeà
__USE_XOPEN


103 #undeà
__USE_XOPEN_EXTENDED


104 #undeà
__USE_UNIX98


105 #undeà
__USE_XOPEN2K


106 #undeà
__USE_XOPEN2KXSI


107 #undeà
__USE_XOPEN2K8


108 #undeà
__USE_XOPEN2K8XSI


109 #undeà
__USE_LARGEFILE


110 #undeà
__USE_LARGEFILE64


111 #undeà
__USE_FILE_OFFSET64


112 #undeà
__USE_BSD


113 #undeà
__USE_SVID


114 #undeà
__USE_MISC


115 #undeà
__USE_ATFILE


116 #undeà
__USE_GNU


117 #undeà
__USE_REENTRANT


118 #undeà
__USE_FORTIFY_LEVEL


119 #undeà
__FAVOR_BSD


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

129 
	#__USE_ANSI
 1

	)

138 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


139 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

140 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

142 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

147 #ià
defšed
 
_BSD_SOURCE
 && \

148 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

149 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

150 
	#__FAVOR_BSD
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_POSIX_SOURCE


160 
	#_POSIX_SOURCE
 1

	)

161 #undeà
_POSIX_C_SOURCE


162 
	#_POSIX_C_SOURCE
 200809L

	)

163 #undeà
_XOPEN_SOURCE


164 
	#_XOPEN_SOURCE
 700

	)

165 #undeà
_XOPEN_SOURCE_EXTENDED


166 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

167 #undeà
_LARGEFILE64_SOURCE


168 
	#_LARGEFILE64_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

180 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

181 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

182 
	#_BSD_SOURCE
 1

	)

183 
	#_SVID_SOURCE
 1

	)

190 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

191 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

192 
	#__USE_ISOC99
 1

	)

196 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

197 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

198 
	#__USE_ISOC95
 1

	)

203 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

204 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

205 
	#_POSIX_SOURCE
 1

	)

206 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

207 
	#_POSIX_C_SOURCE
 2

	)

208 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

209 
	#_POSIX_C_SOURCE
 199506L

	)

210 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

211 
	#_POSIX_C_SOURCE
 200112L

	)

213 
	#_POSIX_C_SOURCE
 200809L

	)

215 
	#__USE_POSIX_IMPLICITLY
 1

	)

218 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


219 
	#__USE_POSIX
 1

	)

222 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


223 
	#__USE_POSIX2
 1

	)

226 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

227 
	#__USE_POSIX199309
 1

	)

230 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

231 
	#__USE_POSIX199506
 1

	)

234 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

235 
	#__USE_XOPEN2K
 1

	)

236 #undeà
__USE_ISOC95


237 
	#__USE_ISOC95
 1

	)

238 #undeà
__USE_ISOC99


239 
	#__USE_ISOC99
 1

	)

242 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

243 
	#__USE_XOPEN2K8
 1

	)

244 #undeà
_ATFILE_SOURCE


245 
	#_ATFILE_SOURCE
 1

	)

248 #ifdef 
_XOPEN_SOURCE


249 
	#__USE_XOPEN
 1

	)

250 #ià(
_XOPEN_SOURCE
 - 0) >= 500

251 
	#__USE_XOPEN_EXTENDED
 1

	)

252 
	#__USE_UNIX98
 1

	)

253 #undeà
_LARGEFILE_SOURCE


254 
	#_LARGEFILE_SOURCE
 1

	)

255 #ià(
_XOPEN_SOURCE
 - 0) >= 600

256 #ià(
_XOPEN_SOURCE
 - 0) >= 700

257 
	#__USE_XOPEN2K8
 1

	)

258 
	#__USE_XOPEN2K8XSI
 1

	)

260 
	#__USE_XOPEN2K
 1

	)

261 
	#__USE_XOPEN2KXSI
 1

	)

262 #undeà
__USE_ISOC95


263 
	#__USE_ISOC95
 1

	)

264 #undeà
__USE_ISOC99


265 
	#__USE_ISOC99
 1

	)

268 #ifdeà
_XOPEN_SOURCE_EXTENDED


269 
	#__USE_XOPEN_EXTENDED
 1

	)

274 #ifdeà
_LARGEFILE_SOURCE


275 
	#__USE_LARGEFILE
 1

	)

278 #ifdeà
_LARGEFILE64_SOURCE


279 
	#__USE_LARGEFILE64
 1

	)

282 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

283 
	#__USE_FILE_OFFSET64
 1

	)

286 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


287 
	#__USE_MISC
 1

	)

290 #ifdef 
_BSD_SOURCE


291 
	#__USE_BSD
 1

	)

294 #ifdef 
_SVID_SOURCE


295 
	#__USE_SVID
 1

	)

298 #ifdef 
_ATFILE_SOURCE


299 
	#__USE_ATFILE
 1

	)

302 #ifdef 
_GNU_SOURCE


303 
	#__USE_GNU
 1

	)

306 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


307 
	#__USE_REENTRANT
 1

	)

310 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

311 && 
defšed
 
__OPTIMIZE__
 && __OPTIMIZE__ > 0

312 #ià!
__GNUC_PREREQ
 (4, 1)

313 #ifdeà
__GNUC_RH_RELEASE__


314 #w¬nšg 
_FORTIFY_SOURCE
 
suµÜ‹d
 
Úly
 
w™h
 
GCC
 4.1 
ªd
 
Ï‹r


316 
	#__USE_FORTIFY_LEVEL
 0

	)

317 #–ià
_FORTIFY_SOURCE
 > 1

318 
	#__USE_FORTIFY_LEVEL
 2

	)

320 
	#__USE_FORTIFY_LEVEL
 1

	)

323 
	#__USE_FORTIFY_LEVEL
 0

	)

327 
	#__STDC_IEC_559__
 1

	)

328 
	#__STDC_IEC_559_COMPLEX__
 1

	)

331 
	#__STDC_ISO_10646__
 200009L

	)

339 #undeà
__GNU_LIBRARY__


340 
	#__GNU_LIBRARY__
 6

	)

344 
	#__GLIBC__
 2

	)

345 
	#__GLIBC_MINOR__
 12

	)

347 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

348 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

351 #ià
defšed
 
__GNUC__
 \

352 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

353 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

354 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

355 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

359 #iâdeà
__ASSEMBLER__


360 #iâdeà
_SYS_CDEFS_H


361 
	~<sys/cdefs.h
>

366 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


367 
	#__USE_LARGEFILE
 1

	)

368 
	#__USE_LARGEFILE64
 1

	)

374 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

375 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

376 && 
defšed
 
	g__ex‹º_šlše


377 
	#__USE_EXTERN_INLINES
 1

	)

385 
	~<gnu/¡ubs.h
>

	@/usr/include/sys/poll.h

20 #iâdef 
_SYS_POLL_H


21 
	#_SYS_POLL_H
 1

	)

23 
	~<ã©u»s.h
>

26 
	~<b™s/pŞl.h
>

27 #ifdeà
__USE_GNU


29 
	~<b™s/sig£t.h
>

31 
	#__Ãed_time¥ec


	)

32 
	~<time.h
>

37 
	tnfds_t
;

40 
	spŞlfd


42 
	mfd
;

43 
	mev’ts
;

44 
	m»v’ts
;

48 
__BEGIN_DECLS


58 
pŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
, 
__timeout
);

60 #ifdeà
__USE_GNU


67 
µŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

68 
__cÚ¡
 
time¥ec
 *
__timeout
,

69 
__cÚ¡
 
__sig£t_t
 *
__ss
);

72 
	g__END_DECLS


	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/bits/byteswap.h

21 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


25 #iâdeà
_BITS_BYTESWAP_H


26 
	#_BITS_BYTESWAP_H
 1

	)

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

34 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

35 
	#__bsw­_16
(
x
) \

36 (
__ex‹nsiÚ__
 \

37 ({ 
__v
, 
__x
 = (è(
x
); \

38 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

39 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

41 
	`__asm__
 ("rorw $8, %w0" \

42 : "ô" (
__v
) \

43 : "0" (
__x
) \

45 
__v
; }))

	)

48 
	#__bsw­_16
(
x
) \

49 (
__ex‹nsiÚ__
 \

50 ({ 
__x
 = (è(
x
); \

51 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

56 
	#__bsw­_cÚ¡ªt_32
(
x
) \

57 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

58 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

60 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

61 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

62 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

63 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

64 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

65 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

66 || 
defšed
 
	g__amdçm10__
)

69 
	#__bsw­_32
(
x
) \

70 (
__ex‹nsiÚ__
 \

71 ({ 
__v
, 
__x
 = (
x
); \

72 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

73 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

75 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

76 
__v
; }))

	)

78 
	#__bsw­_32
(
x
) \

79 (
__ex‹nsiÚ__
 \

80 ({ 
__v
, 
__x
 = (
x
); \

81 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

82 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

84 
	`__asm__
 ("rorw $8, %w0;" \

87 : "ô" (
__v
) \

88 : "0" (
__x
) \

90 
__v
; }))

	)

93 
	#__bsw­_32
(
x
) \

94 (
__ex‹nsiÚ__
 \

95 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

99 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

101 
	#__bsw­_cÚ¡ªt_64
(
x
) \

102 ((((
x
) & 0xff00000000000000ull) >> 56) \

103 | (((
x
) & 0x00ff000000000000ull) >> 40) \

104 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

105 | (((
x
) & 0x000000ff00000000ull) >> 8) \

106 | (((
x
) & 0x00000000ff000000ull) << 8) \

107 | (((
x
) & 0x0000000000ff0000ull) << 24) \

108 | (((
x
) & 0x000000000000ff00ull) << 40) \

109 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

111 #ià
__WORDSIZE
 == 64

112 
	#__bsw­_64
(
x
) \

113 (
__ex‹nsiÚ__
 \

114 ({ 
__v
, 
__x
 = (
x
); \

115 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

116 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

118 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

119 
__v
; }))

	)

121 
	#__bsw­_64
(
x
) \

122 (
__ex‹nsiÚ__
 \

123 ({ uniÚ { 
__ex‹nsiÚ__
 
__Î
; \

124 
__l
[2]; } 
__w
, 
__r
; \

125 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

126 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

129 
__w
.
__Î
 = (
x
); \

130 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

131 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

133 
__r
.
__Î
; }))

	)

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/poll.h

19 #iâdeà
_SYS_POLL_H


26 
	#POLLIN
 0x001

	)

27 
	#POLLPRI
 0x002

	)

28 
	#POLLOUT
 0x004

	)

30 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


32 
	#POLLRDNORM
 0x040

	)

33 
	#POLLRDBAND
 0x080

	)

34 
	#POLLWRNORM
 0x100

	)

35 
	#POLLWRBAND
 0x200

	)

38 #ifdeà
__USE_GNU


40 
	#POLLMSG
 0x400

	)

41 
	#POLLREMOVE
 0x1000

	)

42 
	#POLLRDHUP
 0x2000

	)

48 
	#POLLERR
 0x008

	)

49 
	#POLLHUP
 0x010

	)

50 
	#POLLNVAL
 0x020

	)

	@/usr/include/bits/sigset.h

21 #iâdef 
_SIGSET_H_ty³s


22 
	#_SIGSET_H_ty³s
 1

	)

24 
	t__sig_©omic_t
;

28 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

31 
	m__v®
[
_SIGSET_NWORDS
];

32 } 
	t__sig£t_t
;

43 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


44 
	#_SIGSET_H_âs
 1

	)

46 #iâdeà
_EXTERN_INLINE


47 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

51 
	#__sigmask
(
sig
) \

52 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

55 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

57 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

58 
	#__sigem±y£t
(
£t
) \

59 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

60 
sig£t_t
 *
__£t
 = (
£t
); \

61 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

62 0; }))

	)

63 
	#__sigfl£t
(
£t
) \

64 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

65 
sig£t_t
 *
__£t
 = (
£t
); \

66 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

67 0; }))

	)

69 #ifdeà
__USE_GNU


73 
	#__sigi£m±y£t
(
£t
) \

74 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

75 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

76 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

77 !
__»t
 && --
__út
 >= 0) \

78 
__»t
 = 
__£t
->
__v®
[
__út
]; \

79 
__»t
 =ğ0; }))

	)

80 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

81 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

82 
sig£t_t
 *
__de¡
 = (
de¡
); \

83 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

84 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

85 --
__út
 >= 0) \

86 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

87 & 
__right
->
__v®
[
__út
]); \

88 0; }))

	)

89 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

90 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

91 
sig£t_t
 *
__de¡
 = (
de¡
); \

92 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

93 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

94 --
__út
 >= 0) \

95 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

96 | 
__right
->
__v®
[
__út
]); \

97 0; }))

	)

104 
__sigismemb”
 (
__cÚ¡
 
__sig£t_t
 *, );

105 
__sigadd£t
 (
__sig£t_t
 *, );

106 
__sigd–£t
 (
__sig£t_t
 *, );

108 #ifdeà
__USE_EXTERN_INLINES


109 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

110 
_EXTERN_INLINE
 \

111 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

113 
__mask
 = 
	`__sigmask
 (
__sig
); \

114 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

115  
BODY
; \

116 }

	)

118 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
è? 1 : 0, 
__cÚ¡
)

119 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

120 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

122 #undeà
__SIGSETFN


	@/usr/include/bits/typesizes.h

20 #iâdeà
_BITS_TYPES_H


24 #iâdef 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__


4 
	#__WORDSIZE
 64

	)

5 
	#__WORDSIZE_COMPAT32
 1

	)

7 
	#__WORDSIZE
 32

	)

	@/usr/include/gnu/stubs.h

4 
	~<b™s/wÜdsize.h
>

6 #ià
__WORDSIZE
 == 32

7 
	~<gnu/¡ubs-32.h
>

8 #–ià
__WORDSIZE
 == 64

9 
	~<gnu/¡ubs-64.h
>

	@/usr/include/sys/cdefs.h

20 #iâdef 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #iâdeà
_FEATURES_H


25 
	~<ã©u»s.h
>

31 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


36 #undeà
__P


37 #undeà
__PMT


39 #ifdeà
__GNUC__


46 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

48 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
)è
	)
fct

50 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
fù
èfù 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
fù
è
	)
fct

61 
	#__šlše


	)

63 
	#__THROW


	)

64 
	#__NTH
(
fù
è
	)
fct

66 
	#__cÚ¡
 cÚ¡

	)

67 
	#__sigÃd
 sigÃd

	)

68 
	#__vŞ©e
 vŞ©e

	)

74 
	#__P
(
¬gs
è
	)
args

75 
	#__PMT
(
¬gs
è
	)
args

80 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

81 
	#__STRING
(
x
è#x

	)

84 
	#__±r_t
 *

	)

85 
	#__lÚg_doubË_t
 

	)

89 #ifdef 
__ılu¥lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

124 #iâdeà
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rv®ue


	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3) \

136 || (
defšed
 
	g__GNUC_RH_RELEASE__
 && 
	g__GNUC__
 == 4 \

137 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

138 && 
__GNUC_RH_RELEASE__
 >= 31)

139 
	#__w¬ndeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

141 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

142 
	#__”rÜdeş
(
Çme
, 
msg
) \

143 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

145 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

146 
	#__w¬Ç‰r
(
msg
)

	)

147 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

151 #ià
__GNUC_PREREQ
 (2,97)

153 
	#__æex¬r
 []

	)

155 #ifdeà
__GNUC__


156 
	#__æex¬r
 [0]

	)

158 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

159 
	#__æex¬r
 []

	)

162 
	#__æex¬r
 [1]

	)

178 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

180 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 #ifdeà
__ılu¥lus


182 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

183 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

185 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

186 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

188 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

189 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

202 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

203 
	#__©Œibu‹__
(
xyz
è

	)

209 #ià
__GNUC_PREREQ
 (2,96)

210 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

212 
	#__©Œibu‹_m®loc__


	)

218 #ià
__GNUC_PREREQ
 (2,96)

219 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

221 
	#__©Œibu‹_pu»__


	)

227 #ià
__GNUC_PREREQ
 (3,1)

228 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

229 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

231 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

232 
	#__©Œibu‹_nošlše__


	)

236 #ià
__GNUC_PREREQ
 (3,2)

237 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

239 
	#__©Œibu‹_d•»ÿ‹d__


	)

248 #ià
__GNUC_PREREQ
 (2,8)

249 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

251 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

258 #ià
__GNUC_PREREQ
 (2,97)

259 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

260 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

262 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

267 #ià
__GNUC_PREREQ
 (3,3)

268 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

270 
	#__nÚnuÎ
(
·¿ms
)

	)

275 #ià
__GNUC_PREREQ
 (3,4)

276 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

277 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

278 #ià
__USE_FORTIFY_LEVEL
 > 0

279 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

282 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

284 #iâdeà
__wur


285 
	#__wur


	)

289 #ià
__GNUC_PREREQ
 (3,2)

290 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

292 
	#__®ways_šlše
 
__šlše


	)

297 #ià!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

298 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

299 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

300 && 
__GNUC_RH_RELEASE__
 >= 31)

301 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


302 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

303 #ià
__GNUC_PREREQ
 (4,3) \

304 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

305 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

306 && 
__GNUC_RH_RELEASE__
 >= 31)

307 
	#__ex‹º_®ways_šlše
 \

308 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
, 
__¬tificŸl__
))

	)

310 
	#__ex‹º_®ways_šlše
 \

311 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

314 
	#__ex‹º_šlše
 
__šlše


	)

315 #ià
__GNUC_PREREQ
 (4,3)

316 
	#__ex‹º_®ways_šlše
 \

317 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

319 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

326 #ià
__GNUC_PREREQ
 (4,3) \

327 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

328 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

329 && 
__GNUC_RH_RELEASE__
 >= 31)

330 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

331 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

338 #ià!
__GNUC_PREREQ
 (2,8)

339 
	#__ex‹nsiÚ__


	)

343 #ià!
__GNUC_PREREQ
 (2,92)

344 
	#__»¡riù


	)

350 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


351 
	#__»¡riù_¬r
 
__»¡riù


	)

353 #ifdeà
__GNUC__


354 
	#__»¡riù_¬r


	)

356 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

357 
	#__»¡riù_¬r
 
»¡riù


	)

360 
	#__»¡riù_¬r


	)

365 
	~<b™s/wÜdsize.h
>

367 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


368 
	#__LDBL_COMPAT
 1

	)

369 #ifdeà
__REDIRECT


370 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

371 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

372 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

373 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

374 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

375 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

376 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

377 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

378 
	#__LDBL_REDIR_DECL
(
Çme
) \

379 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

380 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

381 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

382 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

383 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

386 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


387 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

388 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

389 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

390 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

391 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

392 #ifdeà
__REDIRECT


393 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

394 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

395 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@
1
.
1
/usr/include
21
531
ftmod_sangoma_isdn_bidir_tap.c
ftmod_sangoma_isdn_tap.c
ftmod_sangoma_isdn_tap.h
/usr/include/ctype.h
/usr/include/poll.h
/usr/include/time.h
/usr/include/bits/time.h
/usr/include/bits/types.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/sys/poll.h
/usr/include/xlocale.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/poll.h
/usr/include/bits/sigset.h
/usr/include/bits/typesizes.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs.h
/usr/include/sys/cdefs.h
/usr/include/gnu/stubs-64.h
